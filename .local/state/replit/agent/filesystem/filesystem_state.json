{"file_contents":{"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"replit.md":{"content":"# TrainFlow - Enterprise Training Platform\n\n## Overview\n\nTrainFlow is a production-grade enterprise training management system designed for large organizations like Aramco and Saudi Electricity Company. The platform automates employee training compliance, renewal workflows, progression tracking, and provides AI-driven insights for career development.\n\n**Core Purpose:**\n- Track employee training certifications and validity periods\n- Automate renewal workflows with multi-level approvals (Employee → Foreman → Manager)\n- Send smart alerts at 30/14/7/1 days before course expiry\n- Manage progression tasks required for employee promotions\n- Generate AI-based course recommendations and grade readiness predictions\n- Provide comprehensive audit logging and workflow timelines\n- Support enterprise reporting (PDF, Excel, JSON exports for SAP/Oracle integration)\n\n**Key Capabilities:**\n- Role-based access control (Employee, Foreman, Manager, Training Officer, Administrator)\n- Multi-tenant architecture using tenant_id\n- Real-time notifications (email + in-app)\n- Dashboard KPIs for each role\n- Complete CRUD audit logging\n- Non-destructive database operations\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack:**\n- React 18+ with TypeScript\n- Vite for build tooling and development server\n- Wouter for client-side routing\n- TanStack Query (React Query) for server state management\n- ShadCN UI component library built on Radix UI primitives\n- Tailwind CSS for styling with Carbon Design System principles\n\n**Design System:**\n- IBM Plex Sans for typography (via Google Fonts CDN)\n- Carbon Design System-inspired components for enterprise data-heavy interfaces\n- Custom theming with light/dark mode support\n- Responsive layouts optimized for desktop workflows\n\n**State Management:**\n- TanStack Query for all server-side data fetching and caching\n- Query invalidation patterns for real-time updates\n- Optimistic updates for improved UX\n- No global client-side state management (all state derived from server)\n\n**Key Frontend Patterns:**\n- Custom hooks for authentication (`useAuth`), theming, and mobile detection\n- Reusable data table component with sorting, filtering, and pagination\n- KPI card components for dashboard metrics\n- Status badge components with consistent color coding\n- Workflow timeline visualization for approval flows\n\n### Backend Architecture\n\n**Technology Stack:**\n- Express.js with TypeScript\n- Drizzle ORM for database operations\n- Neon serverless PostgreSQL driver\n- Passport.js for authentication\n- Express session management with PostgreSQL store\n\n**Authentication & Authorization:**\n- Replit Auth integration using OpenID Connect\n- Session-based authentication with HTTP-only cookies\n- Role-based access control (RBAC) middleware\n- JWT tokens for session management\n- 7-day session TTL\n\n**API Design:**\n- RESTful API endpoints under `/api` prefix\n- Role-based middleware protecting sensitive routes\n- Consistent error handling and logging\n- Request/response logging middleware\n- Audit logging for all CRUD operations\n\n**Database Layer:**\n- Drizzle ORM with schema-first approach\n- Type-safe database queries\n- Shared schema definitions between client and server (`@shared/schema`)\n- Connection pooling via Neon serverless driver\n- Database migrations managed by Drizzle Kit\n\n**Key Backend Patterns:**\n- Storage abstraction layer (`server/storage.ts`) for all database operations\n- Audit logging wrapper for tracking all system actions\n- Background workers for scheduled tasks (course expiry checks)\n- Multi-level approval workflow state machine\n- Notification engine for alerts and escalations\n\n### Data Storage\n\n**Database:** PostgreSQL (via Neon serverless)\n\n**Schema Design:**\n- `users` - User accounts with role-based permissions and department assignment\n- `departments` - Organizational structure\n- `courses` - Training course catalog with validity periods\n- `enrollments` - Employee course assignments with expiration tracking\n- `renewal_requests` - Multi-level approval workflow for course renewals\n- `notifications` - In-app notification system\n- `progression_tasks` - Tasks required for employee promotions\n- `audit_logs` - Complete audit trail of all system actions\n- `ai_recommendations` - AI-generated course suggestions\n- `sessions` - Session storage (required for Replit Auth)\n\n**Multi-tenancy:**\n- All tables include `tenant_id` column for multi-tenant isolation\n- Default tenant_id: 'default'\n- Tenant filtering applied at storage layer\n\n**Database Relationships:**\n- Users belong to departments and have supervisors\n- Enrollments link users to courses with expiration dates\n- Renewal requests reference enrollments and track approval chain\n- Progression tasks link to required courses\n- Audit logs reference users and entities\n\n### External Dependencies\n\n**Third-party Services:**\n- Replit Auth - OpenID Connect authentication provider\n- Neon Database - Serverless PostgreSQL hosting\n- Google Fonts CDN - IBM Plex Sans and IBM Plex Mono fonts\n\n**Client-side Libraries:**\n- Radix UI - Accessible component primitives (accordion, alert-dialog, avatar, checkbox, dialog, dropdown-menu, label, popover, progress, radio-group, scroll-area, select, separator, slider, switch, tabs, toast, tooltip)\n- TanStack Query - Server state management\n- React Hook Form - Form validation and submission\n- Zod - Runtime type validation and schema validation\n- date-fns - Date manipulation and formatting\n- class-variance-authority - Component variant styling\n- cmdk - Command palette component\n\n**Server-side Libraries:**\n- OpenAI - AI-powered course recommendations\n- Passport - Authentication middleware\n- connect-pg-simple - PostgreSQL session store\n- Drizzle ORM - Type-safe database queries\n- ws - WebSocket support for Neon\n- express-rate-limit - API rate limiting\n- express-session - Session management\n- nanoid - Unique ID generation\n- nodemailer - Email notifications\n- multer - File upload handling\n- stripe - Payment processing (if needed)\n- xlsx - Excel report generation\n\n**Development Tools:**\n- Vite - Build tool and dev server\n- ESBuild - Production builds\n- TypeScript - Type safety\n- Tailwind CSS - Utility-first styling\n- PostCSS - CSS processing\n\n**Replit-specific Integrations:**\n- @replit/vite-plugin-runtime-error-modal - Development error overlay\n- @replit/vite-plugin-cartographer - Code mapping\n- @replit/vite-plugin-dev-banner - Development banner\n\n**Performance Targets:**\n- API response time: <150ms\n- Code splitting for optimal bundle sizes\n- Server-side bundling with allowlist for cold start optimization\n- Static asset serving from dist/public","path":null,"size_bytes":6705,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"// Authentication hook for Replit Auth\n// Reference: javascript_log_in_with_replit blueprint\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    error,\n  };\n}\n","path":null,"size_bytes":418,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { \n  GraduationCap, \n  Shield, \n  BarChart3, \n  Users, \n  Clock, \n  CheckCircle2,\n  ArrowRight,\n  Sparkles\n} from \"lucide-react\";\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center\">\n                <GraduationCap className=\"h-6 w-6 text-primary-foreground\" />\n              </div>\n              <div>\n                <h1 className=\"font-semibold text-lg tracking-tight\" data-testid=\"text-logo\">\n                  TrainFlow\n                </h1>\n                <p className=\"text-xs text-muted-foreground\">Enterprise Training Platform</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <ThemeToggle />\n              <a href=\"/api/login\">\n                <Button data-testid=\"button-login\">\n                  Sign In\n                  <ArrowRight className=\"ml-2 h-4 w-4\" />\n                </Button>\n              </a>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-7xl mx-auto text-center\">\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm font-medium mb-6\">\n            <Sparkles className=\"h-4 w-4\" />\n            AI-Powered Training Management\n          </div>\n          <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight mb-6\">\n            Enterprise Training\n            <br />\n            <span className=\"text-primary\">Renewal & Progression</span>\n          </h1>\n          <p className=\"text-lg sm:text-xl text-muted-foreground max-w-3xl mx-auto mb-10\">\n            A production-grade corporate system designed for organizations like Aramco and Saudi Electricity Company. \n            Manage employee training validity, renewal workflows, promotion tasks, and AI-driven insights.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <a href=\"/api/login\">\n              <Button size=\"lg\" className=\"w-full sm:w-auto\" data-testid=\"button-get-started\">\n                Get Started\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </a>\n            <Button size=\"lg\" variant=\"outline\" className=\"w-full sm:w-auto\" data-testid=\"button-learn-more\">\n              Learn More\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Grid */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8 bg-muted/30\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-bold mb-4\">Core Capabilities</h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              Everything you need to manage training compliance, employee progression, and organizational development.\n            </p>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-chart-1/10 flex items-center justify-center mb-4\">\n                  <Clock className=\"h-6 w-6 text-chart-1\" />\n                </div>\n                <CardTitle className=\"text-xl\">Expiry Tracking</CardTitle>\n                <CardDescription>\n                  Detect upcoming course expirations with smart alerts at 30/14/7/1 days before expiry.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-chart-2/10 flex items-center justify-center mb-4\">\n                  <CheckCircle2 className=\"h-6 w-6 text-chart-2\" />\n                </div>\n                <CardTitle className=\"text-xl\">Approval Workflows</CardTitle>\n                <CardDescription>\n                  Multi-level approval workflow: Employee to Foreman to Manager with complete tracking.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-chart-3/10 flex items-center justify-center mb-4\">\n                  <BarChart3 className=\"h-6 w-6 text-chart-3\" />\n                </div>\n                <CardTitle className=\"text-xl\">KPI Dashboards</CardTitle>\n                <CardDescription>\n                  Role-based dashboards showing key metrics, pending tasks, and course status.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-chart-4/10 flex items-center justify-center mb-4\">\n                  <Users className=\"h-6 w-6 text-chart-4\" />\n                </div>\n                <CardTitle className=\"text-xl\">User Roles</CardTitle>\n                <CardDescription>\n                  Support for Employee, Foreman, Manager, Training Officer, and Administrator roles.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-chart-5/10 flex items-center justify-center mb-4\">\n                  <Sparkles className=\"h-6 w-6 text-chart-5\" />\n                </div>\n                <CardTitle className=\"text-xl\">AI Recommendations</CardTitle>\n                <CardDescription>\n                  AI-driven course suggestions based on role, certifications, and career progression.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"hover-elevate\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4\">\n                  <Shield className=\"h-6 w-6 text-primary\" />\n                </div>\n                <CardTitle className=\"text-xl\">Full Audit Logging</CardTitle>\n                <CardDescription>\n                  Complete workflow timeline with all CRUD operations, login events, and approvals.\n                </CardDescription>\n              </CardHeader>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Role Cards */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-bold mb-4\">Designed for Every Role</h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              Each user role has a tailored dashboard and set of capabilities.\n            </p>\n          </div>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4\">\n            {[\n              { role: \"Employee\", desc: \"Track courses & submit renewals\" },\n              { role: \"Foreman\", desc: \"Approve team requests\" },\n              { role: \"Manager\", desc: \"Final approvals & oversight\" },\n              { role: \"Training Officer\", desc: \"Manage courses & enroll staff\" },\n              { role: \"Administrator\", desc: \"Full system access\" },\n            ].map((item, index) => (\n              <Card key={item.role} className=\"text-center hover-elevate\">\n                <CardHeader className=\"pb-2\">\n                  <div className=\"w-12 h-12 rounded-full bg-primary/10 mx-auto flex items-center justify-center mb-3\">\n                    <span className=\"text-primary font-bold text-lg\">{index + 1}</span>\n                  </div>\n                  <CardTitle className=\"text-base\">{item.role}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground\">{item.desc}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"py-20 px-4 sm:px-6 lg:px-8 bg-primary text-primary-foreground\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h2 className=\"text-3xl font-bold mb-4\">\n            Ready to Transform Your Training Management?\n          </h2>\n          <p className=\"text-primary-foreground/80 mb-8 text-lg\">\n            Join enterprises worldwide in automating training renewals and ensuring compliance.\n          </p>\n          <a href=\"/api/login\">\n            <Button size=\"lg\" variant=\"secondary\" data-testid=\"button-start-now\">\n              Start Now\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Button>\n          </a>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"py-8 px-4 sm:px-6 lg:px-8 border-t\">\n        <div className=\"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <GraduationCap className=\"h-5 w-5 text-primary\" />\n            <span className=\"font-semibold\">TrainFlow</span>\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            Enterprise Training Renewal & Employee Progression Platform\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":9961,"size_tokens":null},"client/src/pages/my-renewals.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { DataTable } from \"@/components/data-table\";\nimport { WorkflowTimeline, ProgressSteps } from \"@/components/workflow-timeline\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { \n  ClipboardCheck, \n  Search, \n  Plus,\n  Eye,\n  Clock,\n  FileText\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { RenewalRequest, Enrollment, Course, User } from \"@shared/schema\";\n\ninterface EnrollmentWithCourse extends Enrollment {\n  course: Course;\n}\n\ninterface RenewalWithDetails extends RenewalRequest {\n  enrollment: EnrollmentWithCourse;\n  requester?: User;\n  foreman?: User;\n  manager?: User;\n}\n\nfunction getApprovalStep(status: RenewalRequest[\"status\"]): number {\n  switch (status) {\n    case \"pending\":\n      return 1;\n    case \"foreman_approved\":\n      return 2;\n    case \"manager_approved\":\n    case \"completed\":\n      return 3;\n    case \"rejected\":\n      return -1;\n    default:\n      return 0;\n  }\n}\n\nexport default function MyRenewals() {\n  const [search, setSearch] = useState(\"\");\n  const [selectedRenewal, setSelectedRenewal] = useState<RenewalWithDetails | null>(null);\n  const [showNewDialog, setShowNewDialog] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: renewals = [], isLoading } = useQuery<RenewalWithDetails[]>({\n    queryKey: [\"/api/renewals/my\"],\n  });\n\n  const { data: myEnrollments = [] } = useQuery<EnrollmentWithCourse[]>({\n    queryKey: [\"/api/enrollments/my\"],\n  });\n  \n  const eligibleEnrollments = myEnrollments.filter((e) => {\n    const expiresAt = new Date(e.expiresAt);\n    const now = new Date();\n    const daysUntilExpiry = Math.ceil((expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n    return daysUntilExpiry <= 30;\n  });\n\n  const createRenewalMutation = useMutation({\n    mutationFn: async (data: { enrollmentId: number; urgencyLevel: string }) => {\n      return apiRequest(\"POST\", \"/api/renewals\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/renewals/my\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/enrollments/my\"] });\n      setShowNewDialog(false);\n      toast({\n        title: \"Request Submitted\",\n        description: \"Your renewal request has been submitted for approval.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit renewal request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredRenewals = renewals.filter((r) =>\n    r.enrollment?.course?.title.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const getTimelineSteps = (renewal: RenewalWithDetails) => {\n    const steps = [\n      {\n        id: \"submitted\",\n        title: \"Request Submitted\",\n        description: \"Renewal request created by employee\",\n        status: \"completed\" as const,\n        user: renewal.requester ? {\n          name: `${renewal.requester.firstName} ${renewal.requester.lastName}`,\n          avatar: renewal.requester.profileImageUrl || undefined,\n        } : undefined,\n        timestamp: renewal.createdAt,\n      },\n      {\n        id: \"foreman\",\n        title: \"Foreman Review\",\n        description: renewal.status === \"rejected\" && !renewal.foremanApprovedAt\n          ? \"Request was rejected\"\n          : renewal.foremanApprovedAt\n          ? \"Approved by foreman\"\n          : \"Awaiting foreman approval\",\n        status: renewal.foremanApprovedAt\n          ? \"completed\" as const\n          : renewal.status === \"rejected\"\n          ? \"rejected\" as const\n          : renewal.status === \"pending\"\n          ? \"current\" as const\n          : \"pending\" as const,\n        user: renewal.foreman ? {\n          name: `${renewal.foreman.firstName} ${renewal.foreman.lastName}`,\n          avatar: renewal.foreman.profileImageUrl || undefined,\n        } : undefined,\n        timestamp: renewal.foremanApprovedAt,\n        comments: renewal.foremanComments || undefined,\n      },\n      {\n        id: \"manager\",\n        title: \"Manager Approval\",\n        description: renewal.status === \"rejected\" && renewal.foremanApprovedAt\n          ? \"Request was rejected\"\n          : renewal.managerApprovedAt\n          ? \"Approved by manager\"\n          : \"Awaiting manager approval\",\n        status: renewal.managerApprovedAt\n          ? \"completed\" as const\n          : renewal.status === \"rejected\"\n          ? \"rejected\" as const\n          : renewal.status === \"foreman_approved\"\n          ? \"current\" as const\n          : \"pending\" as const,\n        user: renewal.manager ? {\n          name: `${renewal.manager.firstName} ${renewal.manager.lastName}`,\n          avatar: renewal.manager.profileImageUrl || undefined,\n        } : undefined,\n        timestamp: renewal.managerApprovedAt,\n        comments: renewal.managerComments || undefined,\n      },\n    ];\n\n    if (renewal.status === \"completed\" || renewal.status === \"manager_approved\") {\n      steps.push({\n        id: \"completed\",\n        title: \"Renewal Completed\",\n        description: \"Training renewal has been processed\",\n        status: \"completed\" as const,\n        timestamp: renewal.updatedAt,\n      });\n    }\n\n    return steps;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <ClipboardCheck className=\"h-6 w-6\" />\n            My Renewal Requests\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Track and manage your training renewal submissions\n          </p>\n        </div>\n        <Button onClick={() => setShowNewDialog(true)} data-testid=\"button-new-renewal\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          New Request\n        </Button>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search renewals...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          className=\"pl-10\"\n          data-testid=\"input-search-renewals\"\n        />\n      </div>\n\n      {/* Renewals List */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(3)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full\" />\n          ))}\n        </div>\n      ) : filteredRenewals.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <FileText className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground/30\" />\n            <h3 className=\"text-lg font-medium mb-2\">No renewal requests</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {search\n                ? \"Try adjusting your search\"\n                : \"You haven't submitted any renewal requests yet\"}\n            </p>\n            <Button onClick={() => setShowNewDialog(true)}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Create Your First Request\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {filteredRenewals.map((renewal) => (\n            <Card\n              key={renewal.id}\n              className=\"hover-elevate cursor-pointer\"\n              onClick={() => setSelectedRenewal(renewal)}\n              data-testid={`renewal-card-${renewal.id}`}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n                  <div className=\"space-y-1\">\n                    <h3 className=\"font-medium\">\n                      {renewal.enrollment?.course?.title}\n                    </h3>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Submitted {renewal.createdAt ? format(new Date(renewal.createdAt), \"MMM d, yyyy\") : \"\"}\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <StatusBadge status={renewal.status} />\n                    <Button variant=\"ghost\" size=\"sm\">\n                      <Eye className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"mt-4\">\n                  <ProgressSteps\n                    currentStep={getApprovalStep(renewal.status)}\n                    steps={[\"Submitted\", \"Foreman\", \"Manager\", \"Complete\"]}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* New Request Dialog */}\n      <Dialog open={showNewDialog} onOpenChange={setShowNewDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>New Renewal Request</DialogTitle>\n            <DialogDescription>\n              Select a course to request renewal for\n            </DialogDescription>\n          </DialogHeader>\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              const formData = new FormData(e.currentTarget);\n              const enrollmentId = parseInt(formData.get(\"enrollmentId\") as string);\n              const urgencyLevel = formData.get(\"urgencyLevel\") as string;\n              if (enrollmentId) {\n                createRenewalMutation.mutate({ enrollmentId, urgencyLevel });\n              }\n            }}\n            className=\"space-y-4\"\n          >\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"enrollmentId\">Course</Label>\n              <Select name=\"enrollmentId\" required>\n                <SelectTrigger data-testid=\"select-course\">\n                  <SelectValue placeholder=\"Select a course\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {eligibleEnrollments.length === 0 ? (\n                    <SelectItem value=\"none\" disabled>\n                      No courses eligible for renewal\n                    </SelectItem>\n                  ) : (\n                    eligibleEnrollments.map((enrollment) => (\n                      <SelectItem\n                        key={enrollment.id}\n                        value={enrollment.id.toString()}\n                      >\n                        {enrollment.course?.title}\n                      </SelectItem>\n                    ))\n                  )}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"urgencyLevel\">Urgency Level</Label>\n              <Select name=\"urgencyLevel\" defaultValue=\"normal\">\n                <SelectTrigger data-testid=\"select-urgency\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"low\">Low</SelectItem>\n                  <SelectItem value=\"normal\">Normal</SelectItem>\n                  <SelectItem value=\"high\">High</SelectItem>\n                  <SelectItem value=\"critical\">Critical</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewDialog(false)}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createRenewalMutation.isPending || eligibleEnrollments.length === 0}\n                data-testid=\"button-submit-renewal\"\n              >\n                {createRenewalMutation.isPending ? (\n                  <>\n                    <Clock className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Submitting...\n                  </>\n                ) : (\n                  \"Submit Request\"\n                )}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Detail Dialog */}\n      <Dialog open={!!selectedRenewal} onOpenChange={() => setSelectedRenewal(null)}>\n        <DialogContent className=\"sm:max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Renewal Request Details</DialogTitle>\n            <DialogDescription>\n              {selectedRenewal?.enrollment?.course?.title}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedRenewal && (\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center gap-2\">\n                <StatusBadge status={selectedRenewal.status} />\n                <span className=\"text-sm text-muted-foreground\">\n                  Request ID: #{selectedRenewal.id}\n                </span>\n              </div>\n              <WorkflowTimeline steps={getTimelineSteps(selectedRenewal)} />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":13834,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"enterprise-training-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","path":null,"size_bytes":1617,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { SidebarProvider, SidebarTrigger, SidebarInset } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { NotificationBell } from \"@/components/notification-bell\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport MyCourses from \"@/pages/my-courses\";\nimport MyRenewals from \"@/pages/my-renewals\";\nimport Approvals from \"@/pages/approvals\";\nimport Courses from \"@/pages/courses\";\nimport Enrollments from \"@/pages/enrollments\";\nimport Recommendations from \"@/pages/recommendations\";\nimport Progression from \"@/pages/progression\";\nimport Users from \"@/pages/users\";\nimport AuditLogs from \"@/pages/audit-logs\";\nimport Reports from \"@/pages/reports\";\n\nfunction LoadingScreen() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background\">\n      <div className=\"text-center space-y-4\">\n        <div className=\"w-16 h-16 mx-auto rounded-lg bg-primary/10 flex items-center justify-center animate-pulse\">\n          <div className=\"w-8 h-8 rounded-full bg-primary/30\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-32 mx-auto\" />\n          <Skeleton className=\"h-3 w-24 mx-auto\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction AuthenticatedLayout({ children }: { children: React.ReactNode }) {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full overflow-hidden\">\n        <AppSidebar />\n        <SidebarInset className=\"flex flex-col flex-1 overflow-hidden\">\n          <header className=\"flex items-center justify-between gap-4 px-4 h-14 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 flex-shrink-0\">\n            <div className=\"flex items-center gap-2\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <NotificationBell />\n              <ThemeToggle />\n            </div>\n          </header>\n          <main className=\"flex-1 overflow-auto p-6\">\n            <div className=\"max-w-7xl mx-auto\">\n              {children}\n            </div>\n          </main>\n        </SidebarInset>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return <LoadingScreen />;\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <Switch>\n        <Route path=\"/\" component={Landing} />\n        <Route component={Landing} />\n      </Switch>\n    );\n  }\n\n  return (\n    <AuthenticatedLayout>\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/my-courses\" component={MyCourses} />\n        <Route path=\"/my-renewals\" component={MyRenewals} />\n        <Route path=\"/approvals\" component={Approvals} />\n        <Route path=\"/courses\" component={Courses} />\n        <Route path=\"/enrollments\" component={Enrollments} />\n        <Route path=\"/recommendations\" component={Recommendations} />\n        <Route path=\"/progression\" component={Progression} />\n        <Route path=\"/users\" component={Users} />\n        <Route path=\"/audit-logs\" component={AuditLogs} />\n        <Route path=\"/reports\" component={Reports} />\n        <Route component={NotFound} />\n      </Switch>\n    </AuthenticatedLayout>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"light\" storageKey=\"trainflow-theme\">\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4299,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { \n  Clock, \n  CheckCircle2, \n  XCircle, \n  AlertTriangle,\n  Loader2,\n  CheckCheck\n} from \"lucide-react\";\n\ntype StatusType = \n  | \"pending\" \n  | \"foreman_approved\" \n  | \"manager_approved\" \n  | \"rejected\" \n  | \"completed\"\n  | \"active\"\n  | \"expired\"\n  | \"expiring_soon\"\n  | \"not_started\"\n  | \"in_progress\"\n  | \"blocked\";\n\ninterface StatusBadgeProps {\n  status: StatusType;\n  showIcon?: boolean;\n  size?: \"sm\" | \"default\";\n}\n\nconst statusConfig: Record<StatusType, {\n  label: string;\n  variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\";\n  className: string;\n  icon: React.ComponentType<{ className?: string }>;\n}> = {\n  pending: {\n    label: \"Pending\",\n    variant: \"secondary\",\n    className: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\",\n    icon: Clock,\n  },\n  foreman_approved: {\n    label: \"Foreman Approved\",\n    variant: \"secondary\",\n    className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n    icon: CheckCircle2,\n  },\n  manager_approved: {\n    label: \"Manager Approved\",\n    variant: \"secondary\",\n    className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n    icon: CheckCheck,\n  },\n  rejected: {\n    label: \"Rejected\",\n    variant: \"destructive\",\n    className: \"\",\n    icon: XCircle,\n  },\n  completed: {\n    label: \"Completed\",\n    variant: \"secondary\",\n    className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n    icon: CheckCircle2,\n  },\n  active: {\n    label: \"Active\",\n    variant: \"secondary\",\n    className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n    icon: CheckCircle2,\n  },\n  expired: {\n    label: \"Expired\",\n    variant: \"destructive\",\n    className: \"\",\n    icon: XCircle,\n  },\n  expiring_soon: {\n    label: \"Expiring Soon\",\n    variant: \"secondary\",\n    className: \"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400\",\n    icon: AlertTriangle,\n  },\n  not_started: {\n    label: \"Not Started\",\n    variant: \"outline\",\n    className: \"\",\n    icon: Clock,\n  },\n  in_progress: {\n    label: \"In Progress\",\n    variant: \"secondary\",\n    className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n    icon: Loader2,\n  },\n  blocked: {\n    label: \"Blocked\",\n    variant: \"destructive\",\n    className: \"\",\n    icon: AlertTriangle,\n  },\n};\n\nexport function StatusBadge({ status, showIcon = true, size = \"default\" }: StatusBadgeProps) {\n  const config = statusConfig[status];\n  if (!config) return null;\n\n  const Icon = config.icon;\n  const sizeClass = size === \"sm\" ? \"text-xs px-2 py-0.5\" : \"\";\n\n  return (\n    <Badge\n      variant={config.variant}\n      className={`${config.className} ${sizeClass} gap-1`}\n    >\n      {showIcon && <Icon className={size === \"sm\" ? \"h-3 w-3\" : \"h-3.5 w-3.5\"} />}\n      {config.label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":2900,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from 'drizzle-orm';\nimport {\n  index,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  boolean,\n  pgEnum,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums for the application\nexport const userRoleEnum = pgEnum('user_role', ['employee', 'foreman', 'manager', 'training_officer', 'administrator']);\nexport const renewalStatusEnum = pgEnum('renewal_status', ['pending', 'foreman_approved', 'manager_approved', 'rejected', 'completed']);\nexport const notificationTypeEnum = pgEnum('notification_type', ['expiry_warning', 'renewal_request', 'approval_needed', 'escalation', 'system']);\nexport const taskStatusEnum = pgEnum('task_status', ['not_started', 'in_progress', 'completed', 'blocked']);\nexport const auditActionEnum = pgEnum('audit_action', ['create', 'update', 'delete', 'login', 'logout', 'approve', 'reject', 'submit']);\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\n// User storage table with role-based access\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: userRoleEnum(\"role\").default('employee').notNull(),\n  departmentId: integer(\"department_id\"),\n  employeeNumber: varchar(\"employee_number\"),\n  jobTitle: varchar(\"job_title\"),\n  currentGrade: varchar(\"current_grade\"),\n  supervisorId: varchar(\"supervisor_id\"),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Departments table for organizational structure\nexport const departments = pgTable(\"departments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: varchar(\"name\").notNull(),\n  code: varchar(\"code\").notNull().unique(),\n  managerId: varchar(\"manager_id\"),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Training courses table\nexport const courses = pgTable(\"courses\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  category: varchar(\"category\").notNull(),\n  validityPeriodDays: integer(\"validity_period_days\").notNull(),\n  requiredForGrades: text(\"required_for_grades\").array(),\n  requiredForRoles: text(\"required_for_roles\").array(),\n  isMandatory: boolean(\"is_mandatory\").default(false),\n  provider: varchar(\"provider\"),\n  duration: varchar(\"duration\"),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Employee enrollments - tracks which courses employees are enrolled in\nexport const enrollments = pgTable(\"enrollments\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  courseId: integer(\"course_id\").notNull().references(() => courses.id),\n  enrolledAt: timestamp(\"enrolled_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  status: varchar(\"status\").default('active').notNull(),\n  certificateNumber: varchar(\"certificate_number\"),\n  score: integer(\"score\"),\n  tenantId: varchar(\"tenant_id\").default('default'),\n});\n\n// Renewal requests workflow\nexport const renewalRequests = pgTable(\"renewal_requests\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  enrollmentId: integer(\"enrollment_id\").notNull().references(() => enrollments.id),\n  requestedBy: varchar(\"requested_by\").notNull().references(() => users.id),\n  status: renewalStatusEnum(\"status\").default('pending').notNull(),\n  foremanId: varchar(\"foreman_id\").references(() => users.id),\n  foremanApprovedAt: timestamp(\"foreman_approved_at\"),\n  foremanComments: text(\"foreman_comments\"),\n  managerId: varchar(\"manager_id\").references(() => users.id),\n  managerApprovedAt: timestamp(\"manager_approved_at\"),\n  managerComments: text(\"manager_comments\"),\n  rejectedBy: varchar(\"rejected_by\").references(() => users.id),\n  rejectedAt: timestamp(\"rejected_at\"),\n  rejectionReason: text(\"rejection_reason\"),\n  urgencyLevel: varchar(\"urgency_level\").default('normal'),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Notifications for alerts\nexport const notifications = pgTable(\"notifications\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  type: notificationTypeEnum(\"type\").notNull(),\n  title: varchar(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  relatedEntityType: varchar(\"related_entity_type\"),\n  relatedEntityId: integer(\"related_entity_id\"),\n  isRead: boolean(\"is_read\").default(false),\n  daysUntilExpiry: integer(\"days_until_expiry\"),\n  escalationLevel: integer(\"escalation_level\").default(0),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Progression tasks for employee promotion tracking\nexport const progressionTasks = pgTable(\"progression_tasks\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  targetGrade: varchar(\"target_grade\").notNull(),\n  requiredCourseId: integer(\"required_course_id\").references(() => courses.id),\n  status: taskStatusEnum(\"status\").default('not_started').notNull(),\n  dueDate: timestamp(\"due_date\"),\n  completedAt: timestamp(\"completed_at\"),\n  assignedBy: varchar(\"assigned_by\").references(() => users.id),\n  priority: varchar(\"priority\").default('medium'),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Audit log for tracking all system actions\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  action: auditActionEnum(\"action\").notNull(),\n  entityType: varchar(\"entity_type\").notNull(),\n  entityId: varchar(\"entity_id\"),\n  oldValues: jsonb(\"old_values\"),\n  newValues: jsonb(\"new_values\"),\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// AI Recommendations for course suggestions\nexport const aiRecommendations = pgTable(\"ai_recommendations\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  courseId: integer(\"course_id\").notNull().references(() => courses.id),\n  reason: text(\"reason\").notNull(),\n  confidence: integer(\"confidence\"),\n  isAccepted: boolean(\"is_accepted\"),\n  isDismissed: boolean(\"is_dismissed\").default(false),\n  tenantId: varchar(\"tenant_id\").default('default'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  department: one(departments, {\n    fields: [users.departmentId],\n    references: [departments.id],\n  }),\n  supervisor: one(users, {\n    fields: [users.supervisorId],\n    references: [users.id],\n    relationName: \"supervisor\",\n  }),\n  enrollments: many(enrollments),\n  renewalRequests: many(renewalRequests, { relationName: \"requestedBy\" }),\n  notifications: many(notifications),\n  progressionTasks: many(progressionTasks),\n  aiRecommendations: many(aiRecommendations),\n}));\n\nexport const departmentsRelations = relations(departments, ({ one, many }) => ({\n  manager: one(users, {\n    fields: [departments.managerId],\n    references: [users.id],\n  }),\n  employees: many(users),\n}));\n\nexport const coursesRelations = relations(courses, ({ many }) => ({\n  enrollments: many(enrollments),\n  progressionTasks: many(progressionTasks),\n  aiRecommendations: many(aiRecommendations),\n}));\n\nexport const enrollmentsRelations = relations(enrollments, ({ one, many }) => ({\n  user: one(users, {\n    fields: [enrollments.userId],\n    references: [users.id],\n  }),\n  course: one(courses, {\n    fields: [enrollments.courseId],\n    references: [courses.id],\n  }),\n  renewalRequests: many(renewalRequests),\n}));\n\nexport const renewalRequestsRelations = relations(renewalRequests, ({ one }) => ({\n  enrollment: one(enrollments, {\n    fields: [renewalRequests.enrollmentId],\n    references: [enrollments.id],\n  }),\n  requester: one(users, {\n    fields: [renewalRequests.requestedBy],\n    references: [users.id],\n    relationName: \"requestedBy\",\n  }),\n  foreman: one(users, {\n    fields: [renewalRequests.foremanId],\n    references: [users.id],\n    relationName: \"foreman\",\n  }),\n  manager: one(users, {\n    fields: [renewalRequests.managerId],\n    references: [users.id],\n    relationName: \"manager\",\n  }),\n}));\n\nexport const notificationsRelations = relations(notifications, ({ one }) => ({\n  user: one(users, {\n    fields: [notifications.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const progressionTasksRelations = relations(progressionTasks, ({ one }) => ({\n  user: one(users, {\n    fields: [progressionTasks.userId],\n    references: [users.id],\n  }),\n  requiredCourse: one(courses, {\n    fields: [progressionTasks.requiredCourseId],\n    references: [courses.id],\n  }),\n  assigner: one(users, {\n    fields: [progressionTasks.assignedBy],\n    references: [users.id],\n    relationName: \"assigner\",\n  }),\n}));\n\nexport const aiRecommendationsRelations = relations(aiRecommendations, ({ one }) => ({\n  user: one(users, {\n    fields: [aiRecommendations.userId],\n    references: [users.id],\n  }),\n  course: one(courses, {\n    fields: [aiRecommendations.courseId],\n    references: [courses.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDepartmentSchema = createInsertSchema(departments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCourseSchema = createInsertSchema(courses).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEnrollmentSchema = createInsertSchema(enrollments).omit({\n  id: true,\n  enrolledAt: true,\n});\n\nexport const insertRenewalRequestSchema = createInsertSchema(renewalRequests).omit({\n  id: true,\n  requestedBy: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertProgressionTaskSchema = createInsertSchema(progressionTasks).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAiRecommendationSchema = createInsertSchema(aiRecommendations).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Department = typeof departments.$inferSelect;\nexport type InsertDepartment = z.infer<typeof insertDepartmentSchema>;\n\nexport type Course = typeof courses.$inferSelect;\nexport type InsertCourse = z.infer<typeof insertCourseSchema>;\n\nexport type Enrollment = typeof enrollments.$inferSelect;\nexport type InsertEnrollment = z.infer<typeof insertEnrollmentSchema>;\n\nexport type RenewalRequest = typeof renewalRequests.$inferSelect;\nexport type InsertRenewalRequest = z.infer<typeof insertRenewalRequestSchema>;\n\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n\nexport type ProgressionTask = typeof progressionTasks.$inferSelect;\nexport type InsertProgressionTask = z.infer<typeof insertProgressionTaskSchema>;\n\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\n\nexport type AiRecommendation = typeof aiRecommendations.$inferSelect;\nexport type InsertAiRecommendation = z.infer<typeof insertAiRecommendationSchema>;\n\n// User role type\nexport type UserRole = 'employee' | 'foreman' | 'manager' | 'training_officer' | 'administrator';\n","path":null,"size_bytes":13040,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - Carbon Design System Inspired */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 94.12%;\n  --foreground: 0 0% 10.2%;\n  --border: 0 0% 90.98%;\n  --card: 0 0% 98.82%;\n  --card-foreground: 0 0% 0%;\n  --card-border: 220 13% 92%;\n  --sidebar: 45 25% 97%;\n  --sidebar-foreground: 20 14% 17%;\n  --sidebar-border: 45 15% 80%;\n  --sidebar-primary: 9 75% 61%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 25 45% 80%;\n  --sidebar-accent-foreground: 20 14% 17%;\n  --sidebar-ring: 9 75% 61%;\n  --popover: 45 25% 97%;\n  --popover-foreground: 0 0% 100%;\n  --popover-border: 220 13% 90%;\n  --primary: 342 85.11% 52.55%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 0 0% 76.86%;\n  --secondary-foreground: 0 0% 10.2%;\n  --muted: 0 0% 89.02%;\n  --muted-foreground: 0 0% 12.94%;\n  --accent: 0 0% 100%;\n  --accent-foreground: 0 0% 10.2%;\n  --destructive: 0 0% 0%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 0 0% 70.98%;\n  --ring: 0 0% 41.96%;\n  --chart-1: 203.8863 88.2845% 53.1373%;\n  --chart-2: 159.7826 100% 36.0784%;\n  --chart-3: 42.0290 92.8251% 56.2745%;\n  --chart-4: 147.1429 78.5047% 41.9608%;\n  --chart-5: 341.4894 75.2000% 50.9804%;\n  --font-sans: 'Poppins', sans-serif;\n  --font-serif: 'Poppins', sans-serif;\n  --font-mono: Menlo, monospace;\n  --radius: 0.8rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00), 0px 1px 2px -1px hsl(9, 75%, 61% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00), 0px 1px 2px -1px hsl(9, 75%, 61% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00), 0px 2px 4px -1px hsl(9, 75%, 61% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00), 0px 4px 6px -1px hsl(9, 75%, 61% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00), 0px 8px 10px -1px hsl(9, 75%, 61% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(9, 75%, 61% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 20 14% 4%;\n  --foreground: 45 25% 91%;\n  --border: 20 14% 15%;\n  --card: 20 14% 8%;\n  --card-foreground: 45 25% 85%;\n  --card-border: 220 14% 16%;\n  --sidebar: 20 14% 8%;\n  --sidebar-foreground: 45 25% 85%;\n  --sidebar-border: 20 14% 15%;\n  --sidebar-primary: 9 75% 61%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 25 45% 20%;\n  --sidebar-accent-foreground: 45 25% 85%;\n  --sidebar-ring: 9 75% 61%;\n  --popover: 20 14% 4%;\n  --popover-foreground: 45 25% 91%;\n  --popover-border: 220 14% 18%;\n  --primary: 9 75% 61%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 30 15% 52%;\n  --secondary-foreground: 0 0% 100%;\n  --muted: 20 14% 15%;\n  --muted-foreground: 45 15% 46%;\n  --accent: 25 45% 20%;\n  --accent-foreground: 45 25% 85%;\n  --destructive: 356.3033 90.5579% 54.3137%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 20 14% 18%;\n  --ring: 9 75% 61%;\n  --chart-1: 203.8863 88.2845% 53.1373%;\n  --chart-2: 159.7826 100% 36.0784%;\n  --chart-3: 42.0290 92.8251% 56.2745%;\n  --chart-4: 147.1429 78.5047% 41.9608%;\n  --chart-5: 341.4894 75.2000% 50.9804%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(9 75% 61% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(9 75% 61% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(9 75% 61% / 0.00), 0px 1px 2px -1px hsl(9 75% 61% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(9 75% 61% / 0.00), 0px 1px 2px -1px hsl(9 75% 61% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(9 75% 61% / 0.00), 0px 2px 4px -1px hsl(9 75% 61% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(9 75% 61% / 0.00), 0px 4px 6px -1px hsl(9 75% 61% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(9 75% 61% / 0.00), 0px 8px 10px -1px hsl(9 75% 61% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(9 75% 61% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":11037,"size_tokens":null},"client/src/pages/courses.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { \n  BookOpen, \n  Search, \n  Plus,\n  Edit,\n  Trash2,\n  Clock,\n  Users,\n  Calendar\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { Course } from \"@shared/schema\";\n\nconst courseSchema = z.object({\n  title: z.string().min(1, \"Title is required\"),\n  description: z.string().optional(),\n  category: z.string().min(1, \"Category is required\"),\n  validityPeriodDays: z.coerce.number().min(1, \"Validity period must be at least 1 day\"),\n  provider: z.string().optional(),\n  duration: z.string().optional(),\n  isMandatory: z.boolean().default(false),\n});\n\ntype CourseFormData = z.infer<typeof courseSchema>;\n\nconst categories = [\n  \"Safety & Compliance\",\n  \"Technical Skills\",\n  \"Leadership & Management\",\n  \"Regulatory\",\n  \"Equipment Operation\",\n  \"Emergency Response\",\n  \"Environmental\",\n  \"Quality Assurance\",\n  \"Other\",\n];\n\nexport default function Courses() {\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingCourse, setEditingCourse] = useState<Course | null>(null);\n\n  const form = useForm<CourseFormData>({\n    resolver: zodResolver(courseSchema),\n    defaultValues: {\n      title: \"\",\n      description: \"\",\n      category: \"\",\n      validityPeriodDays: 365,\n      provider: \"\",\n      duration: \"\",\n      isMandatory: false,\n    },\n  });\n\n  const { data: courses = [], isLoading } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: CourseFormData) => {\n      return apiRequest(\"POST\", \"/api/courses\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/courses\"] });\n      setShowDialog(false);\n      form.reset();\n      toast({\n        title: \"Course Created\",\n        description: \"The training course has been created successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create course. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: CourseFormData & { id: number }) => {\n      return apiRequest(\"PATCH\", `/api/courses/${data.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/courses\"] });\n      setShowDialog(false);\n      setEditingCourse(null);\n      form.reset();\n      toast({\n        title: \"Course Updated\",\n        description: \"The training course has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update course. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredCourses = courses.filter((c) =>\n    c.title.toLowerCase().includes(search.toLowerCase()) ||\n    c.category.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const handleEdit = (course: Course) => {\n    setEditingCourse(course);\n    form.reset({\n      title: course.title,\n      description: course.description || \"\",\n      category: course.category,\n      validityPeriodDays: course.validityPeriodDays,\n      provider: course.provider || \"\",\n      duration: course.duration || \"\",\n      isMandatory: course.isMandatory || false,\n    });\n    setShowDialog(true);\n  };\n\n  const handleClose = () => {\n    setShowDialog(false);\n    setEditingCourse(null);\n    form.reset();\n  };\n\n  const onSubmit = (data: CourseFormData) => {\n    if (editingCourse) {\n      updateMutation.mutate({ ...data, id: editingCourse.id });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <BookOpen className=\"h-6 w-6\" />\n            Course Management\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Create and manage training courses\n          </p>\n        </div>\n        <Button onClick={() => setShowDialog(true)} data-testid=\"button-add-course\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Add Course\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{courses.length}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Courses</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">\n              {courses.filter((c) => c.isMandatory).length}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Mandatory</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">\n              {courses.filter((c) => c.isActive).length}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Active</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">\n              {new Set(courses.map((c) => c.category)).size}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Categories</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search courses...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          className=\"pl-10\"\n          data-testid=\"input-search-courses\"\n        />\n      </div>\n\n      {/* Courses List */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full\" />\n          ))}\n        </div>\n      ) : (\n        <DataTable\n          columns={[\n            {\n              key: \"title\",\n              header: \"Course\",\n              cell: (row) => (\n                <div>\n                  <p className=\"font-medium\">{row.title}</p>\n                  <p className=\"text-sm text-muted-foreground line-clamp-1\">\n                    {row.description || \"No description\"}\n                  </p>\n                </div>\n              ),\n            },\n            {\n              key: \"category\",\n              header: \"Category\",\n              cell: (row) => (\n                <span className=\"text-sm\">{row.category}</span>\n              ),\n            },\n            {\n              key: \"validity\",\n              header: \"Validity\",\n              cell: (row) => (\n                <div className=\"flex items-center gap-1 text-sm\">\n                  <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                  {row.validityPeriodDays} days\n                </div>\n              ),\n            },\n            {\n              key: \"type\",\n              header: \"Type\",\n              cell: (row) => (\n                <StatusBadge\n                  status={row.isMandatory ? \"completed\" : \"pending\"}\n                  size=\"sm\"\n                  showIcon={false}\n                />\n              ),\n            },\n            {\n              key: \"status\",\n              header: \"Status\",\n              cell: (row) => (\n                <StatusBadge\n                  status={row.isActive ? \"active\" : \"expired\"}\n                  size=\"sm\"\n                />\n              ),\n            },\n            {\n              key: \"actions\",\n              header: \"\",\n              cell: (row) => (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleEdit(row);\n                  }}\n                  data-testid={`button-edit-${row.id}`}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              ),\n              className: \"text-right\",\n            },\n          ]}\n          data={filteredCourses}\n          emptyMessage=\"No courses found\"\n        />\n      )}\n\n      {/* Create/Edit Dialog */}\n      <Dialog open={showDialog} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingCourse ? \"Edit Course\" : \"Create New Course\"}\n            </DialogTitle>\n            <DialogDescription>\n              {editingCourse\n                ? \"Update the course details below\"\n                : \"Fill in the details to create a new training course\"}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Course Title</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder=\"e.g., Safety Fundamentals\"\n                        data-testid=\"input-course-title\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        {...field}\n                        placeholder=\"Course description...\"\n                        data-testid=\"input-course-description\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"category\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Category</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        value={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-category\">\n                            <SelectValue placeholder=\"Select category\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {categories.map((cat) => (\n                            <SelectItem key={cat} value={cat}>\n                              {cat}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"validityPeriodDays\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Validity (days)</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          type=\"number\"\n                          min=\"1\"\n                          data-testid=\"input-validity\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"provider\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Provider</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Training provider\"\n                          data-testid=\"input-provider\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"duration\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Duration</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"e.g., 2 hours\"\n                          data-testid=\"input-duration\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"isMandatory\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between rounded-lg border p-4\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel>Mandatory Course</FormLabel>\n                      <FormDescription>\n                        All employees must complete this course\n                      </FormDescription>\n                    </div>\n                    <FormControl>\n                      <Switch\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        data-testid=\"switch-mandatory\"\n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={handleClose}>\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-course\"\n                >\n                  {createMutation.isPending || updateMutation.isPending ? (\n                    <>\n                      <Clock className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : editingCourse ? (\n                    \"Update Course\"\n                  ) : (\n                    \"Create Course\"\n                  )}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":16470,"size_tokens":null},"client/src/pages/enrollments.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { \n  Users, \n  Search, \n  Plus,\n  Clock,\n  BookOpen,\n  CalendarIcon,\n  Award\n} from \"lucide-react\";\nimport { format, addDays, differenceInDays } from \"date-fns\";\nimport type { Enrollment, Course, User } from \"@shared/schema\";\n\ninterface EnrollmentWithDetails extends Enrollment {\n  course: Course;\n  user: User;\n}\n\nfunction getEnrollmentStatus(enrollment: EnrollmentWithDetails): \"active\" | \"expiring_soon\" | \"expired\" {\n  const daysUntilExpiry = differenceInDays(new Date(enrollment.expiresAt), new Date());\n  if (daysUntilExpiry < 0) return \"expired\";\n  if (daysUntilExpiry <= 30) return \"expiring_soon\";\n  return \"active\";\n}\n\nexport default function Enrollments() {\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [showDialog, setShowDialog] = useState(false);\n  const [selectedUser, setSelectedUser] = useState(\"\");\n  const [selectedCourse, setSelectedCourse] = useState(\"\");\n  const [expiryDate, setExpiryDate] = useState<Date>();\n  const [certificateNumber, setCertificateNumber] = useState(\"\");\n\n  const { data: enrollments = [], isLoading } = useQuery<EnrollmentWithDetails[]>({\n    queryKey: [\"/api/enrollments\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: courses = [] } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: {\n      userId: string;\n      courseId: number;\n      expiresAt: Date;\n      certificateNumber?: string;\n    }) => {\n      return apiRequest(\"POST\", \"/api/enrollments\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enrollments\"] });\n      handleClose();\n      toast({\n        title: \"Enrollment Created\",\n        description: \"The employee has been enrolled in the course.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create enrollment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleClose = () => {\n    setShowDialog(false);\n    setSelectedUser(\"\");\n    setSelectedCourse(\"\");\n    setExpiryDate(undefined);\n    setCertificateNumber(\"\");\n  };\n\n  const handleCourseChange = (courseId: string) => {\n    setSelectedCourse(courseId);\n    const course = courses.find((c) => c.id.toString() === courseId);\n    if (course) {\n      setExpiryDate(addDays(new Date(), course.validityPeriodDays));\n    }\n  };\n\n  const handleSubmit = () => {\n    if (!selectedUser || !selectedCourse || !expiryDate) return;\n\n    createMutation.mutate({\n      userId: selectedUser,\n      courseId: parseInt(selectedCourse),\n      expiresAt: expiryDate,\n      certificateNumber: certificateNumber || undefined,\n    });\n  };\n\n  const filteredEnrollments = enrollments.filter((e) =>\n    e.course?.title.toLowerCase().includes(search.toLowerCase()) ||\n    `${e.user?.firstName} ${e.user?.lastName}`.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const stats = {\n    total: enrollments.length,\n    active: enrollments.filter((e) => getEnrollmentStatus(e) === \"active\").length,\n    expiring: enrollments.filter((e) => getEnrollmentStatus(e) === \"expiring_soon\").length,\n    expired: enrollments.filter((e) => getEnrollmentStatus(e) === \"expired\").length,\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <Users className=\"h-6 w-6\" />\n            Enrollment Management\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Enroll employees in training courses\n          </p>\n        </div>\n        <Button onClick={() => setShowDialog(true)} data-testid=\"button-add-enrollment\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          New Enrollment\n        </Button>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Enrollments</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-chart-2\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-2\">{stats.active}</div>\n            <p className=\"text-sm text-muted-foreground\">Active</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-yellow-500\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-yellow-600\">{stats.expiring}</div>\n            <p className=\"text-sm text-muted-foreground\">Expiring Soon</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-destructive\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-destructive\">{stats.expired}</div>\n            <p className=\"text-sm text-muted-foreground\">Expired</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search enrollments...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          className=\"pl-10\"\n          data-testid=\"input-search-enrollments\"\n        />\n      </div>\n\n      {/* Enrollments List */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <Skeleton key={i} className=\"h-20 w-full\" />\n          ))}\n        </div>\n      ) : (\n        <DataTable\n          columns={[\n            {\n              key: \"employee\",\n              header: \"Employee\",\n              cell: (row) => (\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-9 w-9\">\n                    <AvatarImage\n                      src={row.user?.profileImageUrl || undefined}\n                      className=\"object-cover\"\n                    />\n                    <AvatarFallback>\n                      {row.user?.firstName?.[0]}\n                      {row.user?.lastName?.[0]}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <p className=\"font-medium\">\n                      {row.user?.firstName} {row.user?.lastName}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {row.user?.email}\n                    </p>\n                  </div>\n                </div>\n              ),\n            },\n            {\n              key: \"course\",\n              header: \"Course\",\n              cell: (row) => (\n                <div>\n                  <p className=\"font-medium\">{row.course?.title}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {row.course?.category}\n                  </p>\n                </div>\n              ),\n            },\n            {\n              key: \"expires\",\n              header: \"Expires\",\n              cell: (row) => (\n                <div className=\"text-sm\">\n                  <p>{format(new Date(row.expiresAt), \"MMM d, yyyy\")}</p>\n                  <p className=\"text-muted-foreground\">\n                    {differenceInDays(new Date(row.expiresAt), new Date())} days\n                  </p>\n                </div>\n              ),\n            },\n            {\n              key: \"certificate\",\n              header: \"Certificate\",\n              cell: (row) => (\n                row.certificateNumber ? (\n                  <span className=\"text-sm font-mono\">{row.certificateNumber}</span>\n                ) : (\n                  <span className=\"text-sm text-muted-foreground\">-</span>\n                )\n              ),\n            },\n            {\n              key: \"status\",\n              header: \"Status\",\n              cell: (row) => (\n                <StatusBadge status={getEnrollmentStatus(row)} size=\"sm\" />\n              ),\n            },\n          ]}\n          data={filteredEnrollments}\n          emptyMessage=\"No enrollments found\"\n        />\n      )}\n\n      {/* New Enrollment Dialog */}\n      <Dialog open={showDialog} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>New Enrollment</DialogTitle>\n            <DialogDescription>\n              Enroll an employee in a training course\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Employee</Label>\n              <Select value={selectedUser} onValueChange={setSelectedUser}>\n                <SelectTrigger data-testid=\"select-employee\">\n                  <SelectValue placeholder=\"Select an employee\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {users.map((user) => (\n                    <SelectItem key={user.id} value={user.id}>\n                      <div className=\"flex items-center gap-2\">\n                        <Avatar className=\"h-6 w-6\">\n                          <AvatarImage\n                            src={user.profileImageUrl || undefined}\n                            className=\"object-cover\"\n                          />\n                          <AvatarFallback className=\"text-xs\">\n                            {user.firstName?.[0]}\n                            {user.lastName?.[0]}\n                          </AvatarFallback>\n                        </Avatar>\n                        <span>\n                          {user.firstName} {user.lastName}\n                        </span>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Course</Label>\n              <Select value={selectedCourse} onValueChange={handleCourseChange}>\n                <SelectTrigger data-testid=\"select-course\">\n                  <SelectValue placeholder=\"Select a course\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {courses.map((course) => (\n                    <SelectItem key={course.id} value={course.id.toString()}>\n                      <div className=\"flex items-center gap-2\">\n                        <BookOpen className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{course.title}</span>\n                        <span className=\"text-xs text-muted-foreground\">\n                          ({course.validityPeriodDays} days)\n                        </span>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Expiry Date</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !expiryDate && \"text-muted-foreground\"\n                    )}\n                    data-testid=\"button-expiry-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {expiryDate ? format(expiryDate, \"PPP\") : \"Pick a date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={expiryDate}\n                    onSelect={setExpiryDate}\n                    disabled={(date) => date < new Date()}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Certificate Number (optional)</Label>\n              <div className=\"relative\">\n                <Award className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  value={certificateNumber}\n                  onChange={(e) => setCertificateNumber(e.target.value)}\n                  placeholder=\"e.g., CERT-2024-001\"\n                  className=\"pl-10\"\n                  data-testid=\"input-certificate\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={handleClose}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={\n                !selectedUser ||\n                !selectedCourse ||\n                !expiryDate ||\n                createMutation.isPending\n              }\n              data-testid=\"button-create-enrollment\"\n            >\n              {createMutation.isPending ? (\n                <>\n                  <Clock className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Creating...\n                </>\n              ) : (\n                \"Create Enrollment\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14717,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"// Auth utilities for handling unauthorized errors\n// Reference: javascript_log_in_with_replit blueprint\nexport function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":221,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/notification-bell.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Bell, AlertTriangle, Clock, CheckCircle2, Info } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { Notification } from \"@shared/schema\";\n\nfunction getNotificationIcon(type: Notification[\"type\"]) {\n  switch (type) {\n    case \"expiry_warning\":\n      return <Clock className=\"h-4 w-4 text-yellow-500\" />;\n    case \"escalation\":\n      return <AlertTriangle className=\"h-4 w-4 text-destructive\" />;\n    case \"renewal_request\":\n    case \"approval_needed\":\n      return <CheckCircle2 className=\"h-4 w-4 text-chart-2\" />;\n    default:\n      return <Info className=\"h-4 w-4 text-chart-1\" />;\n  }\n}\n\nexport function NotificationBell() {\n  const [open, setOpen] = useState(false);\n\n  const { data: notifications = [], isLoading } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 30000,\n  });\n\n  const unreadCount = notifications.filter((n) => !n.isRead).length;\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"relative\"\n          data-testid=\"button-notifications\"\n        >\n          <Bell className=\"h-4 w-4\" />\n          {unreadCount > 0 && (\n            <Badge\n              variant=\"destructive\"\n              className=\"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </Badge>\n          )}\n          <span className=\"sr-only\">Notifications</span>\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent align=\"end\" className=\"w-80 p-0\">\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <h3 className=\"font-semibold\">Notifications</h3>\n          {unreadCount > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {unreadCount} new\n            </Badge>\n          )}\n        </div>\n        <ScrollArea className=\"h-80\">\n          {isLoading ? (\n            <div className=\"p-4 text-center text-muted-foreground text-sm\">\n              Loading notifications...\n            </div>\n          ) : notifications.length === 0 ? (\n            <div className=\"p-8 text-center\">\n              <Bell className=\"h-8 w-8 mx-auto mb-3 text-muted-foreground/50\" />\n              <p className=\"text-muted-foreground text-sm\">\n                No notifications yet\n              </p>\n            </div>\n          ) : (\n            <div className=\"divide-y\">\n              {notifications.slice(0, 10).map((notification) => (\n                <div\n                  key={notification.id}\n                  className={`p-4 hover-elevate cursor-pointer ${\n                    !notification.isRead ? \"bg-primary/5\" : \"\"\n                  }`}\n                  data-testid={`notification-item-${notification.id}`}\n                >\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex-shrink-0 mt-0.5\">\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium truncate\">\n                        {notification.title}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                        {notification.message}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {notification.createdAt\n                          ? formatDistanceToNow(new Date(notification.createdAt), {\n                              addSuffix: true,\n                            })\n                          : \"Just now\"}\n                      </p>\n                    </div>\n                    {!notification.isRead && (\n                      <div className=\"w-2 h-2 rounded-full bg-primary flex-shrink-0 mt-2\" />\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n        {notifications.length > 0 && (\n          <div className=\"p-2 border-t\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"w-full\"\n              data-testid=\"button-view-all-notifications\"\n            >\n              View All Notifications\n            </Button>\n          </div>\n        )}\n      </PopoverContent>\n    </Popover>\n  );\n}\n","path":null,"size_bytes":4814,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/pages/users.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { \n  Users, \n  Search, \n  Edit,\n  Clock,\n  Shield\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { User, UserRole } from \"@shared/schema\";\n\nconst roleOptions: { value: UserRole; label: string; color: string }[] = [\n  { value: \"employee\", label: \"Employee\", color: \"bg-chart-1/10 text-chart-1\" },\n  { value: \"foreman\", label: \"Foreman\", color: \"bg-chart-2/10 text-chart-2\" },\n  { value: \"manager\", label: \"Manager\", color: \"bg-chart-3/10 text-chart-3\" },\n  { value: \"training_officer\", label: \"Training Officer\", color: \"bg-chart-4/10 text-chart-4\" },\n  { value: \"administrator\", label: \"Administrator\", color: \"bg-chart-5/10 text-chart-5\" },\n];\n\nfunction getRoleBadge(role: UserRole) {\n  const option = roleOptions.find((r) => r.value === role);\n  return (\n    <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${option?.color || \"\"}`}>\n      {option?.label || role}\n    </span>\n  );\n}\n\nexport default function UserManagement() {\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [editingUser, setEditingUser] = useState<User | null>(null);\n  const [selectedRole, setSelectedRole] = useState<UserRole | \"\">(\"\");\n\n  const { data: users = [], isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const updateRoleMutation = useMutation({\n    mutationFn: async (data: { id: string; role: UserRole }) => {\n      return apiRequest(\"PATCH\", `/api/users/${data.id}/role`, { role: data.role });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setEditingUser(null);\n      setSelectedRole(\"\");\n      toast({\n        title: \"Role Updated\",\n        description: \"User role has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update user role. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredUsers = users.filter((u) =>\n    `${u.firstName} ${u.lastName}`.toLowerCase().includes(search.toLowerCase()) ||\n    u.email?.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const stats = {\n    total: users.length,\n    employees: users.filter((u) => u.role === \"employee\").length,\n    supervisors: users.filter((u) => u.role === \"foreman\" || u.role === \"manager\").length,\n    admins: users.filter((u) => u.role === \"training_officer\" || u.role === \"administrator\").length,\n  };\n\n  const handleEdit = (user: User) => {\n    setEditingUser(user);\n    setSelectedRole(user.role);\n  };\n\n  const handleSave = () => {\n    if (editingUser && selectedRole) {\n      updateRoleMutation.mutate({ id: editingUser.id, role: selectedRole });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n          <Users className=\"h-6 w-6\" />\n          User Management\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Manage user accounts and role assignments\n        </p>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Users</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-1\">{stats.employees}</div>\n            <p className=\"text-sm text-muted-foreground\">Employees</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-2\">{stats.supervisors}</div>\n            <p className=\"text-sm text-muted-foreground\">Supervisors</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-4\">{stats.admins}</div>\n            <p className=\"text-sm text-muted-foreground\">Admin Staff</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search users...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          className=\"pl-10\"\n          data-testid=\"input-search-users\"\n        />\n      </div>\n\n      {/* Users List */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <Skeleton key={i} className=\"h-20 w-full\" />\n          ))}\n        </div>\n      ) : (\n        <DataTable\n          columns={[\n            {\n              key: \"user\",\n              header: \"User\",\n              cell: (row) => (\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-10 w-10\">\n                    <AvatarImage\n                      src={row.profileImageUrl || undefined}\n                      className=\"object-cover\"\n                    />\n                    <AvatarFallback>\n                      {row.firstName?.[0]}\n                      {row.lastName?.[0]}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <p className=\"font-medium\">\n                      {row.firstName} {row.lastName}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {row.email}\n                    </p>\n                  </div>\n                </div>\n              ),\n            },\n            {\n              key: \"role\",\n              header: \"Role\",\n              cell: (row) => getRoleBadge(row.role),\n            },\n            {\n              key: \"jobTitle\",\n              header: \"Job Title\",\n              cell: (row) => row.jobTitle || \"-\",\n            },\n            {\n              key: \"grade\",\n              header: \"Grade\",\n              cell: (row) => row.currentGrade || \"-\",\n            },\n            {\n              key: \"joined\",\n              header: \"Joined\",\n              cell: (row) =>\n                row.createdAt\n                  ? format(new Date(row.createdAt), \"MMM d, yyyy\")\n                  : \"-\",\n            },\n            {\n              key: \"status\",\n              header: \"Status\",\n              cell: (row) => (\n                <Badge variant={row.isActive ? \"secondary\" : \"outline\"}>\n                  {row.isActive ? \"Active\" : \"Inactive\"}\n                </Badge>\n              ),\n            },\n            {\n              key: \"actions\",\n              header: \"\",\n              cell: (row) => (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleEdit(row);\n                  }}\n                  data-testid={`button-edit-${row.id}`}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              ),\n              className: \"text-right\",\n            },\n          ]}\n          data={filteredUsers}\n          emptyMessage=\"No users found\"\n        />\n      )}\n\n      {/* Edit Role Dialog */}\n      <Dialog open={!!editingUser} onOpenChange={() => setEditingUser(null)}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit User Role</DialogTitle>\n            <DialogDescription>\n              Update the role for {editingUser?.firstName} {editingUser?.lastName}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50\">\n              <Avatar className=\"h-12 w-12\">\n                <AvatarImage\n                  src={editingUser?.profileImageUrl || undefined}\n                  className=\"object-cover\"\n                />\n                <AvatarFallback>\n                  {editingUser?.firstName?.[0]}\n                  {editingUser?.lastName?.[0]}\n                </AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"font-medium\">\n                  {editingUser?.firstName} {editingUser?.lastName}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {editingUser?.email}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Role</Label>\n              <Select\n                value={selectedRole}\n                onValueChange={(v) => setSelectedRole(v as UserRole)}\n              >\n                <SelectTrigger data-testid=\"select-role\">\n                  <SelectValue placeholder=\"Select a role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {roleOptions.map((role) => (\n                    <SelectItem key={role.value} value={role.value}>\n                      <div className=\"flex items-center gap-2\">\n                        <Shield className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{role.label}</span>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditingUser(null)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSave}\n              disabled={!selectedRole || updateRoleMutation.isPending}\n              data-testid=\"button-save-role\"\n            >\n              {updateRoleMutation.isPending ? (\n                <>\n                  <Clock className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Saving...\n                </>\n              ) : (\n                \"Save Changes\"\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":11206,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/db.ts":{"content":"// PostgreSQL database connection using Neon serverless driver\n// Reference: javascript_database blueprint\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":590,"size_tokens":null},"client/src/components/kpi-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown, Minus } from \"lucide-react\";\n\ninterface KPICardProps {\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  icon?: React.ReactNode;\n  trend?: {\n    value: number;\n    label: string;\n  };\n  variant?: \"default\" | \"warning\" | \"success\" | \"danger\";\n}\n\nexport function KPICard({\n  title,\n  value,\n  subtitle,\n  icon,\n  trend,\n  variant = \"default\",\n}: KPICardProps) {\n  const getTrendIcon = () => {\n    if (!trend) return null;\n    if (trend.value > 0) return <TrendingUp className=\"h-3 w-3\" />;\n    if (trend.value < 0) return <TrendingDown className=\"h-3 w-3\" />;\n    return <Minus className=\"h-3 w-3\" />;\n  };\n\n  const getTrendColor = () => {\n    if (!trend) return \"\";\n    if (trend.value > 0) return \"text-chart-2\";\n    if (trend.value < 0) return \"text-destructive\";\n    return \"text-muted-foreground\";\n  };\n\n  const getVariantStyles = () => {\n    switch (variant) {\n      case \"warning\":\n        return \"border-l-4 border-l-yellow-500\";\n      case \"success\":\n        return \"border-l-4 border-l-chart-2\";\n      case \"danger\":\n        return \"border-l-4 border-l-destructive\";\n      default:\n        return \"\";\n    }\n  };\n\n  return (\n    <Card className={`${getVariantStyles()} hover-elevate`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n        {icon && (\n          <div className=\"text-muted-foreground/50\">{icon}</div>\n        )}\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-3xl font-bold tracking-tight\" data-testid={`kpi-value-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n          {value}\n        </div>\n        <div className=\"flex items-center justify-between mt-1\">\n          {subtitle && (\n            <p className=\"text-xs text-muted-foreground\">{subtitle}</p>\n          )}\n          {trend && (\n            <div className={`flex items-center gap-1 text-xs ${getTrendColor()}`}>\n              {getTrendIcon()}\n              <span>\n                {trend.value > 0 ? \"+\" : \"\"}\n                {trend.value}% {trend.label}\n              </span>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2352,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/approvals.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { WorkflowTimeline } from \"@/components/workflow-timeline\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { \n  ClipboardCheck, \n  Search, \n  CheckCircle2,\n  XCircle,\n  Clock,\n  User,\n  BookOpen,\n  Calendar,\n  AlertTriangle\n} from \"lucide-react\";\nimport { format, differenceInDays } from \"date-fns\";\nimport type { RenewalRequest, Enrollment, Course, User as UserType } from \"@shared/schema\";\n\ninterface EnrollmentWithCourse extends Enrollment {\n  course: Course;\n}\n\ninterface RenewalWithDetails extends RenewalRequest {\n  enrollment: EnrollmentWithCourse;\n  requester?: UserType;\n  foreman?: UserType;\n  manager?: UserType;\n}\n\nexport default function Approvals() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"pending\");\n  const [selectedRenewal, setSelectedRenewal] = useState<RenewalWithDetails | null>(null);\n  const [comments, setComments] = useState(\"\");\n  const [showRejectDialog, setShowRejectDialog] = useState(false);\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n\n  const isManager = user?.role === \"manager\";\n  const isForeman = user?.role === \"foreman\";\n\n  const { data: pendingApprovals = [], isLoading: pendingLoading } = useQuery<RenewalWithDetails[]>({\n    queryKey: [\"/api/renewals/pending\"],\n  });\n\n  const { data: allRenewals = [], isLoading: processedLoading } = useQuery<RenewalWithDetails[]>({\n    queryKey: [\"/api/renewals\"],\n  });\n\n  const processedApprovals = allRenewals.filter(r => \n    r.status === 'manager_approved' || r.status === 'rejected' || r.status === 'completed'\n  );\n\n  const approveMutation = useMutation({\n    mutationFn: async (data: { id: number; comments: string }) => {\n      return apiRequest(\"POST\", `/api/renewals/${data.id}/approve`, { comments: data.comments });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/renewals\"] });\n      setSelectedRenewal(null);\n      setComments(\"\");\n      toast({\n        title: \"Request Approved\",\n        description: \"The renewal request has been approved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to approve the request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async (data: { id: number; reason: string }) => {\n      return apiRequest(\"POST\", `/api/renewals/${data.id}/reject`, { reason: data.reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/renewals\"] });\n      setSelectedRenewal(null);\n      setShowRejectDialog(false);\n      setRejectionReason(\"\");\n      toast({\n        title: \"Request Rejected\",\n        description: \"The renewal request has been rejected.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to reject the request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filterRenewals = (renewals: RenewalWithDetails[]) => {\n    return renewals.filter((r) =>\n      r.enrollment?.course?.title.toLowerCase().includes(search.toLowerCase()) ||\n      `${r.requester?.firstName} ${r.requester?.lastName}`.toLowerCase().includes(search.toLowerCase())\n    );\n  };\n\n  const getUrgencyBadge = (level: string | null) => {\n    switch (level) {\n      case \"critical\":\n        return <span className=\"text-xs px-2 py-0.5 rounded-full bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400\">Critical</span>;\n      case \"high\":\n        return <span className=\"text-xs px-2 py-0.5 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400\">High</span>;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n          <ClipboardCheck className=\"h-6 w-6\" />\n          Approval Queue\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Review and process renewal requests from your team\n        </p>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search by employee or course...\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          className=\"pl-10\"\n          data-testid=\"input-search-approvals\"\n        />\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">\n            Pending ({pendingApprovals.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"processed\" data-testid=\"tab-processed\">\n            Processed\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"pending\" className=\"mt-6\">\n          {pendingLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-32 w-full\" />\n              ))}\n            </div>\n          ) : filterRenewals(pendingApprovals).length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <CheckCircle2 className=\"h-12 w-12 mx-auto mb-4 text-chart-2\" />\n                <h3 className=\"text-lg font-medium mb-2\">All caught up!</h3>\n                <p className=\"text-muted-foreground\">\n                  No pending approvals at the moment\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-4\">\n              {filterRenewals(pendingApprovals).map((renewal) => (\n                <Card\n                  key={renewal.id}\n                  className=\"hover-elevate\"\n                  data-testid={`approval-card-${renewal.id}`}\n                >\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-4\">\n                      <div className=\"flex items-start gap-4\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarImage\n                            src={renewal.requester?.profileImageUrl || undefined}\n                            className=\"object-cover\"\n                          />\n                          <AvatarFallback>\n                            {renewal.requester?.firstName?.[0]}\n                            {renewal.requester?.lastName?.[0]}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2 flex-wrap\">\n                            <h3 className=\"font-medium\">\n                              {renewal.requester?.firstName} {renewal.requester?.lastName}\n                            </h3>\n                            {getUrgencyBadge(renewal.urgencyLevel)}\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {renewal.requester?.email}\n                          </p>\n                          <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                            <span className=\"flex items-center gap-1\">\n                              <BookOpen className=\"h-4 w-4\" />\n                              {renewal.enrollment?.course?.title}\n                            </span>\n                            <span className=\"flex items-center gap-1\">\n                              <Calendar className=\"h-4 w-4\" />\n                              Submitted {renewal.createdAt ? format(new Date(renewal.createdAt), \"MMM d\") : \"\"}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <StatusBadge status={renewal.status} />\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setSelectedRenewal(renewal)}\n                          data-testid={`button-review-${renewal.id}`}\n                        >\n                          Review\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"processed\" className=\"mt-6\">\n          {processedLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-24 w-full\" />\n              ))}\n            </div>\n          ) : filterRenewals(processedApprovals).length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Clock className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground/30\" />\n                <h3 className=\"text-lg font-medium mb-2\">No processed requests</h3>\n                <p className=\"text-muted-foreground\">\n                  Processed requests will appear here\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-4\">\n              {filterRenewals(processedApprovals).map((renewal) => (\n                <Card key={renewal.id} data-testid={`processed-card-${renewal.id}`}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between gap-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <Avatar className=\"h-10 w-10\">\n                          <AvatarImage\n                            src={renewal.requester?.profileImageUrl || undefined}\n                            className=\"object-cover\"\n                          />\n                          <AvatarFallback>\n                            {renewal.requester?.firstName?.[0]}\n                            {renewal.requester?.lastName?.[0]}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <p className=\"font-medium\">\n                            {renewal.requester?.firstName} {renewal.requester?.lastName}\n                          </p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {renewal.enrollment?.course?.title}\n                          </p>\n                        </div>\n                      </div>\n                      <StatusBadge status={renewal.status} />\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {/* Review Dialog */}\n      <Dialog open={!!selectedRenewal} onOpenChange={() => setSelectedRenewal(null)}>\n        <DialogContent className=\"sm:max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Review Renewal Request</DialogTitle>\n            <DialogDescription>\n              {selectedRenewal?.enrollment?.course?.title}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedRenewal && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label className=\"text-muted-foreground text-sm\">Employee</Label>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Avatar className=\"h-8 w-8\">\n                      <AvatarImage\n                        src={selectedRenewal.requester?.profileImageUrl || undefined}\n                        className=\"object-cover\"\n                      />\n                      <AvatarFallback>\n                        {selectedRenewal.requester?.firstName?.[0]}\n                        {selectedRenewal.requester?.lastName?.[0]}\n                      </AvatarFallback>\n                    </Avatar>\n                    <span className=\"font-medium\">\n                      {selectedRenewal.requester?.firstName} {selectedRenewal.requester?.lastName}\n                    </span>\n                  </div>\n                </div>\n                <div>\n                  <Label className=\"text-muted-foreground text-sm\">Course Expiry</Label>\n                  <p className=\"font-medium mt-1\">\n                    {selectedRenewal.enrollment?.expiresAt\n                      ? format(new Date(selectedRenewal.enrollment.expiresAt), \"MMM d, yyyy\")\n                      : \"N/A\"}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"comments\">Comments (optional)</Label>\n                <Textarea\n                  id=\"comments\"\n                  placeholder=\"Add any comments for this approval...\"\n                  value={comments}\n                  onChange={(e) => setComments(e.target.value)}\n                  data-testid=\"input-approval-comments\"\n                />\n              </div>\n            </div>\n          )}\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowRejectDialog(true);\n              }}\n              className=\"text-destructive hover:text-destructive\"\n              data-testid=\"button-reject\"\n            >\n              <XCircle className=\"mr-2 h-4 w-4\" />\n              Reject\n            </Button>\n            <Button\n              onClick={() => {\n                if (selectedRenewal) {\n                  approveMutation.mutate({\n                    id: selectedRenewal.id,\n                    comments,\n                  });\n                }\n              }}\n              disabled={approveMutation.isPending}\n              data-testid=\"button-approve\"\n            >\n              {approveMutation.isPending ? (\n                <>\n                  <Clock className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Processing...\n                </>\n              ) : (\n                <>\n                  <CheckCircle2 className=\"mr-2 h-4 w-4\" />\n                  Approve\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Reject Confirmation */}\n      <AlertDialog open={showRejectDialog} onOpenChange={setShowRejectDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Reject Renewal Request</AlertDialogTitle>\n            <AlertDialogDescription>\n              Please provide a reason for rejecting this request. The employee will be notified.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"py-4\">\n            <Textarea\n              placeholder=\"Reason for rejection...\"\n              value={rejectionReason}\n              onChange={(e) => setRejectionReason(e.target.value)}\n              data-testid=\"input-rejection-reason\"\n            />\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (selectedRenewal && rejectionReason.trim()) {\n                  rejectMutation.mutate({\n                    id: selectedRenewal.id,\n                    reason: rejectionReason,\n                  });\n                }\n              }}\n              disabled={!rejectionReason.trim() || rejectMutation.isPending}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              Confirm Rejection\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17088,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { startWorkerSchedule } from \"./worker\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n      \n      startWorkerSchedule();\n    },\n  );\n})();\n","path":null,"size_bytes":2644,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/data-table.tsx":{"content":"import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { FileText } from \"lucide-react\";\n\ninterface Column<T> {\n  key: string;\n  header: string;\n  cell: (row: T) => React.ReactNode;\n  className?: string;\n}\n\ninterface DataTableProps<T> {\n  columns: Column<T>[];\n  data: T[];\n  isLoading?: boolean;\n  emptyMessage?: string;\n  emptyIcon?: React.ReactNode;\n  onRowClick?: (row: T) => void;\n}\n\nexport function DataTable<T extends { id: number | string }>({\n  columns,\n  data,\n  isLoading = false,\n  emptyMessage = \"No data available\",\n  emptyIcon,\n  onRowClick,\n}: DataTableProps<T>) {\n  if (isLoading) {\n    return (\n      <div className=\"rounded-md border\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              {columns.map((column) => (\n                <TableHead key={column.key} className={column.className}>\n                  {column.header}\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {[...Array(5)].map((_, i) => (\n              <TableRow key={i}>\n                {columns.map((column) => (\n                  <TableCell key={column.key} className={column.className}>\n                    <Skeleton className=\"h-5 w-full\" />\n                  </TableCell>\n                ))}\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  }\n\n  if (data.length === 0) {\n    return (\n      <div className=\"rounded-md border\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              {columns.map((column) => (\n                <TableHead key={column.key} className={column.className}>\n                  {column.header}\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n        </Table>\n        <div className=\"py-12 text-center\">\n          {emptyIcon || <FileText className=\"h-10 w-10 mx-auto mb-4 text-muted-foreground/30\" />}\n          <p className=\"text-muted-foreground\">{emptyMessage}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"rounded-md border\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            {columns.map((column) => (\n              <TableHead key={column.key} className={column.className}>\n                {column.header}\n              </TableHead>\n            ))}\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {data.map((row) => (\n            <TableRow\n              key={row.id}\n              className={onRowClick ? \"cursor-pointer hover-elevate\" : \"\"}\n              onClick={() => onRowClick?.(row)}\n              data-testid={`table-row-${row.id}`}\n            >\n              {columns.map((column) => (\n                <TableCell key={column.key} className={column.className}>\n                  {column.cell(row)}\n                </TableCell>\n              ))}\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n","path":null,"size_bytes":3087,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { KPICard } from \"@/components/kpi-card\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Link } from \"wouter\";\nimport { \n  BookOpen, \n  Clock, \n  CheckCircle2, \n  AlertTriangle, \n  TrendingUp,\n  Users,\n  FileText,\n  ArrowRight,\n  Sparkles,\n  ClipboardCheck\n} from \"lucide-react\";\nimport { format, differenceInDays } from \"date-fns\";\nimport type { UserRole, Enrollment, RenewalRequest, ProgressionTask, Course, User } from \"@shared/schema\";\n\ninterface DashboardStats {\n  totalCourses: number;\n  completedCourses: number;\n  expiringCourses: number;\n  pendingRenewals: number;\n  pendingApprovals: number;\n  unreadNotifications: number;\n  progressionTasks: number;\n  completedProgressionTasks: number;\n}\n\ninterface EnrollmentWithCourse extends Enrollment {\n  course: Course;\n}\n\ninterface RenewalWithDetails extends RenewalRequest {\n  enrollment: EnrollmentWithCourse;\n  requester?: User;\n}\n\nfunction EmployeeDashboard() {\n  const { data: stats, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const { data: myEnrollments = [], isLoading: enrollmentsLoading } = useQuery<EnrollmentWithCourse[]>({\n    queryKey: [\"/api/enrollments/my\"],\n  });\n\n  const { data: pendingRenewals = [], isLoading: renewalsLoading } = useQuery<RenewalWithDetails[]>({\n    queryKey: [\"/api/renewals/my\"],\n  });\n\n  const { data: tasks = [], isLoading: tasksLoading } = useQuery<(ProgressionTask & { course?: Course; user?: User })[]>({\n    queryKey: [\"/api/progression\"],\n  });\n\n  const now = new Date();\n  const thirtyDaysFromNow = new Date();\n  thirtyDaysFromNow.setDate(now.getDate() + 30);\n  \n  const expiringEnrollments = myEnrollments.filter((e) => \n    e.status === 'active' && \n    e.expiresAt && \n    new Date(e.expiresAt) <= thirtyDaysFromNow && \n    new Date(e.expiresAt) >= now\n  );\n\n  if (statsLoading) {\n    return <DashboardSkeleton />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <KPICard\n          title=\"Active Courses\"\n          value={stats?.totalCourses || 0}\n          subtitle={`${stats?.completedCourses || 0} completed`}\n          icon={<BookOpen className=\"h-5 w-5\" />}\n          variant=\"success\"\n        />\n        <KPICard\n          title=\"Expiring Soon\"\n          value={stats?.expiringCourses || 0}\n          subtitle=\"Within 30 days\"\n          icon={<Clock className=\"h-5 w-5\" />}\n          variant={stats?.expiringCourses ? \"warning\" : \"default\"}\n        />\n        <KPICard\n          title=\"Pending Renewals\"\n          value={stats?.pendingRenewals || 0}\n          subtitle=\"Awaiting approval\"\n          icon={<ClipboardCheck className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Progression Tasks\"\n          value={`${stats?.completedProgressionTasks || 0}/${stats?.progressionTasks || 0}`}\n          subtitle=\"Completed\"\n          icon={<TrendingUp className=\"h-5 w-5\" />}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Expiring Courses */}\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <div>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5 text-yellow-500\" />\n                Courses Expiring Soon\n              </CardTitle>\n              <CardDescription>\n                Training that needs renewal\n              </CardDescription>\n            </div>\n            <Link href=\"/my-courses\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-all-courses\">\n                View All\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {enrollmentsLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : expiringEnrollments.length === 0 ? (\n              <div className=\"py-8 text-center\">\n                <CheckCircle2 className=\"h-10 w-10 mx-auto mb-3 text-chart-2\" />\n                <p className=\"text-muted-foreground\">All courses are up to date!</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {expiringEnrollments.slice(0, 5).map((enrollment) => {\n                  const daysUntilExpiry = differenceInDays(\n                    new Date(enrollment.expiresAt),\n                    new Date()\n                  );\n                  return (\n                    <div\n                      key={enrollment.id}\n                      className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover-elevate\"\n                      data-testid={`expiring-course-${enrollment.id}`}\n                    >\n                      <div>\n                        <p className=\"font-medium\">{enrollment.course?.title}</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Expires {format(new Date(enrollment.expiresAt), \"MMM d, yyyy\")}\n                        </p>\n                      </div>\n                      <StatusBadge\n                        status={daysUntilExpiry <= 7 ? \"expired\" : \"expiring_soon\"}\n                        size=\"sm\"\n                      />\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Recent Renewal Requests */}\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <div>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-chart-1\" />\n                My Renewal Requests\n              </CardTitle>\n              <CardDescription>\n                Track your renewal submissions\n              </CardDescription>\n            </div>\n            <Link href=\"/my-renewals\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-all-renewals\">\n                View All\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {renewalsLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : pendingRenewals.length === 0 ? (\n              <div className=\"py-8 text-center\">\n                <ClipboardCheck className=\"h-10 w-10 mx-auto mb-3 text-muted-foreground/30\" />\n                <p className=\"text-muted-foreground\">No renewal requests</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {pendingRenewals.slice(0, 5).map((renewal) => (\n                  <div\n                    key={renewal.id}\n                    className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover-elevate\"\n                    data-testid={`renewal-request-${renewal.id}`}\n                  >\n                    <div>\n                      <p className=\"font-medium\">\n                        {renewal.enrollment?.course?.title || \"Course\"}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Submitted {renewal.createdAt ? format(new Date(renewal.createdAt), \"MMM d, yyyy\") : \"\"}\n                      </p>\n                    </div>\n                    <StatusBadge status={renewal.status} size=\"sm\" />\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Progression Tasks */}\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n          <div>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 text-chart-4\" />\n              Progression Tasks\n            </CardTitle>\n            <CardDescription>\n              Tasks required for your next promotion\n            </CardDescription>\n          </div>\n          <Link href=\"/progression\">\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-progression\">\n              View All\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Button>\n          </Link>\n        </CardHeader>\n        <CardContent>\n          {tasksLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          ) : tasks.length === 0 ? (\n            <div className=\"py-8 text-center\">\n              <Sparkles className=\"h-10 w-10 mx-auto mb-3 text-muted-foreground/30\" />\n              <p className=\"text-muted-foreground\">No progression tasks assigned</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {tasks.slice(0, 6).map((task) => (\n                <div\n                  key={task.id}\n                  className=\"p-4 rounded-lg border hover-elevate\"\n                  data-testid={`task-${task.id}`}\n                >\n                  <div className=\"flex items-start justify-between gap-2 mb-2\">\n                    <h4 className=\"font-medium line-clamp-1\">{task.title}</h4>\n                    <StatusBadge status={task.status} size=\"sm\" showIcon={false} />\n                  </div>\n                  <p className=\"text-sm text-muted-foreground line-clamp-2 mb-2\">\n                    {task.description || \"No description\"}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Target: <span className=\"font-medium\">{task.targetGrade}</span>\n                  </p>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction SupervisorDashboard() {\n  const { user } = useAuth();\n  const isManager = user?.role === \"manager\";\n\n  const { data: stats, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const { data: pendingApprovals = [], isLoading: approvalsLoading } = useQuery<RenewalWithDetails[]>({\n    queryKey: [\"/api/renewals/pending\"],\n  });\n\n  if (statsLoading) {\n    return <DashboardSkeleton />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <KPICard\n          title=\"Pending Approvals\"\n          value={stats?.pendingApprovals || 0}\n          subtitle=\"Awaiting your review\"\n          icon={<ClipboardCheck className=\"h-5 w-5\" />}\n          variant={stats?.pendingApprovals ? \"warning\" : \"default\"}\n        />\n        <KPICard\n          title=\"Notifications\"\n          value={stats?.unreadNotifications || 0}\n          subtitle=\"Unread messages\"\n          icon={<Users className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Expiring Courses\"\n          value={stats?.expiringCourses || 0}\n          subtitle=\"Within 30 days\"\n          icon={<AlertTriangle className=\"h-5 w-5\" />}\n          variant={stats?.expiringCourses ? \"warning\" : \"default\"}\n        />\n        <KPICard\n          title=\"Completion Rate\"\n          value={`${stats?.progressionTasks ? Math.round((stats.completedProgressionTasks / stats.progressionTasks) * 100) : 0}%`}\n          subtitle=\"Progression tasks\"\n          icon={<TrendingUp className=\"h-5 w-5\" />}\n        />\n      </div>\n\n      {/* Pending Approvals */}\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n          <div>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <ClipboardCheck className=\"h-5 w-5 text-chart-3\" />\n              Pending Approvals\n            </CardTitle>\n            <CardDescription>\n              Renewal requests requiring your approval\n            </CardDescription>\n          </div>\n          <Link href=\"/approvals\">\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-view-approvals\">\n              View All\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Button>\n          </Link>\n        </CardHeader>\n        <CardContent>\n          {approvalsLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-20 w-full\" />\n              ))}\n            </div>\n          ) : pendingApprovals.length === 0 ? (\n            <div className=\"py-8 text-center\">\n              <CheckCircle2 className=\"h-10 w-10 mx-auto mb-3 text-chart-2\" />\n              <p className=\"text-muted-foreground\">No pending approvals</p>\n            </div>\n          ) : (\n            <DataTable\n              columns={[\n                {\n                  key: \"employee\",\n                  header: \"Employee\",\n                  cell: (row) => (\n                    <div>\n                      <p className=\"font-medium\">\n                        {row.requester?.firstName} {row.requester?.lastName}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {row.requester?.email}\n                      </p>\n                    </div>\n                  ),\n                },\n                {\n                  key: \"course\",\n                  header: \"Course\",\n                  cell: (row) => row.enrollment?.course?.title || \"N/A\",\n                },\n                {\n                  key: \"status\",\n                  header: \"Status\",\n                  cell: (row) => <StatusBadge status={row.status} size=\"sm\" />,\n                },\n                {\n                  key: \"submitted\",\n                  header: \"Submitted\",\n                  cell: (row) =>\n                    row.createdAt\n                      ? format(new Date(row.createdAt), \"MMM d, yyyy\")\n                      : \"N/A\",\n                },\n                {\n                  key: \"actions\",\n                  header: \"\",\n                  cell: (row) => (\n                    <Link href={`/approvals/${row.id}`}>\n                      <Button size=\"sm\" data-testid={`button-review-${row.id}`}>\n                        Review\n                      </Button>\n                    </Link>\n                  ),\n                  className: \"text-right\",\n                },\n              ]}\n              data={pendingApprovals.slice(0, 5)}\n              emptyMessage=\"No pending approvals\"\n            />\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction TrainingOfficerDashboard() {\n  const { data: stats, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const { data: courses = [], isLoading: coursesLoading } = useQuery<Course[]>({\n    queryKey: [\"/api/courses\"],\n  });\n\n  if (statsLoading) {\n    return <DashboardSkeleton />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <KPICard\n          title=\"Total Courses\"\n          value={courses.length}\n          subtitle=\"In the system\"\n          icon={<BookOpen className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Active Enrollments\"\n          value={stats?.totalCourses || 0}\n          subtitle=\"Across all employees\"\n          icon={<Users className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Expiring Soon\"\n          value={stats?.expiringCourses || 0}\n          subtitle=\"Within 30 days\"\n          icon={<Clock className=\"h-5 w-5\" />}\n          variant={stats?.expiringCourses ? \"warning\" : \"default\"}\n        />\n        <KPICard\n          title=\"Pending Renewals\"\n          value={stats?.pendingRenewals || 0}\n          subtitle=\"Awaiting processing\"\n          icon={<ClipboardCheck className=\"h-5 w-5\" />}\n        />\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        <Link href=\"/courses\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <BookOpen className=\"h-5 w-5 text-chart-1\" />\n                Manage Courses\n              </CardTitle>\n              <CardDescription>\n                Create, edit, and organize training courses\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n        <Link href=\"/enrollments\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Users className=\"h-5 w-5 text-chart-2\" />\n                Manage Enrollments\n              </CardTitle>\n              <CardDescription>\n                Enroll employees in training courses\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n        <Link href=\"/reports\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-chart-3\" />\n                Generate Reports\n              </CardTitle>\n              <CardDescription>\n                Export training compliance reports\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n      </div>\n\n      {/* Recent Courses */}\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n          <div>\n            <CardTitle className=\"text-lg\">Recent Courses</CardTitle>\n            <CardDescription>\n              Recently added or updated training courses\n            </CardDescription>\n          </div>\n          <Link href=\"/courses\">\n            <Button variant=\"ghost\" size=\"sm\">\n              View All\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\n            </Button>\n          </Link>\n        </CardHeader>\n        <CardContent>\n          {coursesLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          ) : (\n            <DataTable\n              columns={[\n                {\n                  key: \"title\",\n                  header: \"Course Title\",\n                  cell: (row) => (\n                    <div>\n                      <p className=\"font-medium\">{row.title}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {row.category}\n                      </p>\n                    </div>\n                  ),\n                },\n                {\n                  key: \"validity\",\n                  header: \"Validity\",\n                  cell: (row) => `${row.validityPeriodDays} days`,\n                },\n                {\n                  key: \"mandatory\",\n                  header: \"Type\",\n                  cell: (row) => (\n                    <StatusBadge\n                      status={row.isMandatory ? \"completed\" : \"pending\"}\n                      size=\"sm\"\n                    />\n                  ),\n                },\n              ]}\n              data={courses.slice(0, 5)}\n              emptyMessage=\"No courses available\"\n            />\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction AdminDashboard() {\n  const { data: stats, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  if (statsLoading) {\n    return <DashboardSkeleton />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <KPICard\n          title=\"Active Courses\"\n          value={stats?.totalCourses || 0}\n          subtitle=\"Enrollments\"\n          icon={<Users className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Completed Courses\"\n          value={stats?.completedCourses || 0}\n          subtitle=\"All time\"\n          icon={<BookOpen className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          title=\"Expiring Soon\"\n          value={stats?.expiringCourses || 0}\n          subtitle=\"Within 30 days\"\n          icon={<CheckCircle2 className=\"h-5 w-5\" />}\n          variant={stats?.expiringCourses ? \"warning\" : \"default\"}\n        />\n        <KPICard\n          title=\"Pending Actions\"\n          value={(stats?.pendingRenewals || 0) + (stats?.pendingApprovals || 0)}\n          subtitle=\"Renewals & approvals\"\n          icon={<ClipboardCheck className=\"h-5 w-5\" />}\n          variant={(stats?.pendingRenewals || 0) + (stats?.pendingApprovals || 0) > 0 ? \"warning\" : \"default\"}\n        />\n      </div>\n\n      {/* Admin Quick Actions */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Link href=\"/users\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Users className=\"h-5 w-5 text-chart-1\" />\n                User Management\n              </CardTitle>\n              <CardDescription>\n                Manage user accounts and roles\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n        <Link href=\"/departments\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-chart-2\" />\n                Departments\n              </CardTitle>\n              <CardDescription>\n                Manage organizational structure\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n        <Link href=\"/audit-logs\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-chart-3\" />\n                Audit Logs\n              </CardTitle>\n              <CardDescription>\n                View system activity logs\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n        <Link href=\"/reports\">\n          <Card className=\"hover-elevate cursor-pointer h-full\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5 text-chart-4\" />\n                Reports\n              </CardTitle>\n              <CardDescription>\n                Generate enterprise reports\n              </CardDescription>\n            </CardHeader>\n          </Card>\n        </Link>\n      </div>\n    </div>\n  );\n}\n\nfunction DashboardSkeleton() {\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {[...Array(4)].map((_, i) => (\n          <Skeleton key={i} className=\"h-32 w-full\" />\n        ))}\n      </div>\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Skeleton className=\"h-80 w-full\" />\n        <Skeleton className=\"h-80 w-full\" />\n      </div>\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  const role = (user?.role as UserRole) || \"employee\";\n\n  const getGreeting = () => {\n    const hour = new Date().getHours();\n    if (hour < 12) return \"Good morning\";\n    if (hour < 17) return \"Good afternoon\";\n    return \"Good evening\";\n  };\n\n  const getRoleDashboard = () => {\n    switch (role) {\n      case \"foreman\":\n      case \"manager\":\n        return <SupervisorDashboard />;\n      case \"training_officer\":\n        return <TrainingOfficerDashboard />;\n      case \"administrator\":\n        return <AdminDashboard />;\n      default:\n        return <EmployeeDashboard />;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-dashboard-title\">\n          {getGreeting()}, {user?.firstName || \"User\"}\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Here's an overview of your training and progression status.\n        </p>\n      </div>\n\n      {getRoleDashboard()}\n    </div>\n  );\n}\n","path":null,"size_bytes":25136,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/progression.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { \n  TrendingUp, \n  Target,\n  CheckCircle2,\n  Clock,\n  Calendar,\n  Award,\n  BookOpen,\n  AlertTriangle\n} from \"lucide-react\";\nimport { format, differenceInDays } from \"date-fns\";\nimport type { ProgressionTask, Course } from \"@shared/schema\";\n\ninterface TaskWithCourse extends ProgressionTask {\n  requiredCourse?: Course;\n}\n\nexport default function Progression() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const { data: tasks = [], isLoading } = useQuery<TaskWithCourse[]>({\n    queryKey: [\"/api/progression\"],\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async (data: { id: number; status: string }) => {\n      return apiRequest(\"PATCH\", `/api/progression/${data.id}`, { status: data.status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/progression\"] });\n      toast({\n        title: \"Status Updated\",\n        description: \"Task status has been updated.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update task status. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredTasks = tasks.filter((t) => {\n    if (activeTab === \"all\") return true;\n    return t.status === activeTab;\n  });\n\n  const stats = {\n    total: tasks.length,\n    notStarted: tasks.filter((t) => t.status === \"not_started\").length,\n    inProgress: tasks.filter((t) => t.status === \"in_progress\").length,\n    completed: tasks.filter((t) => t.status === \"completed\").length,\n    blocked: tasks.filter((t) => t.status === \"blocked\").length,\n  };\n\n  const completionPercentage = stats.total\n    ? Math.round((stats.completed / stats.total) * 100)\n    : 0;\n\n  const getPriorityColor = (priority: string | null) => {\n    switch (priority) {\n      case \"high\":\n        return \"text-orange-600 dark:text-orange-400\";\n      case \"critical\":\n        return \"text-red-600 dark:text-red-400\";\n      default:\n        return \"text-muted-foreground\";\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n          <TrendingUp className=\"h-6 w-6\" />\n          Progression Tasks\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Track tasks required for your career advancement\n        </p>\n      </div>\n\n      {/* Overall Progress */}\n      <Card className=\"bg-gradient-to-r from-primary/10 to-chart-4/10\">\n        <CardContent className=\"py-6\">\n          <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\n            <div>\n              <h3 className=\"font-semibold text-lg mb-1\">Overall Progress</h3>\n              <p className=\"text-muted-foreground\">\n                {stats.completed} of {stats.total} tasks completed\n              </p>\n            </div>\n            <div className=\"flex-1 max-w-md\">\n              <div className=\"flex items-center justify-between text-sm mb-2\">\n                <span>Completion</span>\n                <span className=\"font-medium\">{completionPercentage}%</span>\n              </div>\n              <Progress value={completionPercentage} className=\"h-3\" />\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-3xl font-bold text-primary\">{completionPercentage}%</div>\n              <p className=\"text-sm text-muted-foreground\">Complete</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Tasks</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-2xl font-bold text-muted-foreground\">{stats.notStarted}</div>\n            <p className=\"text-sm text-muted-foreground\">Not Started</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-chart-1\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-2xl font-bold text-chart-1\">{stats.inProgress}</div>\n            <p className=\"text-sm text-muted-foreground\">In Progress</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-chart-2\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-2xl font-bold text-chart-2\">{stats.completed}</div>\n            <p className=\"text-sm text-muted-foreground\">Completed</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-destructive\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"text-2xl font-bold text-destructive\">{stats.blocked}</div>\n            <p className=\"text-sm text-muted-foreground\">Blocked</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tasks Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            All ({stats.total})\n          </TabsTrigger>\n          <TabsTrigger value=\"not_started\" data-testid=\"tab-not-started\">\n            Not Started ({stats.notStarted})\n          </TabsTrigger>\n          <TabsTrigger value=\"in_progress\" data-testid=\"tab-in-progress\">\n            In Progress ({stats.inProgress})\n          </TabsTrigger>\n          <TabsTrigger value=\"completed\" data-testid=\"tab-completed\">\n            Completed ({stats.completed})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-6\">\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {[...Array(4)].map((_, i) => (\n                <Skeleton key={i} className=\"h-48 w-full\" />\n              ))}\n            </div>\n          ) : filteredTasks.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Target className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground/30\" />\n                <h3 className=\"text-lg font-medium mb-2\">No tasks found</h3>\n                <p className=\"text-muted-foreground\">\n                  {activeTab === \"all\"\n                    ? \"No progression tasks have been assigned yet\"\n                    : `No tasks with status \"${activeTab.replace(\"_\", \" \")}\"`}\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {filteredTasks.map((task) => {\n                const daysUntilDue = task.dueDate\n                  ? differenceInDays(new Date(task.dueDate), new Date())\n                  : null;\n                const isOverdue = daysUntilDue !== null && daysUntilDue < 0;\n\n                return (\n                  <Card\n                    key={task.id}\n                    className=\"hover-elevate\"\n                    data-testid={`task-card-${task.id}`}\n                  >\n                    <CardHeader className=\"pb-3\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <CardTitle className=\"text-base line-clamp-1\">\n                              {task.title}\n                            </CardTitle>\n                            {task.priority && task.priority !== \"medium\" && (\n                              <span className={`text-xs font-medium ${getPriorityColor(task.priority)}`}>\n                                {task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}\n                              </span>\n                            )}\n                          </div>\n                          <CardDescription className=\"line-clamp-2\">\n                            {task.description || \"No description provided\"}\n                          </CardDescription>\n                        </div>\n                        <StatusBadge status={task.status} size=\"sm\" />\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"flex flex-wrap gap-4 text-sm\">\n                        <div className=\"flex items-center gap-1.5\">\n                          <Target className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>\n                            Target: <span className=\"font-medium\">{task.targetGrade}</span>\n                          </span>\n                        </div>\n                        {task.dueDate && (\n                          <div className={`flex items-center gap-1.5 ${isOverdue ? \"text-destructive\" : \"\"}`}>\n                            <Calendar className=\"h-4 w-4\" />\n                            <span>\n                              {isOverdue\n                                ? `Overdue by ${Math.abs(daysUntilDue!)} days`\n                                : `Due: ${format(new Date(task.dueDate), \"MMM d, yyyy\")}`}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n\n                      {task.requiredCourse && (\n                        <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                          <BookOpen className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                          <div className=\"min-w-0\">\n                            <p className=\"text-sm font-medium truncate\">\n                              Required: {task.requiredCourse.title}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {task.requiredCourse.category}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      {task.status !== \"completed\" && (\n                        <div className=\"flex gap-2\">\n                          {task.status === \"not_started\" && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              className=\"flex-1\"\n                              onClick={() =>\n                                updateStatusMutation.mutate({\n                                  id: task.id,\n                                  status: \"in_progress\",\n                                })\n                              }\n                              disabled={updateStatusMutation.isPending}\n                              data-testid={`button-start-${task.id}`}\n                            >\n                              <Clock className=\"mr-2 h-4 w-4\" />\n                              Start Task\n                            </Button>\n                          )}\n                          {task.status === \"in_progress\" && (\n                            <Button\n                              size=\"sm\"\n                              className=\"flex-1\"\n                              onClick={() =>\n                                updateStatusMutation.mutate({\n                                  id: task.id,\n                                  status: \"completed\",\n                                })\n                              }\n                              disabled={updateStatusMutation.isPending}\n                              data-testid={`button-complete-${task.id}`}\n                            >\n                              <CheckCircle2 className=\"mr-2 h-4 w-4\" />\n                              Mark Complete\n                            </Button>\n                          )}\n                          {task.status === \"blocked\" && (\n                            <div className=\"flex-1 flex items-center justify-center gap-2 p-2 rounded bg-destructive/10 text-destructive text-sm\">\n                              <AlertTriangle className=\"h-4 w-4\" />\n                              This task is blocked\n                            </div>\n                          )}\n                        </div>\n                      )}\n\n                      {task.status === \"completed\" && task.completedAt && (\n                        <div className=\"flex items-center gap-2 text-sm text-chart-2\">\n                          <CheckCircle2 className=\"h-4 w-4\" />\n                          Completed on {format(new Date(task.completedAt), \"MMM d, yyyy\")}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":13598,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarSeparator,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  LayoutDashboard,\n  BookOpen,\n  Users,\n  ClipboardCheck,\n  FileText,\n  Bell,\n  Settings,\n  LogOut,\n  GraduationCap,\n  TrendingUp,\n  History,\n  Sparkles,\n  ChevronUp,\n  Building2,\n  UserCircle,\n} from \"lucide-react\";\nimport type { UserRole } from \"@shared/schema\";\n\ninterface NavItem {\n  title: string;\n  url: string;\n  icon: React.ComponentType<{ className?: string }>;\n  roles: UserRole[];\n}\n\nconst navItems: NavItem[] = [\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: LayoutDashboard,\n    roles: [\"employee\", \"foreman\", \"manager\", \"training_officer\", \"administrator\"],\n  },\n  {\n    title: \"My Courses\",\n    url: \"/my-courses\",\n    icon: BookOpen,\n    roles: [\"employee\", \"foreman\", \"manager\"],\n  },\n  {\n    title: \"My Renewals\",\n    url: \"/my-renewals\",\n    icon: ClipboardCheck,\n    roles: [\"employee\", \"foreman\", \"manager\"],\n  },\n  {\n    title: \"Progression Tasks\",\n    url: \"/progression\",\n    icon: TrendingUp,\n    roles: [\"employee\", \"foreman\", \"manager\"],\n  },\n  {\n    title: \"AI Recommendations\",\n    url: \"/recommendations\",\n    icon: Sparkles,\n    roles: [\"employee\", \"foreman\", \"manager\"],\n  },\n  {\n    title: \"Team Approvals\",\n    url: \"/approvals\",\n    icon: ClipboardCheck,\n    roles: [\"foreman\", \"manager\"],\n  },\n  {\n    title: \"Team Overview\",\n    url: \"/team\",\n    icon: Users,\n    roles: [\"foreman\", \"manager\"],\n  },\n  {\n    title: \"Course Management\",\n    url: \"/courses\",\n    icon: BookOpen,\n    roles: [\"training_officer\", \"administrator\"],\n  },\n  {\n    title: \"Enrollments\",\n    url: \"/enrollments\",\n    icon: FileText,\n    roles: [\"training_officer\", \"administrator\"],\n  },\n  {\n    title: \"All Renewals\",\n    url: \"/all-renewals\",\n    icon: ClipboardCheck,\n    roles: [\"training_officer\", \"administrator\"],\n  },\n  {\n    title: \"User Management\",\n    url: \"/users\",\n    icon: Users,\n    roles: [\"administrator\"],\n  },\n  {\n    title: \"Departments\",\n    url: \"/departments\",\n    icon: Building2,\n    roles: [\"administrator\"],\n  },\n  {\n    title: \"Audit Logs\",\n    url: \"/audit-logs\",\n    icon: History,\n    roles: [\"administrator\"],\n  },\n  {\n    title: \"Reports\",\n    url: \"/reports\",\n    icon: FileText,\n    roles: [\"manager\", \"training_officer\", \"administrator\"],\n  },\n];\n\nfunction getRoleLabel(role: UserRole): string {\n  const labels: Record<UserRole, string> = {\n    employee: \"Employee\",\n    foreman: \"Foreman\",\n    manager: \"Manager\",\n    training_officer: \"Training Officer\",\n    administrator: \"Administrator\",\n  };\n  return labels[role] || role;\n}\n\nfunction getRoleColor(role: UserRole): string {\n  const colors: Record<UserRole, string> = {\n    employee: \"bg-chart-1/10 text-chart-1\",\n    foreman: \"bg-chart-2/10 text-chart-2\",\n    manager: \"bg-chart-3/10 text-chart-3\",\n    training_officer: \"bg-chart-4/10 text-chart-4\",\n    administrator: \"bg-chart-5/10 text-chart-5\",\n  };\n  return colors[role] || \"bg-muted text-muted-foreground\";\n}\n\nexport function AppSidebar() {\n  const { user } = useAuth();\n  const [location] = useLocation();\n  const userRole = (user?.role as UserRole) || \"employee\";\n\n  const filteredNavItems = navItems.filter((item) =>\n    item.roles.includes(userRole)\n  );\n\n  const mainNavItems = filteredNavItems.filter(\n    (item) =>\n      ![\"Reports\", \"Audit Logs\", \"Settings\"].includes(item.title)\n  );\n\n  const adminNavItems = filteredNavItems.filter((item) =>\n    [\"Audit Logs\", \"Reports\"].includes(item.title)\n  );\n\n  const getInitials = () => {\n    if (user?.firstName && user?.lastName) {\n      return `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n    }\n    if (user?.email) {\n      return user.email[0].toUpperCase();\n    }\n    return \"U\";\n  };\n\n  const getDisplayName = () => {\n    if (user?.firstName && user?.lastName) {\n      return `${user.firstName} ${user.lastName}`;\n    }\n    return user?.email || \"User\";\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <Link href=\"/\">\n          <div className=\"flex items-center gap-3 cursor-pointer\" data-testid=\"link-logo\">\n            <div className=\"w-10 h-10 bg-primary rounded-lg flex items-center justify-center\">\n              <GraduationCap className=\"h-6 w-6 text-primary-foreground\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold text-lg tracking-tight\">TrainFlow</h1>\n              <p className=\"text-xs text-muted-foreground\">Enterprise Training</p>\n            </div>\n          </div>\n        </Link>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Navigation</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {mainNavItems.map((item) => (\n                <SidebarMenuItem key={item.url}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    tooltip={item.title}\n                  >\n                    <Link href={item.url} data-testid={`link-nav-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {adminNavItems.length > 0 && (\n          <>\n            <SidebarSeparator />\n            <SidebarGroup>\n              <SidebarGroupLabel>Administration</SidebarGroupLabel>\n              <SidebarGroupContent>\n                <SidebarMenu>\n                  {adminNavItems.map((item) => (\n                    <SidebarMenuItem key={item.url}>\n                      <SidebarMenuButton\n                        asChild\n                        isActive={location === item.url}\n                        tooltip={item.title}\n                      >\n                        <Link href={item.url} data-testid={`link-nav-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n                          <item.icon className=\"h-4 w-4\" />\n                          <span>{item.title}</span>\n                        </Link>\n                      </SidebarMenuButton>\n                    </SidebarMenuItem>\n                  ))}\n                </SidebarMenu>\n              </SidebarGroupContent>\n            </SidebarGroup>\n          </>\n        )}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start gap-3 h-auto p-2\"\n              data-testid=\"button-user-menu\"\n            >\n              <Avatar className=\"h-9 w-9\">\n                <AvatarImage src={user?.profileImageUrl || undefined} className=\"object-cover\" />\n                <AvatarFallback className=\"text-sm\">{getInitials()}</AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 text-left\">\n                <p className=\"text-sm font-medium truncate\">{getDisplayName()}</p>\n                <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${getRoleColor(userRole)}`}>\n                  {getRoleLabel(userRole)}\n                </span>\n              </div>\n              <ChevronUp className=\"h-4 w-4 text-muted-foreground\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <DropdownMenuLabel>\n              <div className=\"flex flex-col\">\n                <span>{getDisplayName()}</span>\n                <span className=\"text-xs text-muted-foreground font-normal\">\n                  {user?.email}\n                </span>\n              </div>\n            </DropdownMenuLabel>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem asChild>\n              <Link href=\"/profile\" className=\"cursor-pointer\" data-testid=\"link-profile\">\n                <UserCircle className=\"mr-2 h-4 w-4\" />\n                Profile\n              </Link>\n            </DropdownMenuItem>\n            <DropdownMenuItem asChild>\n              <Link href=\"/notifications\" className=\"cursor-pointer\" data-testid=\"link-notifications\">\n                <Bell className=\"mr-2 h-4 w-4\" />\n                Notifications\n              </Link>\n            </DropdownMenuItem>\n            <DropdownMenuItem asChild>\n              <Link href=\"/settings\" className=\"cursor-pointer\" data-testid=\"link-settings\">\n                <Settings className=\"mr-2 h-4 w-4\" />\n                Settings\n              </Link>\n            </DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem asChild>\n              <a href=\"/api/logout\" className=\"cursor-pointer text-destructive\" data-testid=\"link-logout\">\n                <LogOut className=\"mr-2 h-4 w-4\" />\n                Sign Out\n              </a>\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":9616,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/pages/my-courses.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Link } from \"wouter\";\nimport { useState } from \"react\";\nimport { \n  BookOpen, \n  Search, \n  Clock,\n  CheckCircle2,\n  AlertTriangle,\n  Calendar,\n  Award,\n  ExternalLink,\n  Plus\n} from \"lucide-react\";\nimport { format, differenceInDays } from \"date-fns\";\nimport type { Enrollment, Course } from \"@shared/schema\";\n\ninterface EnrollmentWithCourse extends Enrollment {\n  course: Course;\n}\n\nfunction getEnrollmentStatus(enrollment: EnrollmentWithCourse): \"active\" | \"expiring_soon\" | \"expired\" {\n  const daysUntilExpiry = differenceInDays(new Date(enrollment.expiresAt), new Date());\n  if (daysUntilExpiry < 0) return \"expired\";\n  if (daysUntilExpiry <= 30) return \"expiring_soon\";\n  return \"active\";\n}\n\nexport default function MyCourses() {\n  const [search, setSearch] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const { data: enrollments = [], isLoading } = useQuery<EnrollmentWithCourse[]>({\n    queryKey: [\"/api/enrollments/my\"],\n  });\n\n  const filteredEnrollments = enrollments.filter((e) => {\n    const matchesSearch = e.course?.title.toLowerCase().includes(search.toLowerCase());\n    if (!matchesSearch) return false;\n\n    const status = getEnrollmentStatus(e);\n    if (activeTab === \"all\") return true;\n    if (activeTab === \"active\") return status === \"active\";\n    if (activeTab === \"expiring\") return status === \"expiring_soon\";\n    if (activeTab === \"expired\") return status === \"expired\";\n    return true;\n  });\n\n  const stats = {\n    total: enrollments.length,\n    active: enrollments.filter((e) => getEnrollmentStatus(e) === \"active\").length,\n    expiring: enrollments.filter((e) => getEnrollmentStatus(e) === \"expiring_soon\").length,\n    expired: enrollments.filter((e) => getEnrollmentStatus(e) === \"expired\").length,\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <BookOpen className=\"h-6 w-6\" />\n            My Courses\n          </h1>\n          <p className=\"text-muted-foreground\">\n            View and manage your training enrollments\n          </p>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Courses</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-chart-2\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-2\">{stats.active}</div>\n            <p className=\"text-sm text-muted-foreground\">Active</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-yellow-500\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-yellow-600\">{stats.expiring}</div>\n            <p className=\"text-sm text-muted-foreground\">Expiring Soon</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate border-l-4 border-l-destructive\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-destructive\">{stats.expired}</div>\n            <p className=\"text-sm text-muted-foreground\">Expired</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search and Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search courses...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-courses\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            All ({stats.total})\n          </TabsTrigger>\n          <TabsTrigger value=\"active\" data-testid=\"tab-active\">\n            Active ({stats.active})\n          </TabsTrigger>\n          <TabsTrigger value=\"expiring\" data-testid=\"tab-expiring\">\n            Expiring Soon ({stats.expiring})\n          </TabsTrigger>\n          <TabsTrigger value=\"expired\" data-testid=\"tab-expired\">\n            Expired ({stats.expired})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-6\">\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {[...Array(6)].map((_, i) => (\n                <Skeleton key={i} className=\"h-48 w-full\" />\n              ))}\n            </div>\n          ) : filteredEnrollments.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <BookOpen className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground/30\" />\n                <h3 className=\"text-lg font-medium mb-2\">No courses found</h3>\n                <p className=\"text-muted-foreground\">\n                  {search ? \"Try adjusting your search\" : \"You haven't been enrolled in any courses yet\"}\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {filteredEnrollments.map((enrollment) => {\n                const status = getEnrollmentStatus(enrollment);\n                const daysUntilExpiry = differenceInDays(\n                  new Date(enrollment.expiresAt),\n                  new Date()\n                );\n                const validityProgress = Math.max(\n                  0,\n                  Math.min(\n                    100,\n                    ((enrollment.course?.validityPeriodDays || 365) + daysUntilExpiry) /\n                      (enrollment.course?.validityPeriodDays || 365) *\n                      100\n                  )\n                );\n\n                return (\n                  <Card\n                    key={enrollment.id}\n                    className=\"hover-elevate flex flex-col\"\n                    data-testid={`course-card-${enrollment.id}`}\n                  >\n                    <CardHeader className=\"pb-3\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1\">\n                          <CardTitle className=\"text-base line-clamp-2\">\n                            {enrollment.course?.title}\n                          </CardTitle>\n                          <CardDescription className=\"mt-1\">\n                            {enrollment.course?.category}\n                          </CardDescription>\n                        </div>\n                        <StatusBadge status={status} size=\"sm\" showIcon={false} />\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"flex-1 flex flex-col justify-between gap-4\">\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center gap-2 text-sm\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>\n                            Expires: {format(new Date(enrollment.expiresAt), \"MMM d, yyyy\")}\n                          </span>\n                        </div>\n                        {enrollment.certificateNumber && (\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            <Award className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"truncate\">\n                              Cert: {enrollment.certificateNumber}\n                            </span>\n                          </div>\n                        )}\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Validity</span>\n                            <span className={status === \"expired\" ? \"text-destructive\" : \"\"}>\n                              {daysUntilExpiry > 0\n                                ? `${daysUntilExpiry} days remaining`\n                                : `Expired ${Math.abs(daysUntilExpiry)} days ago`}\n                            </span>\n                          </div>\n                          <Progress\n                            value={status === \"expired\" ? 0 : validityProgress}\n                            className=\"h-2\"\n                          />\n                        </div>\n                      </div>\n                      {(status === \"expiring_soon\" || status === \"expired\") && (\n                        <Link href={`/my-renewals/new?enrollmentId=${enrollment.id}`}>\n                          <Button className=\"w-full\" data-testid={`button-renew-${enrollment.id}`}>\n                            <Plus className=\"mr-2 h-4 w-4\" />\n                            Request Renewal\n                          </Button>\n                        </Link>\n                      )}\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":10100,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  FileText, \n  Download,\n  BarChart3,\n  Users,\n  BookOpen,\n  Clock,\n  CheckCircle2,\n  AlertTriangle,\n  TrendingUp,\n  FileSpreadsheet,\n  FileJson,\n  Building2\n} from \"lucide-react\";\nimport type { Department } from \"@shared/schema\";\n\ninterface ReportStats {\n  totalEmployees: number;\n  employeesWithTraining: number;\n  employeesWithoutTraining: number;\n  compliantEmployees: number;\n  totalCourses: number;\n  totalEnrollments: number;\n  activeEnrollments: number;\n  expiringEnrollments: number;\n  expiredEnrollments: number;\n  complianceRate: number;\n  trainingComplianceRate: number;\n  overallComplianceRate: number;\n  pendingRenewals: number;\n  approvedThisMonth: number;\n  departmentStats: {\n    name: string;\n    employees: number;\n    compliance: number;\n  }[];\n}\n\ntype ExportFormat = \"pdf\" | \"excel\" | \"json\";\n\nexport default function Reports() {\n  const [complianceFormat, setComplianceFormat] = useState<ExportFormat>(\"excel\");\n  const [departmentFormat, setDepartmentFormat] = useState<ExportFormat>(\"excel\");\n  const [selectedDepartment, setSelectedDepartment] = useState<string>(\"\");\n  const [isExportingCompliance, setIsExportingCompliance] = useState(false);\n  const [isExportingDepartment, setIsExportingDepartment] = useState(false);\n  const { toast } = useToast();\n\n  const { data: stats, isLoading } = useQuery<ReportStats>({\n    queryKey: [\"/api/reports/stats\"],\n  });\n\n  const { data: departments } = useQuery<Department[]>({\n    queryKey: [\"/api/departments\"],\n  });\n\n  const getFileExtension = (format: ExportFormat): string => {\n    switch (format) {\n      case \"excel\": return \"xlsx\";\n      case \"pdf\": return \"pdf\";\n      case \"json\": return \"json\";\n    }\n  };\n\n  const handleExportTrainingCompliance = async () => {\n    setIsExportingCompliance(true);\n    try {\n      const response = await fetch(`/api/reports/export/training-compliance/${complianceFormat}`);\n      if (!response.ok) throw new Error(\"Export failed\");\n      \n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `training-compliance-report.${getFileExtension(complianceFormat)}`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n      \n      toast({\n        title: \"Export Successful\",\n        description: `Training compliance report exported as ${complianceFormat.toUpperCase()}.`,\n      });\n    } catch {\n      toast({\n        title: \"Export Failed\",\n        description: \"Failed to export report. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsExportingCompliance(false);\n    }\n  };\n\n  const handleExportDepartment = async () => {\n    if (!selectedDepartment) {\n      toast({\n        title: \"Select Department\",\n        description: \"Please select a department to export.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setIsExportingDepartment(true);\n    try {\n      const response = await fetch(`/api/reports/export/department/${selectedDepartment}/${departmentFormat}`);\n      if (!response.ok) throw new Error(\"Export failed\");\n      \n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `department-report-${selectedDepartment}.${getFileExtension(departmentFormat)}`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n      \n      toast({\n        title: \"Export Successful\",\n        description: `Department report exported as ${departmentFormat.toUpperCase()}.`,\n      });\n    } catch {\n      toast({\n        title: \"Export Failed\",\n        description: \"Failed to export report. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsExportingDepartment(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-10 w-64\" data-testid=\"skeleton-header\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-32 w-full\" data-testid={`skeleton-stat-${i}`} />\n          ))}\n        </div>\n        <Skeleton className=\"h-96 w-full\" data-testid=\"skeleton-content\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\" data-testid=\"text-page-title\">\n            <FileText className=\"h-6 w-6\" />\n            Reports\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-page-description\">\n            Generate and export enterprise reports\n          </p>\n        </div>\n      </div>\n\n      {/* Overview Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\" data-testid=\"card-stat-employees\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Total Employees</p>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-employees\">{stats?.totalEmployees || 0}</p>\n              </div>\n              <Users className=\"h-8 w-8 text-chart-1/50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\" data-testid=\"card-stat-courses\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Total Courses</p>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-total-courses\">{stats?.totalCourses || 0}</p>\n              </div>\n              <BookOpen className=\"h-8 w-8 text-chart-2/50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\" data-testid=\"card-stat-active\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Active Enrollments</p>\n                <p className=\"text-2xl font-bold\" data-testid=\"text-active-enrollments\">{stats?.activeEnrollments || 0}</p>\n              </div>\n              <CheckCircle2 className=\"h-8 w-8 text-chart-4/50\" />\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\" data-testid=\"card-stat-compliance\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Compliance Rate</p>\n                <p className=\"text-2xl font-bold text-chart-2\" data-testid=\"text-compliance-rate\">\n                  {stats?.complianceRate || 0}%\n                </p>\n              </div>\n              <TrendingUp className=\"h-8 w-8 text-chart-2/50\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Export Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Training Compliance Export */}\n        <Card data-testid=\"card-export-compliance\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5 text-chart-1\" />\n              Training Compliance Report\n            </CardTitle>\n            <CardDescription>\n              Export comprehensive training compliance data for all employees\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex-1\">\n                <label className=\"text-sm font-medium mb-2 block\">Export Format</label>\n                <Select \n                  value={complianceFormat} \n                  onValueChange={(v) => setComplianceFormat(v as ExportFormat)}\n                >\n                  <SelectTrigger data-testid=\"select-compliance-format\">\n                    <SelectValue placeholder=\"Select format\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"excel\" data-testid=\"option-compliance-excel\">\n                      <span className=\"flex items-center gap-2\">\n                        <FileSpreadsheet className=\"h-4 w-4\" />\n                        Excel Spreadsheet\n                      </span>\n                    </SelectItem>\n                    <SelectItem value=\"pdf\" data-testid=\"option-compliance-pdf\">\n                      <span className=\"flex items-center gap-2\">\n                        <FileText className=\"h-4 w-4\" />\n                        PDF Report\n                      </span>\n                    </SelectItem>\n                    <SelectItem value=\"json\" data-testid=\"option-compliance-json\">\n                      <span className=\"flex items-center gap-2\">\n                        <FileJson className=\"h-4 w-4\" />\n                        JSON Data\n                      </span>\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"pt-6\">\n                <Button \n                  onClick={handleExportTrainingCompliance}\n                  disabled={isExportingCompliance}\n                  data-testid=\"button-export-compliance\"\n                >\n                  <Download className=\"mr-2 h-4 w-4\" />\n                  {isExportingCompliance ? \"Exporting...\" : \"Export\"}\n                </Button>\n              </div>\n            </div>\n            <div className=\"text-sm text-muted-foreground space-y-1\">\n              <p>This report includes:</p>\n              <ul className=\"list-disc list-inside pl-2 space-y-0.5\">\n                <li>Employee training completion status</li>\n                <li>Expiring and expired certifications</li>\n                <li>Compliance rate by employee</li>\n                <li>Summary statistics</li>\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Department Report Export */}\n        <Card data-testid=\"card-export-department\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5 text-chart-3\" />\n              Department Report\n            </CardTitle>\n            <CardDescription>\n              Export department-specific training statistics and metrics\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Select Department</label>\n                <Select \n                  value={selectedDepartment} \n                  onValueChange={setSelectedDepartment}\n                >\n                  <SelectTrigger data-testid=\"select-department\">\n                    <SelectValue placeholder=\"Choose a department\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {departments?.map((dept) => (\n                      <SelectItem \n                        key={dept.id} \n                        value={dept.id.toString()}\n                        data-testid={`option-department-${dept.id}`}\n                      >\n                        {dept.name} {dept.code ? `(${dept.code})` : \"\"}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex-1\">\n                  <label className=\"text-sm font-medium mb-2 block\">Export Format</label>\n                  <Select \n                    value={departmentFormat} \n                    onValueChange={(v) => setDepartmentFormat(v as ExportFormat)}\n                  >\n                    <SelectTrigger data-testid=\"select-department-format\">\n                      <SelectValue placeholder=\"Select format\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"excel\" data-testid=\"option-dept-excel\">\n                        <span className=\"flex items-center gap-2\">\n                          <FileSpreadsheet className=\"h-4 w-4\" />\n                          Excel Spreadsheet\n                        </span>\n                      </SelectItem>\n                      <SelectItem value=\"pdf\" data-testid=\"option-dept-pdf\">\n                        <span className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4\" />\n                          PDF Report\n                        </span>\n                      </SelectItem>\n                      <SelectItem value=\"json\" data-testid=\"option-dept-json\">\n                        <span className=\"flex items-center gap-2\">\n                          <FileJson className=\"h-4 w-4\" />\n                          JSON Data\n                        </span>\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"pt-6\">\n                  <Button \n                    onClick={handleExportDepartment}\n                    disabled={isExportingDepartment || !selectedDepartment}\n                    data-testid=\"button-export-department\"\n                  >\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    {isExportingDepartment ? \"Exporting...\" : \"Export\"}\n                  </Button>\n                </div>\n              </div>\n            </div>\n            <div className=\"text-sm text-muted-foreground space-y-1\">\n              <p>This report includes:</p>\n              <ul className=\"list-disc list-inside pl-2 space-y-0.5\">\n                <li>Department summary metrics</li>\n                <li>Employee completion rates</li>\n                <li>Course breakdown statistics</li>\n                <li>Pending renewals and expirations</li>\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Report Content */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Compliance Overview */}\n        <Card data-testid=\"card-compliance-overview\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5 text-chart-1\" />\n              Training Compliance Overview\n            </CardTitle>\n            <CardDescription>\n              Current status of training across the organization\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center justify-between text-sm mb-2\">\n                  <span className=\"flex items-center gap-2\">\n                    <CheckCircle2 className=\"h-4 w-4 text-chart-2\" />\n                    Active Enrollments\n                  </span>\n                  <span className=\"font-medium\" data-testid=\"text-overview-active\">{stats?.activeEnrollments || 0}</span>\n                </div>\n                <Progress\n                  value={\n                    stats?.totalEnrollments\n                      ? (stats.activeEnrollments / stats.totalEnrollments) * 100\n                      : 0\n                  }\n                  className=\"h-2\"\n                  data-testid=\"progress-active\"\n                />\n              </div>\n              <div>\n                <div className=\"flex items-center justify-between text-sm mb-2\">\n                  <span className=\"flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4 text-yellow-500\" />\n                    Expiring Soon\n                  </span>\n                  <span className=\"font-medium\" data-testid=\"text-overview-expiring\">{stats?.expiringEnrollments || 0}</span>\n                </div>\n                <Progress\n                  value={\n                    stats?.totalEnrollments\n                      ? (stats.expiringEnrollments / stats.totalEnrollments) * 100\n                      : 0\n                  }\n                  className=\"h-2 [&>div]:bg-yellow-500\"\n                  data-testid=\"progress-expiring\"\n                />\n              </div>\n              <div>\n                <div className=\"flex items-center justify-between text-sm mb-2\">\n                  <span className=\"flex items-center gap-2\">\n                    <AlertTriangle className=\"h-4 w-4 text-destructive\" />\n                    Expired\n                  </span>\n                  <span className=\"font-medium\" data-testid=\"text-overview-expired\">{stats?.expiredEnrollments || 0}</span>\n                </div>\n                <Progress\n                  value={\n                    stats?.totalEnrollments\n                      ? (stats.expiredEnrollments / stats.totalEnrollments) * 100\n                      : 0\n                  }\n                  className=\"h-2 [&>div]:bg-destructive\"\n                  data-testid=\"progress-expired\"\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Renewal Statistics */}\n        <Card data-testid=\"card-renewal-stats\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"h-5 w-5 text-chart-3\" />\n              Renewal Statistics\n            </CardTitle>\n            <CardDescription>\n              Monthly renewal request activity\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n                  <p className=\"text-3xl font-bold\" data-testid=\"text-pending-renewals\">{stats?.pendingRenewals || 0}</p>\n                  <p className=\"text-sm text-muted-foreground\">Pending Renewals</p>\n                </div>\n                <div className=\"text-center p-4 rounded-lg bg-muted/50\">\n                  <p className=\"text-3xl font-bold text-chart-2\" data-testid=\"text-approved-month\">\n                    {stats?.approvedThisMonth || 0}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">Approved This Month</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Department Breakdown */}\n        <Card className=\"lg:col-span-2\" data-testid=\"card-department-breakdown\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-chart-4\" />\n              Department Compliance\n            </CardTitle>\n            <CardDescription>\n              Training compliance by department\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {stats?.departmentStats && stats.departmentStats.length > 0 ? (\n              <div className=\"space-y-4\">\n                {stats.departmentStats.map((dept, index) => (\n                  <div key={index} className=\"space-y-2\" data-testid={`row-department-${index}`}>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium\" data-testid={`text-dept-name-${index}`}>{dept.name}</p>\n                        <p className=\"text-sm text-muted-foreground\" data-testid={`text-dept-employees-${index}`}>\n                          {dept.employees} employees\n                        </p>\n                      </div>\n                      <span\n                        className={`text-lg font-bold ${\n                          dept.compliance >= 90\n                            ? \"text-chart-2\"\n                            : dept.compliance >= 70\n                            ? \"text-yellow-600\"\n                            : \"text-destructive\"\n                        }`}\n                        data-testid={`text-dept-compliance-${index}`}\n                      >\n                        {dept.compliance}%\n                      </span>\n                    </div>\n                    <Progress\n                      value={dept.compliance}\n                      className={`h-2 ${\n                        dept.compliance >= 90\n                          ? \"\"\n                          : dept.compliance >= 70\n                          ? \"[&>div]:bg-yellow-500\"\n                          : \"[&>div]:bg-destructive\"\n                      }`}\n                      data-testid={`progress-dept-${index}`}\n                    />\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"py-8 text-center\" data-testid=\"empty-departments\">\n                <Users className=\"h-10 w-10 mx-auto mb-3 text-muted-foreground/30\" />\n                <p className=\"text-muted-foreground\">No department data available</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":22005,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    const userId = user.claims?.sub;\n    if (userId) {\n      const dbUser = await storage.getUser(userId);\n      if (dbUser) {\n        (req as any).user = dbUser;\n      }\n    }\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    \n    const userId = user.claims?.sub;\n    if (userId) {\n      const dbUser = await storage.getUser(userId);\n      if (dbUser) {\n        (req as any).user = dbUser;\n      }\n    }\n    \n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4735,"size_tokens":null},"design_guidelines.md":{"content":"# Enterprise Training Platform - Design Guidelines\n\n## Design Approach: Carbon Design System\n\n**Justification**: This enterprise training platform requires a design system optimized for data-heavy, information-dense interfaces with complex workflows. Carbon Design System (IBM) is specifically engineered for enterprise applications where clarity, efficiency, and scalability are paramount.\n\n**Key Design Principles**:\n- Clarity over decoration: Every element serves a functional purpose\n- Consistent information hierarchy across all role-based dashboards\n- Efficient task completion with minimal cognitive load\n- Professional, trustworthy aesthetic appropriate for corporate environments\n- Scalable component patterns that accommodate complex workflows\n\n---\n\n## Typography\n\n**Font Stack**: IBM Plex Sans (via Google Fonts CDN)\n- **Display/Headers**: IBM Plex Sans, font-weight: 600, tracking-tight\n  - Page titles: text-3xl (Employee Dashboard, Course Management)\n  - Section headers: text-xl\n  - Card headers: text-lg\n- **Body Text**: IBM Plex Sans, font-weight: 400\n  - Primary content: text-base, leading-relaxed\n  - Secondary/meta text: text-sm, text-gray-600\n- **Data Tables**: IBM Plex Mono for numerical data and dates (font-weight: 400, text-sm)\n- **CTAs/Buttons**: IBM Plex Sans, font-weight: 500, text-sm uppercase tracking-wide\n\n---\n\n## Layout System\n\n**Spacing Primitives**: Tailwind units of 2, 4, 6, and 8\n- Component padding: p-4, p-6\n- Section spacing: space-y-6, space-y-8\n- Card margins: m-4, gap-4\n- Form field spacing: space-y-4\n- Dashboard grid gaps: gap-6\n\n**Container Strategy**:\n- Main content area: max-w-7xl mx-auto px-4\n- Dashboard grids: grid-cols-1 md:grid-cols-2 lg:grid-cols-3\n- Forms: max-w-2xl for optimal readability\n- Data tables: full-width with horizontal scroll on mobile\n\n---\n\n## Component Library\n\n### Navigation\n- **Top Navigation Bar**: Fixed header with logo, role indicator, notification bell, user profile dropdown\n- **Sidebar Navigation** (for role-based menu items): Collapsible on mobile, persistent on desktop with icon + label pattern\n- **Breadcrumbs**: For nested navigation (Course Management > Edit Course > Upload Materials)\n\n### Dashboards\n- **KPI Cards**: Grid layout showing key metrics (Courses Expiring Soon, Pending Approvals, Completion Rate)\n  - Large numerical value with supporting trend indicator (↑ 12% from last month)\n  - Icon in top-right corner for visual association\n- **Status Summary Cards**: Display counts by status (Approved, Pending, Expired)\n- **Quick Action Panels**: Prominent CTAs for primary tasks (Submit Renewal Request, Enroll Employee)\n\n### Data Display\n- **Data Tables**: Sortable columns, row actions menu, pagination\n  - Sticky header on scroll\n  - Status badges (Approved: green, Pending: yellow, Expired: red)\n  - Action buttons: icon-only with tooltips\n- **Timeline View**: Vertical timeline for workflow history with timestamps, user avatars, action descriptions\n- **Progress Indicators**: Multi-step progress bar for approval workflows (Submitted → Foreman Review → Manager Approval)\n\n### Forms\n- **Input Fields**: Consistent height (h-10), clear labels above inputs, helper text below\n- **Dropdowns/Selects**: Searchable for long lists (employee selection, course assignment)\n- **Date Pickers**: Calendar modal for expiration date selection\n- **File Upload**: Drag-and-drop zone with file type/size restrictions displayed\n- **Multi-level Approval Form**: Clear status indicators at each approval stage with approve/reject buttons\n\n### Notifications\n- **In-App Notification Panel**: Dropdown from header bell icon showing recent alerts with timestamp\n- **Alert Banners**: Top-of-page dismissible alerts for urgent system messages (Course expiring in 1 day!)\n- **Toast Notifications**: Bottom-right corner for action confirmations (Renewal request submitted successfully)\n\n### Modals & Overlays\n- **Confirmation Dialogs**: For critical actions (Approve training request? Reject renewal?)\n- **Detail Panels**: Slide-in from right for viewing course details, employee profiles\n- **AI Recommendation Modal**: Display AI-suggested courses with rationale and accept/dismiss actions\n\n### Reports\n- **Filter Panel**: Collapsible sidebar with date range, role, department filters\n- **Export Controls**: Dropdown button offering PDF, Excel, JSON export options\n- **Report Preview**: Table or card view with print-friendly formatting\n\n---\n\n## Animations\n\n**Minimal Animation Strategy** (Enterprise Context):\n- **Micro-interactions only**: \n  - Button hover: subtle scale (scale-105) and shadow increase (duration-200)\n  - Dropdown menus: fade-in with slight translateY (duration-150)\n  - Loading states: Simple spinner or skeleton screens (no elaborate animations)\n- **NO scroll animations, parallax effects, or decorative transitions**\n- **Page transitions**: Instant navigation with loading indicators for async operations\n\n---\n\n## Images\n\n**No Hero Images**: This is a functional enterprise application, not a marketing site. Focus on data visualization and workflow efficiency.\n\n**Image Usage**:\n- **User Avatars**: Small circular avatars (32px) in headers, timelines, and approval workflows\n- **Empty States**: Simple illustrations for \"No courses assigned\" or \"No pending approvals\" screens\n- **Icons**: Heroicons (outline style) for navigation, actions, and status indicators via CDN","path":null,"size_bytes":5380,"size_tokens":null},"client/src/components/workflow-timeline.tsx":{"content":"import { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { \n  CheckCircle2, \n  Clock, \n  XCircle, \n  FileText,\n  ArrowRight,\n  User\n} from \"lucide-react\";\nimport { formatDistanceToNow, format } from \"date-fns\";\n\ninterface TimelineStep {\n  id: string;\n  title: string;\n  description?: string;\n  status: \"completed\" | \"pending\" | \"rejected\" | \"current\";\n  user?: {\n    name: string;\n    avatar?: string;\n  };\n  timestamp?: Date | string;\n  comments?: string;\n}\n\ninterface WorkflowTimelineProps {\n  steps: TimelineStep[];\n  className?: string;\n}\n\nfunction getStepIcon(status: TimelineStep[\"status\"]) {\n  switch (status) {\n    case \"completed\":\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center\">\n          <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n        </div>\n      );\n    case \"rejected\":\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center\">\n          <XCircle className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\n        </div>\n      );\n    case \"current\":\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center animate-pulse\">\n          <Clock className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n        </div>\n      );\n    default:\n      return (\n        <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n          <Clock className=\"h-4 w-4 text-muted-foreground\" />\n        </div>\n      );\n  }\n}\n\nexport function WorkflowTimeline({ steps, className = \"\" }: WorkflowTimelineProps) {\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {steps.map((step, index) => (\n        <div key={step.id} className=\"relative flex gap-4\">\n          {/* Connector line */}\n          {index < steps.length - 1 && (\n            <div className=\"absolute left-4 top-10 w-0.5 h-full -translate-x-1/2 bg-border\" />\n          )}\n\n          {/* Icon */}\n          <div className=\"flex-shrink-0 z-10\">{getStepIcon(step.status)}</div>\n\n          {/* Content */}\n          <div className=\"flex-1 pb-6\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <h4 className=\"font-medium\">{step.title}</h4>\n              {step.status === \"current\" && (\n                <span className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded-full\">\n                  Awaiting Action\n                </span>\n              )}\n            </div>\n\n            {step.description && (\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {step.description}\n              </p>\n            )}\n\n            {step.user && (\n              <div className=\"flex items-center gap-2 mt-2\">\n                <Avatar className=\"h-6 w-6\">\n                  <AvatarImage src={step.user.avatar} className=\"object-cover\" />\n                  <AvatarFallback className=\"text-xs\">\n                    {step.user.name.split(\" \").map(n => n[0]).join(\"\")}\n                  </AvatarFallback>\n                </Avatar>\n                <span className=\"text-sm text-muted-foreground\">\n                  {step.user.name}\n                </span>\n              </div>\n            )}\n\n            {step.comments && (\n              <div className=\"mt-2 p-3 bg-muted/50 rounded-lg text-sm\">\n                <p className=\"text-muted-foreground italic\">\"{step.comments}\"</p>\n              </div>\n            )}\n\n            {step.timestamp && (\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                {format(new Date(step.timestamp), \"MMM d, yyyy 'at' h:mm a\")}\n                {\" · \"}\n                {formatDistanceToNow(new Date(step.timestamp), { addSuffix: true })}\n              </p>\n            )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// Visual progress steps for approval workflow\ninterface ProgressStepsProps {\n  currentStep: number;\n  steps: string[];\n}\n\nexport function ProgressSteps({ currentStep, steps }: ProgressStepsProps) {\n  return (\n    <div className=\"flex items-center justify-between w-full\">\n      {steps.map((step, index) => (\n        <div key={step} className=\"flex items-center\">\n          <div className=\"flex flex-col items-center\">\n            <div\n              className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n                index < currentStep\n                  ? \"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400\"\n                  : index === currentStep\n                  ? \"bg-primary text-primary-foreground\"\n                  : \"bg-muted text-muted-foreground\"\n              }`}\n            >\n              {index < currentStep ? (\n                <CheckCircle2 className=\"h-4 w-4\" />\n              ) : (\n                index + 1\n              )}\n            </div>\n            <span className={`text-xs mt-1 text-center ${\n              index <= currentStep ? \"text-foreground\" : \"text-muted-foreground\"\n            }`}>\n              {step}\n            </span>\n          </div>\n          {index < steps.length - 1 && (\n            <div\n              className={`h-0.5 w-12 sm:w-20 mx-2 ${\n                index < currentStep ? \"bg-green-500\" : \"bg-border\"\n              }`}\n            />\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":5449,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport {\n  insertCourseSchema, insertEnrollmentSchema, insertRenewalRequestSchema,\n  insertProgressionTaskSchema, insertDepartmentSchema, insertNotificationSchema,\n  type UserRole, type User\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport OpenAI from \"openai\";\nimport { runManualExpirationCheck } from \"./worker\";\nimport {\n  generateTrainingComplianceData, generateTrainingCompliancePDF, generateTrainingComplianceExcel,\n  generateEmployeeProgressData, generateEmployeeProgressPDF, generateEmployeeProgressExcel,\n  generateDepartmentStatsData, generateDepartmentStatsPDF, generateDepartmentStatsExcel,\n  generateJSONExport, verifyDepartmentTenant\n} from \"./reports\";\n\n// Extend Express Request to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: User;\n    }\n  }\n}\n\n// Role-based access control middleware\nfunction requireRole(...allowedRoles: UserRole[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ error: \"Authentication required\" });\n    }\n    if (!allowedRoles.includes(req.user.role)) {\n      return res.status(403).json({ error: \"Insufficient permissions\" });\n    }\n    next();\n  };\n}\n\n// Helper to create audit log\nasync function auditLog(\n  userId: string | null,\n  action: 'create' | 'update' | 'delete' | 'login' | 'logout' | 'approve' | 'reject' | 'submit',\n  entityType: string,\n  entityId: string | null,\n  oldValues?: unknown,\n  newValues?: unknown,\n  req?: Request\n) {\n  await storage.createAuditLog({\n    userId,\n    action,\n    entityType,\n    entityId,\n    oldValues: oldValues || null,\n    newValues: newValues || null,\n    ipAddress: req?.ip || null,\n    userAgent: req?.get('user-agent') || null,\n    tenantId: 'default',\n  });\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Setup authentication\n  await setupAuth(app);\n\n  // =====================\n  // AUTH ROUTES\n  // =====================\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: Request, res: Response) => {\n    res.json(req.user);\n  });\n\n  // =====================\n  // DASHBOARD ROUTES\n  // =====================\n  app.get(\"/api/dashboard/stats\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const stats = await storage.getDashboardStats(\n        req.user!.id,\n        req.user!.role,\n        req.user!.tenantId || 'default'\n      );\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Dashboard stats error:\", error);\n      res.status(500).json({ error: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  // =====================\n  // USER ROUTES\n  // =====================\n  app.get(\"/api/users\", isAuthenticated, requireRole('administrator', 'training_officer'), async (req: Request, res: Response) => {\n    try {\n      const users = await storage.getAllUsers(req.user!.tenantId || 'default');\n      res.json(users);\n    } catch (error) {\n      console.error(\"Get users error:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  app.get(\"/api/users/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Failed to fetch user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", isAuthenticated, requireRole('administrator'), async (req: Request, res: Response) => {\n    try {\n      const oldUser = await storage.getUser(req.params.id);\n      const updated = await storage.updateUser(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      await auditLog(req.user!.id, 'update', 'user', req.params.id, oldUser, updated, req);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Update user error:\", error);\n      res.status(500).json({ error: \"Failed to update user\" });\n    }\n  });\n\n  // =====================\n  // DEPARTMENT ROUTES\n  // =====================\n  app.get(\"/api/departments\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const departments = await storage.getAllDepartments(req.user!.tenantId || 'default');\n      res.json(departments);\n    } catch (error) {\n      console.error(\"Get departments error:\", error);\n      res.status(500).json({ error: \"Failed to fetch departments\" });\n    }\n  });\n\n  app.post(\"/api/departments\", isAuthenticated, requireRole('administrator'), async (req: Request, res: Response) => {\n    try {\n      const data = insertDepartmentSchema.parse(req.body);\n      const department = await storage.createDepartment({\n        ...data,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      await auditLog(req.user!.id, 'create', 'department', String(department.id), null, department, req);\n      res.status(201).json(department);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      console.error(\"Create department error:\", error);\n      res.status(500).json({ error: \"Failed to create department\" });\n    }\n  });\n\n  // =====================\n  // COURSE ROUTES\n  // =====================\n  app.get(\"/api/courses\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { category, activeOnly } = req.query;\n      let courseList;\n      if (category && typeof category === 'string') {\n        courseList = await storage.getCoursesByCategory(category, req.user!.tenantId || 'default');\n      } else if (activeOnly === 'true') {\n        courseList = await storage.getActiveCourses(req.user!.tenantId || 'default');\n      } else {\n        courseList = await storage.getAllCourses(req.user!.tenantId || 'default');\n      }\n      res.json(courseList);\n    } catch (error) {\n      console.error(\"Get courses error:\", error);\n      res.status(500).json({ error: \"Failed to fetch courses\" });\n    }\n  });\n\n  app.get(\"/api/courses/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const course = await storage.getCourse(parseInt(req.params.id));\n      if (!course) {\n        return res.status(404).json({ error: \"Course not found\" });\n      }\n      res.json(course);\n    } catch (error) {\n      console.error(\"Get course error:\", error);\n      res.status(500).json({ error: \"Failed to fetch course\" });\n    }\n  });\n\n  app.post(\"/api/courses\", isAuthenticated, requireRole('administrator', 'training_officer'), async (req: Request, res: Response) => {\n    try {\n      const data = insertCourseSchema.parse(req.body);\n      const course = await storage.createCourse({\n        ...data,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      await auditLog(req.user!.id, 'create', 'course', String(course.id), null, course, req);\n      res.status(201).json(course);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      console.error(\"Create course error:\", error);\n      res.status(500).json({ error: \"Failed to create course\" });\n    }\n  });\n\n  app.patch(\"/api/courses/:id\", isAuthenticated, requireRole('administrator', 'training_officer'), async (req: Request, res: Response) => {\n    try {\n      const oldCourse = await storage.getCourse(parseInt(req.params.id));\n      const updated = await storage.updateCourse(parseInt(req.params.id), req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Course not found\" });\n      }\n      await auditLog(req.user!.id, 'update', 'course', req.params.id, oldCourse, updated, req);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Update course error:\", error);\n      res.status(500).json({ error: \"Failed to update course\" });\n    }\n  });\n\n  // =====================\n  // ENROLLMENT ROUTES\n  // =====================\n  app.get(\"/api/enrollments\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { userId, courseId, expiring } = req.query;\n      let enrollmentList;\n      \n      if (userId && typeof userId === 'string') {\n        enrollmentList = await storage.getEnrollmentsByUser(userId);\n      } else if (courseId) {\n        enrollmentList = await storage.getEnrollmentsByCourse(parseInt(courseId as string));\n      } else if (expiring) {\n        enrollmentList = await storage.getExpiringEnrollments(parseInt(expiring as string) || 30, req.user!.tenantId || 'default');\n      } else if (req.user!.role === 'administrator' || req.user!.role === 'training_officer') {\n        enrollmentList = await storage.getAllEnrollments(req.user!.tenantId || 'default');\n      } else {\n        enrollmentList = await storage.getEnrollmentsByUser(req.user!.id);\n      }\n      res.json(enrollmentList);\n    } catch (error) {\n      console.error(\"Get enrollments error:\", error);\n      res.status(500).json({ error: \"Failed to fetch enrollments\" });\n    }\n  });\n\n  app.get(\"/api/enrollments/my\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const enrollments = await storage.getEnrollmentsByUser(req.user!.id);\n      // Join with course data\n      const enriched = await Promise.all(enrollments.map(async (e) => {\n        const course = await storage.getCourse(e.courseId);\n        return { ...e, course };\n      }));\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get my enrollments error:\", error);\n      res.status(500).json({ error: \"Failed to fetch enrollments\" });\n    }\n  });\n\n  app.post(\"/api/enrollments\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const data = insertEnrollmentSchema.parse(req.body);\n      \n      // Calculate expiry date based on course validity\n      const course = await storage.getCourse(data.courseId);\n      if (!course) {\n        return res.status(400).json({ error: \"Course not found\" });\n      }\n      \n      const expiresAt = new Date();\n      expiresAt.setDate(expiresAt.getDate() + course.validityPeriodDays);\n      \n      const enrollment = await storage.createEnrollment({\n        ...data,\n        expiresAt,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      await auditLog(req.user!.id, 'create', 'enrollment', String(enrollment.id), null, enrollment, req);\n      res.status(201).json(enrollment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      console.error(\"Create enrollment error:\", error);\n      res.status(500).json({ error: \"Failed to create enrollment\" });\n    }\n  });\n\n  app.patch(\"/api/enrollments/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const oldEnrollment = await storage.getEnrollment(parseInt(req.params.id));\n      const updated = await storage.updateEnrollment(parseInt(req.params.id), req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Enrollment not found\" });\n      }\n      await auditLog(req.user!.id, 'update', 'enrollment', req.params.id, oldEnrollment, updated, req);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Update enrollment error:\", error);\n      res.status(500).json({ error: \"Failed to update enrollment\" });\n    }\n  });\n\n  // =====================\n  // RENEWAL REQUEST ROUTES\n  // =====================\n  app.get(\"/api/renewals\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { status } = req.query;\n      let renewals;\n      \n      if (req.user!.role === 'administrator' || req.user!.role === 'training_officer') {\n        renewals = await storage.getAllRenewalRequests(req.user!.tenantId || 'default');\n      } else {\n        renewals = await storage.getRenewalRequestsByUser(req.user!.id);\n      }\n      \n      if (status && typeof status === 'string') {\n        renewals = renewals.filter(r => r.status === status);\n      }\n      \n      res.json(renewals);\n    } catch (error) {\n      console.error(\"Get renewals error:\", error);\n      res.status(500).json({ error: \"Failed to fetch renewals\" });\n    }\n  });\n\n  app.get(\"/api/renewals/my\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const renewals = await storage.getRenewalRequestsByUser(req.user!.id);\n      // Enrich with enrollment (including course), requester, foreman, manager data\n      const enriched = await Promise.all(renewals.map(async (r) => {\n        const enrollment = await storage.getEnrollment(r.enrollmentId);\n        const course = enrollment ? await storage.getCourse(enrollment.courseId) : null;\n        const requester = await storage.getUser(r.requestedBy);\n        const foreman = r.foremanId ? await storage.getUser(r.foremanId) : null;\n        const manager = r.managerId ? await storage.getUser(r.managerId) : null;\n        return { \n          ...r, \n          enrollment: enrollment ? { ...enrollment, course } : null,\n          requester,\n          foreman,\n          manager,\n        };\n      }));\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get my renewals error:\", error);\n      res.status(500).json({ error: \"Failed to fetch renewals\" });\n    }\n  });\n\n  app.get(\"/api/renewals/pending\", isAuthenticated, requireRole('foreman', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const approvals = await storage.getPendingApprovals(req.user!.id, req.user!.role);\n      // Enrich with enrollment (including course), requester, foreman, manager data\n      const enriched = await Promise.all(approvals.map(async (r) => {\n        const enrollment = await storage.getEnrollment(r.enrollmentId);\n        const course = enrollment ? await storage.getCourse(enrollment.courseId) : null;\n        const requester = await storage.getUser(r.requestedBy);\n        const foreman = r.foremanId ? await storage.getUser(r.foremanId) : null;\n        const manager = r.managerId ? await storage.getUser(r.managerId) : null;\n        return { \n          ...r, \n          enrollment: enrollment ? { ...enrollment, course } : null,\n          requester,\n          foreman,\n          manager,\n        };\n      }));\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get pending approvals error:\", error);\n      res.status(500).json({ error: \"Failed to fetch pending approvals\" });\n    }\n  });\n\n  app.post(\"/api/renewals\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const data = insertRenewalRequestSchema.parse(req.body);\n      const renewal = await storage.createRenewalRequest({\n        ...data,\n        requestedBy: req.user!.id,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      await auditLog(req.user!.id, 'submit', 'renewal_request', String(renewal.id), null, renewal, req);\n      \n      // Notify foremen about new renewal request\n      const foremen = await storage.getUsersByRole('foreman', req.user!.tenantId || 'default');\n      for (const foreman of foremen) {\n        await storage.createNotification({\n          userId: foreman.id,\n          type: 'renewal_request',\n          title: 'New Renewal Request',\n          message: `${req.user!.firstName} ${req.user!.lastName} submitted a training renewal request`,\n          relatedEntityType: 'renewal_request',\n          relatedEntityId: renewal.id,\n          tenantId: req.user!.tenantId || 'default',\n        });\n      }\n      \n      res.status(201).json(renewal);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      console.error(\"Create renewal error:\", error);\n      res.status(500).json({ error: \"Failed to create renewal request\" });\n    }\n  });\n\n  app.post(\"/api/renewals/:id/approve\", isAuthenticated, requireRole('foreman', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const renewal = await storage.getRenewalRequest(id);\n      if (!renewal) {\n        return res.status(404).json({ error: \"Renewal request not found\" });\n      }\n\n      const { comments } = req.body;\n      let updates: Partial<typeof renewal> = {};\n      let newStatus: string;\n\n      if (req.user!.role === 'foreman' && renewal.status === 'pending') {\n        updates = {\n          status: 'foreman_approved',\n          foremanId: req.user!.id,\n          foremanApprovedAt: new Date(),\n          foremanComments: comments || null,\n        };\n        newStatus = 'foreman_approved';\n        \n        // Notify managers\n        const managers = await storage.getUsersByRole('manager', req.user!.tenantId || 'default');\n        for (const manager of managers) {\n          await storage.createNotification({\n            userId: manager.id,\n            type: 'approval_needed',\n            title: 'Renewal Awaiting Manager Approval',\n            message: `A training renewal request has been approved by foreman and needs your review`,\n            relatedEntityType: 'renewal_request',\n            relatedEntityId: id,\n            tenantId: req.user!.tenantId || 'default',\n          });\n        }\n      } else if (req.user!.role === 'manager' && renewal.status === 'foreman_approved') {\n        updates = {\n          status: 'manager_approved',\n          managerId: req.user!.id,\n          managerApprovedAt: new Date(),\n          managerComments: comments || null,\n        };\n        newStatus = 'manager_approved';\n        \n        // Update enrollment status and extend expiry\n        const enrollment = await storage.getEnrollment(renewal.enrollmentId);\n        if (enrollment) {\n          const course = await storage.getCourse(enrollment.courseId);\n          const newExpiresAt = new Date();\n          newExpiresAt.setDate(newExpiresAt.getDate() + (course?.validityPeriodDays || 365));\n          await storage.updateEnrollment(enrollment.id, {\n            status: 'active',\n            expiresAt: newExpiresAt,\n          });\n        }\n        \n        // Notify requester\n        await storage.createNotification({\n          userId: renewal.requestedBy,\n          type: 'system',\n          title: 'Renewal Request Approved',\n          message: `Your training renewal request has been fully approved`,\n          relatedEntityType: 'renewal_request',\n          relatedEntityId: id,\n          tenantId: req.user!.tenantId || 'default',\n        });\n      } else {\n        return res.status(400).json({ error: \"Cannot approve this request in its current state\" });\n      }\n\n      const updated = await storage.updateRenewalRequest(id, updates as any);\n      await auditLog(req.user!.id, 'approve', 'renewal_request', String(id), renewal, updated, req);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Approve renewal error:\", error);\n      res.status(500).json({ error: \"Failed to approve renewal\" });\n    }\n  });\n\n  app.post(\"/api/renewals/:id/reject\", isAuthenticated, requireRole('foreman', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const renewal = await storage.getRenewalRequest(id);\n      if (!renewal) {\n        return res.status(404).json({ error: \"Renewal request not found\" });\n      }\n\n      const { reason } = req.body;\n      if (!reason) {\n        return res.status(400).json({ error: \"Rejection reason is required\" });\n      }\n\n      const updated = await storage.updateRenewalRequest(id, {\n        status: 'rejected',\n        rejectedBy: req.user!.id,\n        rejectedAt: new Date(),\n        rejectionReason: reason,\n      });\n      await auditLog(req.user!.id, 'reject', 'renewal_request', String(id), renewal, updated, req);\n      \n      // Notify requester\n      await storage.createNotification({\n        userId: renewal.requestedBy,\n        type: 'system',\n        title: 'Renewal Request Rejected',\n        message: `Your training renewal request was rejected: ${reason}`,\n        relatedEntityType: 'renewal_request',\n        relatedEntityId: id,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Reject renewal error:\", error);\n      res.status(500).json({ error: \"Failed to reject renewal\" });\n    }\n  });\n\n  // =====================\n  // NOTIFICATION ROUTES\n  // =====================\n  app.get(\"/api/notifications\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { unread } = req.query;\n      const notifications = await storage.getNotificationsByUser(req.user!.id, unread === 'true');\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.post(\"/api/notifications/:id/read\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      await storage.markNotificationRead(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark notification read error:\", error);\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  app.post(\"/api/notifications/read-all\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      await storage.markAllNotificationsRead(req.user!.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark all notifications read error:\", error);\n      res.status(500).json({ error: \"Failed to mark all notifications as read\" });\n    }\n  });\n\n  // =====================\n  // PROGRESSION TASK ROUTES\n  // =====================\n  app.get(\"/api/progression\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      let tasks;\n      if (req.user!.role === 'administrator' || req.user!.role === 'training_officer') {\n        tasks = await storage.getAllProgressionTasks(req.user!.tenantId || 'default');\n      } else {\n        tasks = await storage.getProgressionTasksByUser(req.user!.id);\n      }\n      \n      // Enrich with course data\n      const enriched = await Promise.all(tasks.map(async (t) => {\n        const course = t.requiredCourseId ? await storage.getCourse(t.requiredCourseId) : null;\n        const user = await storage.getUser(t.userId);\n        return { ...t, course, user };\n      }));\n      \n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get progression tasks error:\", error);\n      res.status(500).json({ error: \"Failed to fetch progression tasks\" });\n    }\n  });\n\n  app.post(\"/api/progression\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const data = insertProgressionTaskSchema.parse(req.body);\n      const task = await storage.createProgressionTask({\n        ...data,\n        assignedBy: req.user!.id,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      await auditLog(req.user!.id, 'create', 'progression_task', String(task.id), null, task, req);\n      \n      // Notify the employee\n      await storage.createNotification({\n        userId: task.userId,\n        type: 'system',\n        title: 'New Progression Task Assigned',\n        message: `You have been assigned a new progression task: ${task.title}`,\n        relatedEntityType: 'progression_task',\n        relatedEntityId: task.id,\n        tenantId: req.user!.tenantId || 'default',\n      });\n      \n      res.status(201).json(task);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      console.error(\"Create progression task error:\", error);\n      res.status(500).json({ error: \"Failed to create progression task\" });\n    }\n  });\n\n  app.patch(\"/api/progression/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const oldTask = await storage.getProgressionTask(parseInt(req.params.id));\n      const updated = await storage.updateProgressionTask(parseInt(req.params.id), req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Progression task not found\" });\n      }\n      await auditLog(req.user!.id, 'update', 'progression_task', req.params.id, oldTask, updated, req);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Update progression task error:\", error);\n      res.status(500).json({ error: \"Failed to update progression task\" });\n    }\n  });\n\n  // =====================\n  // AUDIT LOG ROUTES\n  // =====================\n  app.get(\"/api/audit-logs\", isAuthenticated, requireRole('administrator'), async (req: Request, res: Response) => {\n    try {\n      const { limit, userId, entityType, entityId } = req.query;\n      let logs;\n      \n      if (userId && typeof userId === 'string') {\n        logs = await storage.getAuditLogsByUser(userId, parseInt(limit as string) || 50);\n      } else if (entityType && entityId && typeof entityType === 'string' && typeof entityId === 'string') {\n        logs = await storage.getAuditLogsByEntity(entityType, entityId);\n      } else {\n        logs = await storage.getAuditLogs(req.user!.tenantId || 'default', parseInt(limit as string) || 100);\n      }\n      \n      // Enrich with user data\n      const enriched = await Promise.all(logs.map(async (log) => {\n        const user = log.userId ? await storage.getUser(log.userId) : null;\n        return { ...log, user };\n      }));\n      \n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get audit logs error:\", error);\n      res.status(500).json({ error: \"Failed to fetch audit logs\" });\n    }\n  });\n\n  // =====================\n  // AI RECOMMENDATION ROUTES\n  // =====================\n  app.get(\"/api/recommendations\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { includeProcessed } = req.query;\n      const recommendations = await storage.getRecommendationsByUser(\n        req.user!.id,\n        includeProcessed === 'true'\n      );\n      \n      // Enrich with course data\n      const enriched = await Promise.all(recommendations.map(async (r) => {\n        const course = await storage.getCourse(r.courseId);\n        return { ...r, course };\n      }));\n      \n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get recommendations error:\", error);\n      res.status(500).json({ error: \"Failed to fetch recommendations\" });\n    }\n  });\n\n  app.post(\"/api/recommendations/generate\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      // Get user's current enrollments and progression\n      const enrollments = await storage.getEnrollmentsByUser(req.user!.id);\n      const progressionTasks = await storage.getProgressionTasksByUser(req.user!.id);\n      const allCourses = await storage.getActiveCourses(req.user!.tenantId || 'default');\n      \n      // Get enrolled course IDs\n      const enrolledCourseIds = new Set(enrollments.map(e => e.courseId));\n      \n      // Filter to courses not yet enrolled\n      const availableCourses = allCourses.filter(c => !enrolledCourseIds.has(c.id));\n      \n      if (availableCourses.length === 0) {\n        return res.json({ message: \"You are already enrolled in all available courses!\" });\n      }\n\n      // Use OpenAI to generate personalized recommendations\n      const openai = new OpenAI();\n      \n      const prompt = `You are an AI career development advisor for an enterprise training platform. \n      \n      Employee Profile:\n      - Name: ${req.user!.firstName} ${req.user!.lastName}\n      - Current Role: ${req.user!.role}\n      - Current Grade: ${req.user!.currentGrade || 'Not specified'}\n      - Job Title: ${req.user!.jobTitle || 'Not specified'}\n      \n      Current Enrollments: ${enrollments.map(e => e.courseId).join(', ')}\n      \n      Progression Goals: ${progressionTasks.map(t => t.targetGrade).join(', ') || 'None specified'}\n      \n      Available Courses:\n      ${availableCourses.map(c => `- ID: ${c.id}, Title: ${c.title}, Category: ${c.category}, Mandatory: ${c.isMandatory}, Duration: ${c.duration || 'N/A'}`).join('\\n')}\n      \n      Based on the employee's profile and goals, recommend up to 3 courses that would be most beneficial for their career development. For each recommendation, explain WHY this course is valuable for them.\n      \n      Respond in JSON format:\n      {\n        \"recommendations\": [\n          {\"courseId\": <number>, \"reason\": \"<explanation>\", \"confidence\": <0-100>}\n        ]\n      }`;\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [{ role: \"user\", content: prompt }],\n        response_format: { type: \"json_object\" },\n      });\n\n      const content = response.choices[0]?.message?.content;\n      if (!content) {\n        throw new Error(\"No response from AI\");\n      }\n\n      const parsed = JSON.parse(content);\n      const recommendations = parsed.recommendations || [];\n      \n      // Save recommendations to database\n      const saved = await Promise.all(recommendations.map(async (rec: { courseId: number; reason: string; confidence: number }) => {\n        return storage.createRecommendation({\n          userId: req.user!.id,\n          courseId: rec.courseId,\n          reason: rec.reason,\n          confidence: rec.confidence,\n          tenantId: req.user!.tenantId || 'default',\n        });\n      }));\n      \n      // Enrich with course data\n      const enriched = await Promise.all(saved.map(async (r) => {\n        const course = await storage.getCourse(r.courseId);\n        return { ...r, course };\n      }));\n      \n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Generate recommendations error:\", error);\n      res.status(500).json({ error: \"Failed to generate recommendations\" });\n    }\n  });\n\n  app.post(\"/api/recommendations/:id/accept\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const updated = await storage.updateRecommendation(parseInt(req.params.id), {\n        isAccepted: true,\n      });\n      if (!updated) {\n        return res.status(404).json({ error: \"Recommendation not found\" });\n      }\n      \n      // Create enrollment for the accepted recommendation\n      const course = await storage.getCourse(updated.courseId);\n      if (course) {\n        const expiresAt = new Date();\n        expiresAt.setDate(expiresAt.getDate() + course.validityPeriodDays);\n        \n        await storage.createEnrollment({\n          userId: req.user!.id,\n          courseId: course.id,\n          expiresAt,\n          status: 'active',\n          tenantId: req.user!.tenantId || 'default',\n        });\n      }\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Accept recommendation error:\", error);\n      res.status(500).json({ error: \"Failed to accept recommendation\" });\n    }\n  });\n\n  app.post(\"/api/recommendations/:id/dismiss\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const updated = await storage.updateRecommendation(parseInt(req.params.id), {\n        isDismissed: true,\n      });\n      if (!updated) {\n        return res.status(404).json({ error: \"Recommendation not found\" });\n      }\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Dismiss recommendation error:\", error);\n      res.status(500).json({ error: \"Failed to dismiss recommendation\" });\n    }\n  });\n\n  // =====================\n  // REPORTS ROUTES\n  // =====================\n  app.get(\"/api/reports/stats\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const users = await storage.getAllUsers(req.user!.tenantId || 'default');\n      const courses = await storage.getAllCourses(req.user!.tenantId || 'default');\n      const enrollments = await storage.getAllEnrollments(req.user!.tenantId || 'default');\n      const renewals = await storage.getAllRenewalRequests(req.user!.tenantId || 'default');\n      const departments = await storage.getAllDepartments(req.user!.tenantId || 'default');\n      \n      const now = new Date();\n      const thirtyDaysFromNow = new Date(now);\n      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n      \n      const activeEnrollments = enrollments.filter(e => \n        e.status === 'active' && e.expiresAt && new Date(e.expiresAt) > now\n      );\n      const expiringEnrollments = enrollments.filter(e => \n        e.status === 'active' && e.expiresAt && \n        new Date(e.expiresAt) > now && new Date(e.expiresAt) <= thirtyDaysFromNow\n      );\n      const expiredEnrollments = enrollments.filter(e => \n        e.expiresAt && new Date(e.expiresAt) <= now\n      );\n      \n      // Calculate compliance rate (employees with all mandatory courses active)\n      const mandatoryCourses = courses.filter(c => c.isMandatory && c.isActive);\n      const employees = users.filter(u => u.role === 'employee');\n      let compliantCount = 0;\n      \n      for (const emp of employees) {\n        const empEnrollments = activeEnrollments.filter(e => e.userId === emp.id);\n        const hasAllMandatory = mandatoryCourses.every(mc => \n          empEnrollments.some(e => e.courseId === mc.id)\n        );\n        if (hasAllMandatory || mandatoryCourses.length === 0) compliantCount++;\n      }\n      \n      const complianceRate = employees.length > 0 \n        ? Math.round((compliantCount / employees.length) * 100) \n        : 100;\n      \n      // Calculate pending renewals\n      const pendingRenewals = renewals.filter(r => \n        r.status === 'pending' || r.status === 'foreman_approved'\n      ).length;\n      \n      // Approved this month\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n      const approvedThisMonth = renewals.filter(r => \n        (r.status === 'manager_approved' || r.status === 'completed') && \n        r.managerApprovedAt && new Date(r.managerApprovedAt) >= startOfMonth\n      ).length;\n      \n      // Department stats\n      const departmentStats = await Promise.all(departments.map(async (dept) => {\n        const deptUsers = users.filter(u => u.departmentId === dept.id);\n        const deptEnrollments = activeEnrollments.filter(e => \n          deptUsers.some(u => u.id === e.userId)\n        );\n        \n        let deptCompliant = 0;\n        for (const u of deptUsers) {\n          const uEnrollments = activeEnrollments.filter(e => e.userId === u.id);\n          const hasAllMandatory = mandatoryCourses.every(mc => \n            uEnrollments.some(e => e.courseId === mc.id)\n          );\n          if (hasAllMandatory || mandatoryCourses.length === 0) deptCompliant++;\n        }\n        \n        return {\n          name: dept.name,\n          employees: deptUsers.length,\n          compliance: deptUsers.length > 0 \n            ? Math.round((deptCompliant / deptUsers.length) * 100) \n            : 100,\n        };\n      }));\n      \n      res.json({\n        totalEmployees: employees.length,\n        totalCourses: courses.filter(c => c.isActive).length,\n        totalEnrollments: enrollments.length,\n        activeEnrollments: activeEnrollments.length,\n        expiringEnrollments: expiringEnrollments.length,\n        expiredEnrollments: expiredEnrollments.length,\n        complianceRate,\n        pendingRenewals,\n        approvedThisMonth,\n        departmentStats,\n      });\n    } catch (error) {\n      console.error(\"Get report stats error:\", error);\n      res.status(500).json({ error: \"Failed to generate report stats\" });\n    }\n  });\n\n  app.get(\"/api/reports/expiring-courses\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const days = parseInt(req.query.days as string) || 30;\n      const expiring = await storage.getExpiringEnrollments(days, req.user!.tenantId || 'default');\n      \n      // Enrich with user and course data\n      const enriched = await Promise.all(expiring.map(async (e) => {\n        const user = await storage.getUser(e.userId);\n        const course = await storage.getCourse(e.courseId);\n        return { ...e, user, course };\n      }));\n      \n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get expiring courses report error:\", error);\n      res.status(500).json({ error: \"Failed to generate report\" });\n    }\n  });\n\n  app.get(\"/api/reports/compliance\", isAuthenticated, requireRole('administrator', 'training_officer'), async (req: Request, res: Response) => {\n    try {\n      const users = await storage.getAllUsers(req.user!.tenantId || 'default');\n      const allEnrollments = await storage.getAllEnrollments(req.user!.tenantId || 'default');\n      const mandatoryCourses = (await storage.getAllCourses(req.user!.tenantId || 'default'))\n        .filter(c => c.isMandatory && c.isActive);\n      \n      const now = new Date();\n      \n      const compliance = users.map(user => {\n        const userEnrollments = allEnrollments.filter(e => e.userId === user.id);\n        const activeEnrollments = userEnrollments.filter(e => \n          e.status === 'active' && e.expiresAt && e.expiresAt > now\n        );\n        const completedMandatory = mandatoryCourses.filter(mc => \n          activeEnrollments.some(e => e.courseId === mc.id)\n        );\n        \n        return {\n          user,\n          totalMandatory: mandatoryCourses.length,\n          completedMandatory: completedMandatory.length,\n          complianceRate: mandatoryCourses.length > 0 \n            ? Math.round((completedMandatory.length / mandatoryCourses.length) * 100) \n            : 100,\n          activeEnrollments: activeEnrollments.length,\n        };\n      });\n      \n      res.json(compliance);\n    } catch (error) {\n      console.error(\"Get compliance report error:\", error);\n      res.status(500).json({ error: \"Failed to generate compliance report\" });\n    }\n  });\n\n  app.get(\"/api/reports/stats\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const tenantId = req.user!.tenantId || 'default';\n      const users = await storage.getAllUsers(tenantId);\n      const enrollments = await storage.getAllEnrollments(tenantId);\n      const allCourses = await storage.getAllCourses(tenantId);\n      const renewals = await storage.getAllRenewalRequests(tenantId);\n      const departments = await storage.getAllDepartments(tenantId);\n      \n      const now = new Date();\n      const thirtyDaysFromNow = new Date();\n      thirtyDaysFromNow.setDate(now.getDate() + 30);\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n      \n      const employees = users.filter(u => u.role === 'employee' || u.role === 'foreman');\n      \n      const activeEnrollments = enrollments.filter(e => \n        e.status === 'active' || e.status === 'completed'\n      ).length;\n      \n      const expiringEnrollments = enrollments.filter(e => {\n        if (!e.expiresAt) return false;\n        const expDate = new Date(e.expiresAt);\n        return expDate > now && expDate <= thirtyDaysFromNow;\n      }).length;\n      \n      const expiredEnrollments = enrollments.filter(e => {\n        if (!e.expiresAt) return false;\n        return new Date(e.expiresAt) < now;\n      }).length;\n      \n      const employeesWithTraining = employees.filter(u => \n        enrollments.some(e => e.userId === u.id)\n      );\n      \n      // Compliant = has training and no expired courses\n      const compliantEmployeesCount = employeesWithTraining.filter(u => {\n        const userEnrollments = enrollments.filter(e => e.userId === u.id);\n        return !userEnrollments.some(e => e.expiresAt && new Date(e.expiresAt) < now);\n      }).length;\n      \n      // Training Compliance Rate: Compliant trained / All trained (excludes untrained employees)\n      const trainingComplianceRate = employeesWithTraining.length > 0 \n        ? Math.round((compliantEmployeesCount / employeesWithTraining.length) * 100)\n        : 0;\n      \n      // Overall Compliance Rate: Compliant trained / ALL employees (untrained count as non-compliant)\n      const overallComplianceRate = employees.length > 0 \n        ? Math.round((compliantEmployeesCount / employees.length) * 100)\n        : 0;\n      \n      const pendingRenewals = renewals.filter(r => \n        r.status === 'pending' || r.status === 'foreman_approved'\n      ).length;\n      \n      const approvedThisMonth = renewals.filter(r => {\n        if (r.status !== 'manager_approved' && r.status !== 'completed') return false;\n        if (!r.managerApprovedAt) return false;\n        return new Date(r.managerApprovedAt) >= startOfMonth;\n      }).length;\n      \n      const departmentStats = departments.map(dept => {\n        const deptUsers = employees.filter(u => u.departmentId === dept.id);\n        const deptEnrollments = enrollments.filter(e => \n          deptUsers.some(u => u.id === e.userId)\n        );\n        const deptExpired = deptEnrollments.filter(e => \n          e.expiresAt && new Date(e.expiresAt) < now\n        ).length;\n        const deptCompliance = deptEnrollments.length > 0\n          ? Math.round(((deptEnrollments.length - deptExpired) / deptEnrollments.length) * 100)\n          : 100;\n        \n        return {\n          name: dept.name,\n          employees: deptUsers.length,\n          compliance: deptCompliance,\n        };\n      });\n      \n      res.json({\n        totalEmployees: employees.length,\n        employeesWithTraining: employeesWithTraining.length,\n        employeesWithoutTraining: employees.length - employeesWithTraining.length,\n        compliantEmployees: compliantEmployeesCount,\n        totalCourses: allCourses.length,\n        totalEnrollments: enrollments.length,\n        activeEnrollments,\n        expiringEnrollments,\n        expiredEnrollments,\n        complianceRate: trainingComplianceRate,\n        trainingComplianceRate,\n        overallComplianceRate,\n        pendingRenewals,\n        approvedThisMonth,\n        departmentStats,\n      });\n    } catch (error) {\n      console.error(\"Get report stats error:\", error);\n      res.status(500).json({ error: \"Failed to generate report stats\" });\n    }\n  });\n\n  app.get(\"/api/reports/renewal-stats\", isAuthenticated, requireRole('administrator', 'training_officer'), async (req: Request, res: Response) => {\n    try {\n      const renewals = await storage.getAllRenewalRequests(req.user!.tenantId || 'default');\n      \n      const stats = {\n        total: renewals.length,\n        pending: renewals.filter(r => r.status === 'pending').length,\n        foremanApproved: renewals.filter(r => r.status === 'foreman_approved').length,\n        managerApproved: renewals.filter(r => r.status === 'manager_approved').length,\n        rejected: renewals.filter(r => r.status === 'rejected').length,\n        completed: renewals.filter(r => r.status === 'completed').length,\n      };\n      \n      res.json(stats);\n    } catch (error) {\n      console.error(\"Get renewal stats error:\", error);\n      res.status(500).json({ error: \"Failed to generate renewal stats\" });\n    }\n  });\n\n  // =====================\n  // REPORT EXPORT ROUTES\n  // =====================\n  \n  // Training Compliance Report\n  app.get(\"/api/reports/export/training-compliance/:format\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const { format } = req.params;\n      const tenantId = req.user!.tenantId || 'default';\n      const data = await generateTrainingComplianceData(tenantId);\n      \n      await auditLog(req.user!.id, 'create', 'report_export', 'training_compliance', null, { format }, req);\n      \n      if (format === 'pdf') {\n        const buffer = await generateTrainingCompliancePDF(data);\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', 'attachment; filename=training-compliance-report.pdf');\n        res.send(buffer);\n      } else if (format === 'excel') {\n        const buffer = generateTrainingComplianceExcel(data);\n        res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n        res.setHeader('Content-Disposition', 'attachment; filename=training-compliance-report.xlsx');\n        res.send(buffer);\n      } else if (format === 'json') {\n        const jsonData = generateJSONExport(data);\n        res.setHeader('Content-Type', 'application/json');\n        res.setHeader('Content-Disposition', 'attachment; filename=training-compliance-report.json');\n        res.send(jsonData);\n      } else {\n        res.status(400).json({ error: 'Invalid format. Use pdf, excel, or json.' });\n      }\n    } catch (error) {\n      console.error(\"Training compliance export error:\", error);\n      res.status(500).json({ error: \"Failed to generate training compliance report\" });\n    }\n  });\n  \n  // Employee Progress Report\n  app.get(\"/api/reports/export/employee-progress/:userId/:format\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { userId, format } = req.params;\n      const tenantId = req.user!.tenantId || 'default';\n      \n      const canView = req.user!.id === userId || \n        ['administrator', 'training_officer', 'manager'].includes(req.user!.role);\n      \n      if (!canView) {\n        return res.status(403).json({ error: \"Insufficient permissions\" });\n      }\n      \n      const data = await generateEmployeeProgressData(userId, tenantId);\n      if (!data) {\n        return res.status(404).json({ error: \"Employee not found or not in your tenant\" });\n      }\n      \n      await auditLog(req.user!.id, 'create', 'report_export', 'employee_progress', null, { userId, format }, req);\n      \n      if (format === 'pdf') {\n        const buffer = await generateEmployeeProgressPDF(data);\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', `attachment; filename=employee-progress-${userId}.pdf`);\n        res.send(buffer);\n      } else if (format === 'excel') {\n        const buffer = generateEmployeeProgressExcel(data);\n        res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n        res.setHeader('Content-Disposition', `attachment; filename=employee-progress-${userId}.xlsx`);\n        res.send(buffer);\n      } else if (format === 'json') {\n        const jsonData = generateJSONExport(data);\n        res.setHeader('Content-Type', 'application/json');\n        res.setHeader('Content-Disposition', `attachment; filename=employee-progress-${userId}.json`);\n        res.send(jsonData);\n      } else {\n        res.status(400).json({ error: 'Invalid format. Use pdf, excel, or json.' });\n      }\n    } catch (error) {\n      console.error(\"Employee progress export error:\", error);\n      res.status(500).json({ error: \"Failed to generate employee progress report\" });\n    }\n  });\n  \n  // Department Statistics Report\n  app.get(\"/api/reports/export/department/:departmentId/:format\", isAuthenticated, requireRole('administrator', 'training_officer', 'manager'), async (req: Request, res: Response) => {\n    try {\n      const { departmentId, format } = req.params;\n      const tenantId = req.user!.tenantId || 'default';\n      const deptId = parseInt(departmentId, 10);\n      \n      // Verify department belongs to tenant before generating any data\n      const departmentCheck = await verifyDepartmentTenant(deptId, tenantId);\n      if (!departmentCheck) {\n        return res.status(404).json({ error: \"Department not found\" });\n      }\n      \n      const data = await generateDepartmentStatsData(deptId, tenantId);\n      if (!data) {\n        return res.status(404).json({ error: \"Department not found or not in your tenant\" });\n      }\n      \n      await auditLog(req.user!.id, 'create', 'report_export', 'department_stats', null, { departmentId, format }, req);\n      \n      if (format === 'pdf') {\n        const buffer = await generateDepartmentStatsPDF(data);\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', `attachment; filename=department-report-${departmentId}.pdf`);\n        res.send(buffer);\n      } else if (format === 'excel') {\n        const buffer = generateDepartmentStatsExcel(data);\n        res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n        res.setHeader('Content-Disposition', `attachment; filename=department-report-${departmentId}.xlsx`);\n        res.send(buffer);\n      } else if (format === 'json') {\n        const jsonData = generateJSONExport(data);\n        res.setHeader('Content-Type', 'application/json');\n        res.setHeader('Content-Disposition', `attachment; filename=department-report-${departmentId}.json`);\n        res.send(jsonData);\n      } else {\n        res.status(400).json({ error: 'Invalid format. Use pdf, excel, or json.' });\n      }\n    } catch (error) {\n      console.error(\"Department stats export error:\", error);\n      res.status(500).json({ error: \"Failed to generate department report\" });\n    }\n  });\n\n  // =====================\n  // ADMIN WORKER ROUTES\n  // =====================\n  app.post(\"/api/admin/run-expiration-check\", isAuthenticated, requireRole('administrator'), async (req: Request, res: Response) => {\n    try {\n      const result = await runManualExpirationCheck();\n      await auditLog(req.user!.id, 'create', 'expiration_check', 'manual', null, result, req);\n      res.json({\n        success: true,\n        message: 'Expiration check completed',\n        ...result,\n      });\n    } catch (error) {\n      console.error(\"Manual expiration check error:\", error);\n      res.status(500).json({ error: \"Failed to run expiration check\" });\n    }\n  });\n\n  // =====================\n  // SEED DATA ROUTE (for development)\n  // =====================\n  app.post(\"/api/seed\", isAuthenticated, requireRole('administrator'), async (req: Request, res: Response) => {\n    try {\n      // Create departments\n      const engineering = await storage.createDepartment({\n        name: 'Engineering',\n        code: 'ENG',\n        tenantId: 'default',\n      });\n      \n      const operations = await storage.createDepartment({\n        name: 'Operations',\n        code: 'OPS',\n        tenantId: 'default',\n      });\n      \n      // Create courses\n      const courses = [\n        { title: 'Workplace Safety Fundamentals', category: 'Safety', validityPeriodDays: 365, isMandatory: true, duration: '4 hours', provider: 'Internal' },\n        { title: 'Fire Safety & Emergency Response', category: 'Safety', validityPeriodDays: 365, isMandatory: true, duration: '2 hours', provider: 'Internal' },\n        { title: 'First Aid & CPR', category: 'Safety', validityPeriodDays: 730, isMandatory: false, duration: '8 hours', provider: 'Red Cross' },\n        { title: 'Forklift Operation Certification', category: 'Equipment', validityPeriodDays: 1095, isMandatory: false, duration: '16 hours', provider: 'OSHA' },\n        { title: 'Leadership Development', category: 'Professional', validityPeriodDays: 730, isMandatory: false, duration: '24 hours', provider: 'Internal' },\n        { title: 'Project Management Basics', category: 'Professional', validityPeriodDays: 1095, isMandatory: false, duration: '40 hours', provider: 'PMI' },\n        { title: 'Data Privacy & Security', category: 'Compliance', validityPeriodDays: 365, isMandatory: true, duration: '3 hours', provider: 'Internal' },\n        { title: 'Anti-Harassment Training', category: 'Compliance', validityPeriodDays: 365, isMandatory: true, duration: '2 hours', provider: 'HR' },\n      ];\n      \n      for (const course of courses) {\n        await storage.createCourse({\n          ...course,\n          tenantId: 'default',\n          isActive: true,\n        });\n      }\n      \n      await auditLog(req.user!.id, 'create', 'seed_data', 'all', null, { departments: 2, courses: courses.length }, req);\n      \n      res.json({ \n        success: true, \n        message: 'Seed data created successfully',\n        departments: 2,\n        courses: courses.length,\n      });\n    } catch (error) {\n      console.error(\"Seed data error:\", error);\n      res.status(500).json({ error: \"Failed to seed data\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":52481,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/audit-logs.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { DataTable } from \"@/components/data-table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useState } from \"react\";\nimport { \n  History, \n  Search, \n  Filter,\n  LogIn,\n  LogOut,\n  Plus,\n  Edit,\n  Trash2,\n  CheckCircle2,\n  XCircle,\n  Send\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { AuditLog, User } from \"@shared/schema\";\n\ninterface AuditLogWithUser extends AuditLog {\n  user?: User;\n}\n\nconst actionIcons: Record<string, React.ReactNode> = {\n  create: <Plus className=\"h-4 w-4 text-chart-2\" />,\n  update: <Edit className=\"h-4 w-4 text-chart-1\" />,\n  delete: <Trash2 className=\"h-4 w-4 text-destructive\" />,\n  login: <LogIn className=\"h-4 w-4 text-chart-4\" />,\n  logout: <LogOut className=\"h-4 w-4 text-muted-foreground\" />,\n  approve: <CheckCircle2 className=\"h-4 w-4 text-chart-2\" />,\n  reject: <XCircle className=\"h-4 w-4 text-destructive\" />,\n  submit: <Send className=\"h-4 w-4 text-chart-3\" />,\n};\n\nconst actionLabels: Record<string, string> = {\n  create: \"Created\",\n  update: \"Updated\",\n  delete: \"Deleted\",\n  login: \"Logged In\",\n  logout: \"Logged Out\",\n  approve: \"Approved\",\n  reject: \"Rejected\",\n  submit: \"Submitted\",\n};\n\nconst entityLabels: Record<string, string> = {\n  user: \"User\",\n  course: \"Course\",\n  enrollment: \"Enrollment\",\n  renewal_request: \"Renewal Request\",\n  notification: \"Notification\",\n  progression_task: \"Progression Task\",\n  department: \"Department\",\n};\n\nexport default function AuditLogs() {\n  const [search, setSearch] = useState(\"\");\n  const [actionFilter, setActionFilter] = useState<string>(\"all\");\n  const [entityFilter, setEntityFilter] = useState<string>(\"all\");\n\n  const { data: logs = [], isLoading } = useQuery<AuditLogWithUser[]>({\n    queryKey: [\"/api/audit-logs\"],\n  });\n\n  const filteredLogs = logs.filter((log) => {\n    const matchesSearch =\n      log.user?.firstName?.toLowerCase().includes(search.toLowerCase()) ||\n      log.user?.lastName?.toLowerCase().includes(search.toLowerCase()) ||\n      log.entityType.toLowerCase().includes(search.toLowerCase());\n\n    const matchesAction = actionFilter === \"all\" || log.action === actionFilter;\n    const matchesEntity = entityFilter === \"all\" || log.entityType === entityFilter;\n\n    return matchesSearch && matchesAction && matchesEntity;\n  });\n\n  const uniqueActions = [...new Set(logs.map((l) => l.action))];\n  const uniqueEntities = [...new Set(logs.map((l) => l.entityType))];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n          <History className=\"h-6 w-6\" />\n          Audit Logs\n        </h1>\n        <p className=\"text-muted-foreground\">\n          View all system activity and changes\n        </p>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search logs...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-logs\"\n          />\n        </div>\n        <Select value={actionFilter} onValueChange={setActionFilter}>\n          <SelectTrigger className=\"w-40\" data-testid=\"filter-action\">\n            <Filter className=\"mr-2 h-4 w-4\" />\n            <SelectValue placeholder=\"Action\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Actions</SelectItem>\n            {uniqueActions.map((action) => (\n              <SelectItem key={action} value={action}>\n                {actionLabels[action] || action}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        <Select value={entityFilter} onValueChange={setEntityFilter}>\n          <SelectTrigger className=\"w-40\" data-testid=\"filter-entity\">\n            <Filter className=\"mr-2 h-4 w-4\" />\n            <SelectValue placeholder=\"Entity\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Entities</SelectItem>\n            {uniqueEntities.map((entity) => (\n              <SelectItem key={entity} value={entity}>\n                {entityLabels[entity] || entity}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{logs.length}</div>\n            <p className=\"text-sm text-muted-foreground\">Total Entries</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-2\">\n              {logs.filter((l) => l.action === \"create\").length}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Creates</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-1\">\n              {logs.filter((l) => l.action === \"update\").length}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Updates</p>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold text-chart-4\">\n              {logs.filter((l) => l.action === \"login\").length}\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Logins</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Logs Table */}\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(10)].map((_, i) => (\n            <Skeleton key={i} className=\"h-16 w-full\" />\n          ))}\n        </div>\n      ) : (\n        <DataTable\n          columns={[\n            {\n              key: \"timestamp\",\n              header: \"Timestamp\",\n              cell: (row) => (\n                <div className=\"text-sm\">\n                  <p>{row.createdAt ? format(new Date(row.createdAt), \"MMM d, yyyy\") : \"-\"}</p>\n                  <p className=\"text-muted-foreground\">\n                    {row.createdAt ? format(new Date(row.createdAt), \"h:mm:ss a\") : \"\"}\n                  </p>\n                </div>\n              ),\n            },\n            {\n              key: \"user\",\n              header: \"User\",\n              cell: (row) =>\n                row.user ? (\n                  <div className=\"flex items-center gap-2\">\n                    <Avatar className=\"h-8 w-8\">\n                      <AvatarImage\n                        src={row.user.profileImageUrl || undefined}\n                        className=\"object-cover\"\n                      />\n                      <AvatarFallback className=\"text-xs\">\n                        {row.user.firstName?.[0]}\n                        {row.user.lastName?.[0]}\n                      </AvatarFallback>\n                    </Avatar>\n                    <span className=\"text-sm\">\n                      {row.user.firstName} {row.user.lastName}\n                    </span>\n                  </div>\n                ) : (\n                  <span className=\"text-muted-foreground text-sm\">System</span>\n                ),\n            },\n            {\n              key: \"action\",\n              header: \"Action\",\n              cell: (row) => (\n                <div className=\"flex items-center gap-2\">\n                  {actionIcons[row.action]}\n                  <span className=\"text-sm font-medium\">\n                    {actionLabels[row.action] || row.action}\n                  </span>\n                </div>\n              ),\n            },\n            {\n              key: \"entity\",\n              header: \"Entity\",\n              cell: (row) => (\n                <div className=\"text-sm\">\n                  <p>{entityLabels[row.entityType] || row.entityType}</p>\n                  {row.entityId && (\n                    <p className=\"text-muted-foreground font-mono text-xs\">\n                      ID: {row.entityId}\n                    </p>\n                  )}\n                </div>\n              ),\n            },\n            {\n              key: \"ip\",\n              header: \"IP Address\",\n              cell: (row) => (\n                <span className=\"text-sm font-mono text-muted-foreground\">\n                  {row.ipAddress || \"-\"}\n                </span>\n              ),\n            },\n          ]}\n          data={filteredLogs}\n          emptyMessage=\"No audit logs found\"\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":9276,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { setTheme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-theme-toggle\">\n          <Sun className=\"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem onClick={() => setTheme(\"light\")} data-testid=\"menu-theme-light\">\n          Light\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")} data-testid=\"menu-theme-dark\">\n          Dark\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"system\")} data-testid=\"menu-theme-system\">\n          System\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":1310,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/recommendations.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { \n  Sparkles, \n  BookOpen,\n  Clock,\n  CheckCircle2,\n  XCircle,\n  TrendingUp,\n  Zap,\n  RefreshCw,\n  Award\n} from \"lucide-react\";\nimport type { AiRecommendation, Course } from \"@shared/schema\";\n\ninterface RecommendationWithCourse extends AiRecommendation {\n  course: Course;\n}\n\nexport default function Recommendations() {\n  const { toast } = useToast();\n\n  const { data: recommendations = [], isLoading, refetch, isFetching } = useQuery<RecommendationWithCourse[]>({\n    queryKey: [\"/api/recommendations\"],\n  });\n\n  const acceptMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"POST\", `/api/recommendations/${id}/accept`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/recommendations\"] });\n      toast({\n        title: \"Course Added\",\n        description: \"The recommended course has been added to your training plan.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to accept recommendation. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const dismissMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"POST\", `/api/recommendations/${id}/dismiss`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/recommendations\"] });\n      toast({\n        title: \"Dismissed\",\n        description: \"The recommendation has been dismissed.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to dismiss recommendation. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/recommendations/generate\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/recommendations\"] });\n      toast({\n        title: \"Recommendations Generated\",\n        description: \"New AI-powered course recommendations are ready.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate recommendations. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const activeRecommendations = recommendations.filter(\n    (r) => !r.isAccepted && !r.isDismissed\n  );\n  const acceptedRecommendations = recommendations.filter((r) => r.isAccepted);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n            <Sparkles className=\"h-6 w-6 text-chart-3\" />\n            AI Recommendations\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Personalized course suggestions based on your role and career progression\n          </p>\n        </div>\n        <Button\n          variant=\"outline\"\n          onClick={() => generateMutation.mutate()}\n          disabled={generateMutation.isPending}\n          data-testid=\"button-generate-recommendations\"\n        >\n          {generateMutation.isPending ? (\n            <>\n              <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n              Generating...\n            </>\n          ) : (\n            <>\n              <Zap className=\"mr-2 h-4 w-4\" />\n              Generate New\n            </>\n          )}\n        </Button>\n      </div>\n\n      {/* Info Banner */}\n      <Card className=\"bg-gradient-to-r from-chart-3/10 to-chart-4/10 border-chart-3/20\">\n        <CardContent className=\"py-4\">\n          <div className=\"flex items-start gap-4\">\n            <div className=\"w-12 h-12 rounded-lg bg-chart-3/20 flex items-center justify-center flex-shrink-0\">\n              <Sparkles className=\"h-6 w-6 text-chart-3\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium mb-1\">Powered by AI</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Our AI analyzes your current certifications, job role, and career progression path\n                to recommend the most relevant training courses for your development. These\n                suggestions are personalized to help you advance in your career.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Active Recommendations */}\n      <div>\n        <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n          <TrendingUp className=\"h-5 w-5 text-chart-1\" />\n          Recommended for You\n        </h2>\n\n        {isLoading || isFetching ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[...Array(3)].map((_, i) => (\n              <Skeleton key={i} className=\"h-64 w-full\" />\n            ))}\n          </div>\n        ) : activeRecommendations.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground/30\" />\n              <h3 className=\"text-lg font-medium mb-2\">No recommendations available</h3>\n              <p className=\"text-muted-foreground mb-4\">\n                Click \"Generate New\" to get personalized course recommendations\n              </p>\n              <Button\n                onClick={() => generateMutation.mutate()}\n                disabled={generateMutation.isPending}\n              >\n                <Zap className=\"mr-2 h-4 w-4\" />\n                Generate Recommendations\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {activeRecommendations.map((rec) => (\n              <Card\n                key={rec.id}\n                className=\"hover-elevate flex flex-col\"\n                data-testid={`recommendation-card-${rec.id}`}\n              >\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between gap-2 mb-2\">\n                    <div className=\"w-10 h-10 rounded-lg bg-chart-3/10 flex items-center justify-center\">\n                      <BookOpen className=\"h-5 w-5 text-chart-3\" />\n                    </div>\n                    {rec.confidence && (\n                      <div className=\"text-right\">\n                        <p className=\"text-xs text-muted-foreground\">Match</p>\n                        <p className=\"text-sm font-medium text-chart-2\">\n                          {rec.confidence}%\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                  <CardTitle className=\"text-base line-clamp-2\">\n                    {rec.course?.title}\n                  </CardTitle>\n                  <CardDescription className=\"line-clamp-1\">\n                    {rec.course?.category}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"flex-1 flex flex-col gap-4\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-muted-foreground mb-3 line-clamp-3\">\n                      {rec.reason}\n                    </p>\n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <Clock className=\"h-4 w-4\" />\n                        {rec.course?.duration || \"Self-paced\"}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <Award className=\"h-4 w-4\" />\n                        {rec.course?.validityPeriodDays} days\n                      </span>\n                    </div>\n                  </div>\n                  {rec.confidence && (\n                    <div className=\"space-y-1\">\n                      <div className=\"flex justify-between text-xs text-muted-foreground\">\n                        <span>Relevance Score</span>\n                        <span>{rec.confidence}%</span>\n                      </div>\n                      <Progress value={rec.confidence} className=\"h-1.5\" />\n                    </div>\n                  )}\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"flex-1\"\n                      onClick={() => dismissMutation.mutate(rec.id)}\n                      disabled={dismissMutation.isPending}\n                      data-testid={`button-dismiss-${rec.id}`}\n                    >\n                      <XCircle className=\"mr-2 h-4 w-4\" />\n                      Dismiss\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      className=\"flex-1\"\n                      onClick={() => acceptMutation.mutate(rec.id)}\n                      disabled={acceptMutation.isPending}\n                      data-testid={`button-accept-${rec.id}`}\n                    >\n                      <CheckCircle2 className=\"mr-2 h-4 w-4\" />\n                      Accept\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Accepted Recommendations */}\n      {acceptedRecommendations.length > 0 && (\n        <div>\n          <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n            <CheckCircle2 className=\"h-5 w-5 text-chart-2\" />\n            Accepted Recommendations\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {acceptedRecommendations.map((rec) => (\n              <Card\n                key={rec.id}\n                className=\"opacity-75\"\n                data-testid={`accepted-card-${rec.id}`}\n              >\n                <CardContent className=\"py-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-chart-2/10 flex items-center justify-center flex-shrink-0\">\n                      <CheckCircle2 className=\"h-5 w-5 text-chart-2\" />\n                    </div>\n                    <div className=\"min-w-0\">\n                      <p className=\"font-medium truncate\">{rec.course?.title}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Added to training plan\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11165,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { eq, and, or, gte, lte, desc, asc, sql, isNull, lt } from \"drizzle-orm\";\nimport {\n  users, departments, courses, enrollments, renewalRequests,\n  notifications, progressionTasks, auditLogs, aiRecommendations,\n  type User, type InsertUser, type UpsertUser, type Department, type InsertDepartment,\n  type Course, type InsertCourse, type Enrollment, type InsertEnrollment,\n  type RenewalRequest, type InsertRenewalRequest, type Notification, type InsertNotification,\n  type ProgressionTask, type InsertProgressionTask, type AuditLog, type InsertAuditLog,\n  type AiRecommendation, type InsertAiRecommendation, type UserRole\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getAllUsers(tenantId?: string): Promise<User[]>;\n  getUsersByRole(role: UserRole, tenantId?: string): Promise<User[]>;\n  getUsersByDepartment(departmentId: number): Promise<User[]>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  \n  // Departments\n  getDepartment(id: number): Promise<Department | undefined>;\n  getAllDepartments(tenantId?: string): Promise<Department[]>;\n  createDepartment(department: InsertDepartment): Promise<Department>;\n  updateDepartment(id: number, updates: Partial<InsertDepartment>): Promise<Department | undefined>;\n  \n  // Courses\n  getCourse(id: number): Promise<Course | undefined>;\n  getAllCourses(tenantId?: string): Promise<Course[]>;\n  getActiveCourses(tenantId?: string): Promise<Course[]>;\n  getCoursesByCategory(category: string, tenantId?: string): Promise<Course[]>;\n  createCourse(course: InsertCourse): Promise<Course>;\n  updateCourse(id: number, updates: Partial<InsertCourse>): Promise<Course | undefined>;\n  \n  // Enrollments\n  getEnrollment(id: number): Promise<Enrollment | undefined>;\n  getEnrollmentsByUser(userId: string): Promise<Enrollment[]>;\n  getEnrollmentsByCourse(courseId: number): Promise<Enrollment[]>;\n  getExpiringEnrollments(daysAhead: number, tenantId?: string): Promise<Enrollment[]>;\n  getAllEnrollments(tenantId?: string): Promise<Enrollment[]>;\n  createEnrollment(enrollment: InsertEnrollment): Promise<Enrollment>;\n  updateEnrollment(id: number, updates: Partial<InsertEnrollment>): Promise<Enrollment | undefined>;\n  \n  // Renewal Requests\n  getRenewalRequest(id: number): Promise<RenewalRequest | undefined>;\n  getRenewalRequestsByUser(userId: string): Promise<RenewalRequest[]>;\n  getPendingApprovals(approverId: string, role: UserRole): Promise<RenewalRequest[]>;\n  getAllRenewalRequests(tenantId?: string): Promise<RenewalRequest[]>;\n  createRenewalRequest(request: InsertRenewalRequest): Promise<RenewalRequest>;\n  updateRenewalRequest(id: number, updates: Partial<InsertRenewalRequest>): Promise<RenewalRequest | undefined>;\n  \n  // Notifications\n  getNotificationsByUser(userId: string, unreadOnly?: boolean): Promise<Notification[]>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationRead(id: number): Promise<void>;\n  markAllNotificationsRead(userId: string): Promise<void>;\n  \n  // Progression Tasks\n  getProgressionTask(id: number): Promise<ProgressionTask | undefined>;\n  getProgressionTasksByUser(userId: string): Promise<ProgressionTask[]>;\n  getAllProgressionTasks(tenantId?: string): Promise<ProgressionTask[]>;\n  createProgressionTask(task: InsertProgressionTask): Promise<ProgressionTask>;\n  updateProgressionTask(id: number, updates: Partial<InsertProgressionTask>): Promise<ProgressionTask | undefined>;\n  \n  // Audit Logs\n  getAuditLogs(tenantId?: string, limit?: number): Promise<AuditLog[]>;\n  getAuditLogsByUser(userId: string, limit?: number): Promise<AuditLog[]>;\n  getAuditLogsByEntity(entityType: string, entityId: string): Promise<AuditLog[]>;\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  \n  // AI Recommendations\n  getRecommendationsByUser(userId: string, includeProcessed?: boolean): Promise<AiRecommendation[]>;\n  createRecommendation(rec: InsertAiRecommendation): Promise<AiRecommendation>;\n  updateRecommendation(id: number, updates: Partial<InsertAiRecommendation>): Promise<AiRecommendation | undefined>;\n  \n  // Dashboard Stats\n  getDashboardStats(userId: string, role: UserRole, tenantId?: string): Promise<DashboardStats>;\n}\n\nexport interface DashboardStats {\n  totalCourses: number;\n  completedCourses: number;\n  expiringCourses: number;\n  pendingRenewals: number;\n  pendingApprovals: number;\n  unreadNotifications: number;\n  progressionTasks: number;\n  completedProgressionTasks: number;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getAllUsers(tenantId: string = 'default'): Promise<User[]> {\n    return db.select().from(users).where(eq(users.tenantId, tenantId)).orderBy(asc(users.lastName));\n  }\n\n  async getUsersByRole(role: UserRole, tenantId: string = 'default'): Promise<User[]> {\n    return db.select().from(users)\n      .where(and(eq(users.role, role), eq(users.tenantId, tenantId)))\n      .orderBy(asc(users.lastName));\n  }\n\n  async getUsersByDepartment(departmentId: number): Promise<User[]> {\n    return db.select().from(users).where(eq(users.departmentId, departmentId));\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const [newUser] = await db.insert(users).values(user).returning();\n    return newUser;\n  }\n\n  async updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined> {\n    const [updated] = await db.update(users)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return updated;\n  }\n\n  async upsertUser(user: UpsertUser): Promise<User> {\n    const [upserted] = await db.insert(users)\n      .values(user)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          profileImageUrl: user.profileImageUrl,\n          updatedAt: new Date(),\n        }\n      })\n      .returning();\n    return upserted;\n  }\n\n  // Departments\n  async getDepartment(id: number): Promise<Department | undefined> {\n    const [dept] = await db.select().from(departments).where(eq(departments.id, id));\n    return dept;\n  }\n\n  async getAllDepartments(tenantId: string = 'default'): Promise<Department[]> {\n    return db.select().from(departments).where(eq(departments.tenantId, tenantId));\n  }\n\n  async createDepartment(department: InsertDepartment): Promise<Department> {\n    const [newDept] = await db.insert(departments).values(department).returning();\n    return newDept;\n  }\n\n  async updateDepartment(id: number, updates: Partial<InsertDepartment>): Promise<Department | undefined> {\n    const [updated] = await db.update(departments)\n      .set(updates)\n      .where(eq(departments.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Courses\n  async getCourse(id: number): Promise<Course | undefined> {\n    const [course] = await db.select().from(courses).where(eq(courses.id, id));\n    return course;\n  }\n\n  async getAllCourses(tenantId: string = 'default'): Promise<Course[]> {\n    return db.select().from(courses).where(eq(courses.tenantId, tenantId)).orderBy(asc(courses.title));\n  }\n\n  async getActiveCourses(tenantId: string = 'default'): Promise<Course[]> {\n    return db.select().from(courses)\n      .where(and(eq(courses.tenantId, tenantId), eq(courses.isActive, true)))\n      .orderBy(asc(courses.title));\n  }\n\n  async getCoursesByCategory(category: string, tenantId: string = 'default'): Promise<Course[]> {\n    return db.select().from(courses)\n      .where(and(eq(courses.category, category), eq(courses.tenantId, tenantId)))\n      .orderBy(asc(courses.title));\n  }\n\n  async createCourse(course: InsertCourse): Promise<Course> {\n    const [newCourse] = await db.insert(courses).values(course).returning();\n    return newCourse;\n  }\n\n  async updateCourse(id: number, updates: Partial<InsertCourse>): Promise<Course | undefined> {\n    const [updated] = await db.update(courses)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(courses.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Enrollments\n  async getEnrollment(id: number): Promise<Enrollment | undefined> {\n    const [enrollment] = await db.select().from(enrollments).where(eq(enrollments.id, id));\n    return enrollment;\n  }\n\n  async getEnrollmentsByUser(userId: string): Promise<Enrollment[]> {\n    return db.select().from(enrollments)\n      .where(eq(enrollments.userId, userId))\n      .orderBy(desc(enrollments.expiresAt));\n  }\n\n  async getEnrollmentsByCourse(courseId: number): Promise<Enrollment[]> {\n    return db.select().from(enrollments).where(eq(enrollments.courseId, courseId));\n  }\n\n  async getExpiringEnrollments(daysAhead: number, tenantId: string = 'default'): Promise<Enrollment[]> {\n    const now = new Date();\n    const futureDate = new Date();\n    futureDate.setDate(now.getDate() + daysAhead);\n    \n    return db.select().from(enrollments)\n      .where(and(\n        eq(enrollments.tenantId, tenantId),\n        eq(enrollments.status, 'active'),\n        gte(enrollments.expiresAt, now),\n        lte(enrollments.expiresAt, futureDate)\n      ))\n      .orderBy(asc(enrollments.expiresAt));\n  }\n\n  async getAllEnrollments(tenantId: string = 'default'): Promise<Enrollment[]> {\n    return db.select().from(enrollments)\n      .where(eq(enrollments.tenantId, tenantId))\n      .orderBy(desc(enrollments.enrolledAt));\n  }\n\n  async createEnrollment(enrollment: InsertEnrollment): Promise<Enrollment> {\n    const [newEnrollment] = await db.insert(enrollments).values(enrollment).returning();\n    return newEnrollment;\n  }\n\n  async updateEnrollment(id: number, updates: Partial<InsertEnrollment>): Promise<Enrollment | undefined> {\n    const [updated] = await db.update(enrollments)\n      .set(updates)\n      .where(eq(enrollments.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Renewal Requests\n  async getRenewalRequest(id: number): Promise<RenewalRequest | undefined> {\n    const [request] = await db.select().from(renewalRequests).where(eq(renewalRequests.id, id));\n    return request;\n  }\n\n  async getRenewalRequestsByUser(userId: string): Promise<RenewalRequest[]> {\n    return db.select().from(renewalRequests)\n      .where(eq(renewalRequests.requestedBy, userId))\n      .orderBy(desc(renewalRequests.createdAt));\n  }\n\n  async getPendingApprovals(approverId: string, role: UserRole): Promise<RenewalRequest[]> {\n    if (role === 'foreman') {\n      return db.select().from(renewalRequests)\n        .where(and(\n          eq(renewalRequests.status, 'pending'),\n          or(isNull(renewalRequests.foremanId), eq(renewalRequests.foremanId, approverId))\n        ))\n        .orderBy(asc(renewalRequests.createdAt));\n    } else if (role === 'manager') {\n      return db.select().from(renewalRequests)\n        .where(eq(renewalRequests.status, 'foreman_approved'))\n        .orderBy(asc(renewalRequests.createdAt));\n    }\n    return [];\n  }\n\n  async getAllRenewalRequests(tenantId: string = 'default'): Promise<RenewalRequest[]> {\n    return db.select().from(renewalRequests)\n      .where(eq(renewalRequests.tenantId, tenantId))\n      .orderBy(desc(renewalRequests.createdAt));\n  }\n\n  async createRenewalRequest(request: InsertRenewalRequest): Promise<RenewalRequest> {\n    const [newRequest] = await db.insert(renewalRequests).values(request).returning();\n    return newRequest;\n  }\n\n  async updateRenewalRequest(id: number, updates: Partial<InsertRenewalRequest>): Promise<RenewalRequest | undefined> {\n    const [updated] = await db.update(renewalRequests)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(renewalRequests.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Notifications\n  async getNotificationsByUser(userId: string, unreadOnly: boolean = false): Promise<Notification[]> {\n    if (unreadOnly) {\n      return db.select().from(notifications)\n        .where(and(eq(notifications.userId, userId), eq(notifications.isRead, false)))\n        .orderBy(desc(notifications.createdAt));\n    }\n    return db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt))\n      .limit(50);\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const [newNotification] = await db.insert(notifications).values(notification).returning();\n    return newNotification;\n  }\n\n  async markNotificationRead(id: number): Promise<void> {\n    await db.update(notifications)\n      .set({ isRead: true })\n      .where(eq(notifications.id, id));\n  }\n\n  async markAllNotificationsRead(userId: string): Promise<void> {\n    await db.update(notifications)\n      .set({ isRead: true })\n      .where(eq(notifications.userId, userId));\n  }\n\n  // Progression Tasks\n  async getProgressionTask(id: number): Promise<ProgressionTask | undefined> {\n    const [task] = await db.select().from(progressionTasks).where(eq(progressionTasks.id, id));\n    return task;\n  }\n\n  async getProgressionTasksByUser(userId: string): Promise<ProgressionTask[]> {\n    return db.select().from(progressionTasks)\n      .where(eq(progressionTasks.userId, userId))\n      .orderBy(asc(progressionTasks.dueDate));\n  }\n\n  async getAllProgressionTasks(tenantId: string = 'default'): Promise<ProgressionTask[]> {\n    return db.select().from(progressionTasks)\n      .where(eq(progressionTasks.tenantId, tenantId))\n      .orderBy(asc(progressionTasks.dueDate));\n  }\n\n  async createProgressionTask(task: InsertProgressionTask): Promise<ProgressionTask> {\n    const [newTask] = await db.insert(progressionTasks).values(task).returning();\n    return newTask;\n  }\n\n  async updateProgressionTask(id: number, updates: Partial<InsertProgressionTask>): Promise<ProgressionTask | undefined> {\n    const [updated] = await db.update(progressionTasks)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(progressionTasks.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Audit Logs\n  async getAuditLogs(tenantId: string = 'default', limit: number = 100): Promise<AuditLog[]> {\n    return db.select().from(auditLogs)\n      .where(eq(auditLogs.tenantId, tenantId))\n      .orderBy(desc(auditLogs.createdAt))\n      .limit(limit);\n  }\n\n  async getAuditLogsByUser(userId: string, limit: number = 50): Promise<AuditLog[]> {\n    return db.select().from(auditLogs)\n      .where(eq(auditLogs.userId, userId))\n      .orderBy(desc(auditLogs.createdAt))\n      .limit(limit);\n  }\n\n  async getAuditLogsByEntity(entityType: string, entityId: string): Promise<AuditLog[]> {\n    return db.select().from(auditLogs)\n      .where(and(eq(auditLogs.entityType, entityType), eq(auditLogs.entityId, entityId)))\n      .orderBy(desc(auditLogs.createdAt));\n  }\n\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    const [newLog] = await db.insert(auditLogs).values(log).returning();\n    return newLog;\n  }\n\n  // AI Recommendations\n  async getRecommendationsByUser(userId: string, includeProcessed: boolean = false): Promise<AiRecommendation[]> {\n    if (includeProcessed) {\n      return db.select().from(aiRecommendations)\n        .where(eq(aiRecommendations.userId, userId))\n        .orderBy(desc(aiRecommendations.createdAt));\n    }\n    return db.select().from(aiRecommendations)\n      .where(and(\n        eq(aiRecommendations.userId, userId),\n        eq(aiRecommendations.isDismissed, false),\n        isNull(aiRecommendations.isAccepted)\n      ))\n      .orderBy(desc(aiRecommendations.confidence));\n  }\n\n  async createRecommendation(rec: InsertAiRecommendation): Promise<AiRecommendation> {\n    const [newRec] = await db.insert(aiRecommendations).values(rec).returning();\n    return newRec;\n  }\n\n  async updateRecommendation(id: number, updates: Partial<InsertAiRecommendation>): Promise<AiRecommendation | undefined> {\n    const [updated] = await db.update(aiRecommendations)\n      .set(updates)\n      .where(eq(aiRecommendations.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Dashboard Stats\n  async getDashboardStats(userId: string, role: UserRole, tenantId: string = 'default'): Promise<DashboardStats> {\n    const now = new Date();\n    const thirtyDaysFromNow = new Date();\n    thirtyDaysFromNow.setDate(now.getDate() + 30);\n\n    // Get user's enrollments\n    const userEnrollments = await this.getEnrollmentsByUser(userId);\n    const activeEnrollments = userEnrollments.filter(e => e.status === 'active');\n    const completedEnrollments = userEnrollments.filter(e => e.status === 'completed' || e.completedAt);\n    const expiringEnrollments = activeEnrollments.filter(e => \n      e.expiresAt && e.expiresAt <= thirtyDaysFromNow && e.expiresAt >= now\n    );\n\n    // Get user's renewal requests\n    const userRenewals = await this.getRenewalRequestsByUser(userId);\n    const pendingRenewals = userRenewals.filter(r => \n      r.status === 'pending' || r.status === 'foreman_approved'\n    );\n\n    // Get pending approvals if user is foreman or manager\n    let pendingApprovals = 0;\n    if (role === 'foreman' || role === 'manager') {\n      const approvals = await this.getPendingApprovals(userId, role);\n      pendingApprovals = approvals.length;\n    }\n\n    // Get unread notifications\n    const unreadNotifs = await this.getNotificationsByUser(userId, true);\n\n    // Get progression tasks\n    const tasks = await this.getProgressionTasksByUser(userId);\n    const completedTasks = tasks.filter(t => t.status === 'completed');\n\n    return {\n      totalCourses: activeEnrollments.length,\n      completedCourses: completedEnrollments.length,\n      expiringCourses: expiringEnrollments.length,\n      pendingRenewals: pendingRenewals.length,\n      pendingApprovals,\n      unreadNotifications: unreadNotifs.length,\n      progressionTasks: tasks.length,\n      completedProgressionTasks: completedTasks.length,\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":18371,"size_tokens":null},"server/worker.ts":{"content":"import { storage } from \"./storage\";\nimport { log } from \"./index\";\n\nconst NOTIFICATION_INTERVALS = [30, 14, 7, 1];\n\ninterface ExpirationCheck {\n  enrollmentId: number;\n  userId: string;\n  courseTitle: string;\n  daysUntilExpiry: number;\n  expiresAt: Date;\n}\n\nexport async function runExpirationCheck(): Promise<void> {\n  log(\"Starting expiration check worker\", \"worker\");\n  \n  try {\n    const tenantId = 'default';\n    \n    for (const days of NOTIFICATION_INTERVALS) {\n      await checkExpiringEnrollments(days, tenantId);\n    }\n    \n    await checkEscalations(tenantId);\n    \n    log(\"Expiration check completed successfully\", \"worker\");\n  } catch (error) {\n    log(`Expiration check failed: ${error}`, \"worker\");\n    console.error(\"Worker error:\", error);\n  }\n}\n\nasync function checkExpiringEnrollments(days: number, tenantId: string): Promise<void> {\n  log(`Checking enrollments expiring in ${days} days`, \"worker\");\n  \n  const now = new Date();\n  const targetDate = new Date();\n  targetDate.setDate(now.getDate() + days);\n  \n  const startOfDay = new Date(targetDate);\n  startOfDay.setHours(0, 0, 0, 0);\n  \n  const endOfDay = new Date(targetDate);\n  endOfDay.setHours(23, 59, 59, 999);\n  \n  const expiringEnrollments = await storage.getExpiringEnrollments(days + 1, tenantId);\n  \n  const enrollmentsExpiringOnDay = expiringEnrollments.filter(e => {\n    const expiresAt = new Date(e.expiresAt);\n    const daysRemaining = Math.ceil((expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n    return daysRemaining === days;\n  });\n  \n  for (const enrollment of enrollmentsExpiringOnDay) {\n    const course = await storage.getCourse(enrollment.courseId);\n    if (!course) continue;\n    \n    const hasExistingNotification = await checkExistingNotification(\n      enrollment.userId,\n      'expiry_warning',\n      enrollment.id,\n      days\n    );\n    \n    if (!hasExistingNotification) {\n      const urgencyText = days === 1 ? \"URGENT: \" : days <= 7 ? \"Important: \" : \"\";\n      \n      await storage.createNotification({\n        userId: enrollment.userId,\n        type: 'expiry_warning',\n        title: `${urgencyText}Training Expiring in ${days} Day${days === 1 ? '' : 's'}`,\n        message: `Your \"${course.title}\" certification expires on ${new Date(enrollment.expiresAt).toLocaleDateString()}. Please submit a renewal request.`,\n        relatedEntityType: 'enrollment',\n        relatedEntityId: enrollment.id,\n        tenantId,\n      });\n      \n      log(`Created ${days}-day expiry notification for enrollment ${enrollment.id}`, \"worker\");\n    }\n  }\n}\n\nasync function checkExistingNotification(\n  userId: string,\n  type: 'expiry_warning' | 'renewal_request' | 'approval_needed' | 'escalation' | 'system',\n  entityId: number,\n  days: number\n): Promise<boolean> {\n  const notifications = await storage.getNotificationsByUser(userId, false);\n  \n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  return notifications.some(n => {\n    if (n.type !== type) return false;\n    if (n.relatedEntityId !== entityId) return false;\n    \n    const createdAt = n.createdAt;\n    if (!createdAt) return false;\n    \n    const notificationDate = new Date(createdAt);\n    notificationDate.setHours(0, 0, 0, 0);\n    \n    if (notificationDate.getTime() === today.getTime()) {\n      return true;\n    }\n    \n    return false;\n  });\n}\n\nasync function checkEscalations(tenantId: string): Promise<void> {\n  log(\"Checking for escalations\", \"worker\");\n  \n  const expiringEnrollments = await storage.getExpiringEnrollments(14, tenantId);\n  \n  for (const enrollment of expiringEnrollments) {\n    const expiresAt = new Date(enrollment.expiresAt);\n    const now = new Date();\n    const daysRemaining = Math.ceil((expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n    \n    if (daysRemaining > 7) continue;\n    \n    const userNotifications = await storage.getNotificationsByUser(enrollment.userId, false);\n    \n    const unreadExpiryNotifications = userNotifications.filter(n => \n      n.type === 'expiry_warning' && \n      n.relatedEntityId === enrollment.id && \n      !n.isRead\n    );\n    \n    if (unreadExpiryNotifications.length >= 2) {\n      const user = await storage.getUser(enrollment.userId);\n      if (!user) continue;\n      \n      const course = await storage.getCourse(enrollment.courseId);\n      if (!course) continue;\n      \n      const foremen = await storage.getUsersByRole('foreman', tenantId);\n      \n      for (const foreman of foremen) {\n        const existingEscalation = await checkExistingEscalation(\n          foreman.id,\n          enrollment.id\n        );\n        \n        if (!existingEscalation) {\n          await storage.createNotification({\n            userId: foreman.id,\n            type: 'escalation',\n            title: 'Employee Training Renewal Alert',\n            message: `${user.firstName} ${user.lastName} has not responded to multiple renewal reminders for \"${course.title}\" which expires in ${daysRemaining} days.`,\n            relatedEntityType: 'enrollment',\n            relatedEntityId: enrollment.id,\n            tenantId,\n          });\n          \n          log(`Escalated enrollment ${enrollment.id} to foreman ${foreman.id}`, \"worker\");\n        }\n      }\n    }\n  }\n}\n\nasync function checkExistingEscalation(\n  foremanId: string,\n  enrollmentId: number\n): Promise<boolean> {\n  const notifications = await storage.getNotificationsByUser(foremanId, false);\n  \n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n  \n  return notifications.some(n => {\n    if (n.type !== 'escalation') return false;\n    if (n.relatedEntityId !== enrollmentId) return false;\n    if (!n.createdAt) return false;\n    return new Date(n.createdAt) > sevenDaysAgo;\n  });\n}\n\nexport function startWorkerSchedule(): void {\n  log(\"Initializing worker schedule\", \"worker\");\n  \n  setTimeout(() => {\n    runExpirationCheck();\n  }, 5000);\n  \n  const INTERVAL_MS = 24 * 60 * 60 * 1000;\n  \n  setInterval(() => {\n    runExpirationCheck();\n  }, INTERVAL_MS);\n  \n  log(\"Worker scheduled to run daily\", \"worker\");\n}\n\nexport async function runManualExpirationCheck(): Promise<{ \n  checked: number; \n  notificationsCreated: number;\n  escalationsCreated: number;\n}> {\n  log(\"Running manual expiration check\", \"worker\");\n  \n  let notificationsCreated = 0;\n  let escalationsCreated = 0;\n  let totalChecked = 0;\n  \n  try {\n    const tenantId = 'default';\n    \n    for (const days of NOTIFICATION_INTERVALS) {\n      const expiringEnrollments = await storage.getExpiringEnrollments(days + 1, tenantId);\n      const now = new Date();\n      \n      for (const enrollment of expiringEnrollments) {\n        const expiresAt = new Date(enrollment.expiresAt);\n        const daysRemaining = Math.ceil((expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n        \n        if (daysRemaining !== days) continue;\n        \n        totalChecked++;\n        \n        const course = await storage.getCourse(enrollment.courseId);\n        if (!course) continue;\n        \n        const hasExisting = await checkExistingNotification(\n          enrollment.userId,\n          'expiry_warning',\n          enrollment.id,\n          days\n        );\n        \n        if (!hasExisting) {\n          const urgencyText = days === 1 ? \"URGENT: \" : days <= 7 ? \"Important: \" : \"\";\n          \n          await storage.createNotification({\n            userId: enrollment.userId,\n            type: 'expiry_warning',\n            title: `${urgencyText}Training Expiring in ${days} Day${days === 1 ? '' : 's'}`,\n            message: `Your \"${course.title}\" certification expires on ${new Date(enrollment.expiresAt).toLocaleDateString()}. Please submit a renewal request.`,\n            relatedEntityType: 'enrollment',\n            relatedEntityId: enrollment.id,\n            tenantId,\n          });\n          \n          notificationsCreated++;\n        }\n      }\n    }\n    \n    const expiringForEscalation = await storage.getExpiringEnrollments(14, tenantId);\n    const now = new Date();\n    \n    for (const enrollment of expiringForEscalation) {\n      const expiresAt = new Date(enrollment.expiresAt);\n      const daysRemaining = Math.ceil((expiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n      \n      if (daysRemaining > 7) continue;\n      \n      const userNotifications = await storage.getNotificationsByUser(enrollment.userId, false);\n      const unreadExpiryNotifications = userNotifications.filter(n => \n        n.type === 'expiry_warning' && \n        n.relatedEntityId === enrollment.id && \n        !n.isRead\n      );\n      \n      if (unreadExpiryNotifications.length >= 2) {\n        const user = await storage.getUser(enrollment.userId);\n        if (!user) continue;\n        \n        const course = await storage.getCourse(enrollment.courseId);\n        if (!course) continue;\n        \n        const foremen = await storage.getUsersByRole('foreman', tenantId);\n        \n        for (const foreman of foremen) {\n          const existingEscalation = await checkExistingEscalation(foreman.id, enrollment.id);\n          \n          if (!existingEscalation) {\n            await storage.createNotification({\n              userId: foreman.id,\n              type: 'escalation',\n              title: 'Employee Training Renewal Alert',\n              message: `${user.firstName} ${user.lastName} has not responded to multiple renewal reminders for \"${course.title}\" which expires in ${daysRemaining} days.`,\n              relatedEntityType: 'enrollment',\n              relatedEntityId: enrollment.id,\n              tenantId,\n            });\n            \n            escalationsCreated++;\n          }\n        }\n      }\n    }\n    \n    return { checked: totalChecked, notificationsCreated, escalationsCreated };\n  } catch (error) {\n    log(`Manual expiration check failed: ${error}`, \"worker\");\n    throw error;\n  }\n}\n","path":null,"size_bytes":9821,"size_tokens":null},"server/reports.ts":{"content":"import * as XLSX from 'xlsx';\nimport puppeteer from 'puppeteer';\nimport { storage } from './storage';\nimport type { User, Course, Enrollment, Department, RenewalRequest, ProgressionTask } from '@shared/schema';\n\nconst DATE_FORMAT_OPTIONS: Intl.DateTimeFormatOptions = {\n  year: 'numeric',\n  month: 'short',\n  day: 'numeric',\n};\n\nfunction formatDate(date: Date | string | null | undefined): string {\n  if (!date) return 'N/A';\n  return new Date(date).toLocaleDateString('en-US', DATE_FORMAT_OPTIONS);\n}\n\nexport interface TrainingComplianceData {\n  summary: {\n    totalEmployees: number;\n    employeesWithTraining: number;\n    employeesWithoutTraining: number;\n    compliantEmployees: number;\n    atRiskEmployees: number;\n    nonCompliantEmployees: number;\n    overallComplianceRate: number;\n    trainingComplianceRate: number;\n  };\n  enrollmentStats: {\n    total: number;\n    active: number;\n    completed: number;\n    expiringSoon: number;\n    expired: number;\n  };\n  employees: Array<{\n    name: string;\n    department: string;\n    role: string;\n    totalCourses: number;\n    completedCourses: number;\n    expiringCourses: number;\n    expiredCourses: number;\n    complianceStatus: string;\n  }>;\n  generatedAt: Date;\n  tenantId: string;\n}\n\nexport interface EmployeeProgressData {\n  employee: {\n    name: string;\n    email: string;\n    role: string;\n    department: string;\n    hireDate: string;\n    currentGrade: number;\n  };\n  enrollments: Array<{\n    courseName: string;\n    category: string;\n    status: string;\n    enrolledDate: string;\n    completedDate: string | null;\n    expirationDate: string;\n    score: number | null;\n  }>;\n  progressionTasks: Array<{\n    title: string;\n    status: string;\n    targetGrade: number;\n    dueDate: string | null;\n    completedDate: string | null;\n  }>;\n  renewalRequests: Array<{\n    courseName: string;\n    status: string;\n    submittedDate: string;\n    approvedDate: string | null;\n  }>;\n  generatedAt: Date;\n}\n\nexport interface DepartmentStatsData {\n  department: {\n    name: string;\n    code: string;\n  };\n  summary: {\n    totalEmployees: number;\n    complianceRate: number;\n    avgTrainingCompletion: number;\n    pendingRenewals: number;\n    upcomingExpirations: number;\n  };\n  employees: Array<{\n    name: string;\n    role: string;\n    completionRate: number;\n    expiringCourses: number;\n  }>;\n  courseBreakdown: Array<{\n    courseName: string;\n    enrolled: number;\n    completed: number;\n    expiring: number;\n    expired: number;\n  }>;\n  generatedAt: Date;\n}\n\nexport async function verifyDepartmentTenant(departmentId: number, tenantId: string): Promise<Department | null> {\n  const department = await storage.getDepartment(departmentId);\n  if (!department) return null;\n  if (department.tenantId !== tenantId) return null;\n  return department;\n}\n\nexport async function generateTrainingComplianceData(tenantId: string): Promise<TrainingComplianceData> {\n  const allUsers = await storage.getAllUsers(tenantId);\n  const allEnrollments = await storage.getAllEnrollments(tenantId);\n  const allDepartments = await storage.getAllDepartments(tenantId);\n  \n  const now = new Date();\n  const thirtyDaysFromNow = new Date();\n  thirtyDaysFromNow.setDate(now.getDate() + 30);\n  \n  const deptMap = new Map<number, Department>(allDepartments.map((d: Department) => [d.id, d]));\n  \n  const employees = allUsers.filter((u: User) => u.role === 'employee' || u.role === 'foreman');\n  \n  const activeEnrollments = allEnrollments.filter((e: Enrollment) => e.status === 'active').length;\n  const completedEnrollments = allEnrollments.filter((e: Enrollment) => e.status === 'completed').length;\n  const expiringSoonEnrollments = allEnrollments.filter((e: Enrollment) => {\n    if (!e.expiresAt) return false;\n    const expDate = new Date(e.expiresAt);\n    return expDate > now && expDate <= thirtyDaysFromNow && e.status !== 'expired';\n  }).length;\n  const expiredEnrollments = allEnrollments.filter((e: Enrollment) => {\n    if (!e.expiresAt) return false;\n    return new Date(e.expiresAt) < now;\n  }).length;\n  \n  const employeeData = employees.map((user: User) => {\n    const userEnrollments = allEnrollments.filter((e: Enrollment) => e.userId === user.id);\n    const completed = userEnrollments.filter((e: Enrollment) => e.status === 'completed');\n    \n    const expiring = userEnrollments.filter((e: Enrollment) => {\n      if (!e.expiresAt) return false;\n      const expDate = new Date(e.expiresAt);\n      return expDate > now && expDate <= thirtyDaysFromNow;\n    });\n    \n    const expired = userEnrollments.filter((e: Enrollment) => {\n      if (!e.expiresAt) return false;\n      return new Date(e.expiresAt) < now;\n    });\n    \n    let complianceStatus: string;\n    if (userEnrollments.length === 0) {\n      complianceStatus = 'No Training';\n    } else if (expired.length > 0) {\n      complianceStatus = 'Non-Compliant';\n    } else if (expiring.length > 0) {\n      complianceStatus = 'At Risk';\n    } else {\n      complianceStatus = 'Compliant';\n    }\n    \n    const dept = user.departmentId ? deptMap.get(user.departmentId) : null;\n    \n    return {\n      name: `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Unknown',\n      department: dept?.name || 'Unassigned',\n      role: user.role,\n      totalCourses: userEnrollments.length,\n      completedCourses: completed.length,\n      expiringCourses: expiring.length,\n      expiredCourses: expired.length,\n      complianceStatus,\n    };\n  });\n  \n  const employeesWithTraining = employeeData.filter(e => e.complianceStatus !== 'No Training');\n  const employeesWithoutTraining = employeeData.filter(e => e.complianceStatus === 'No Training');\n  const compliantEmployees = employeeData.filter(e => e.complianceStatus === 'Compliant');\n  const atRiskEmployees = employeeData.filter(e => e.complianceStatus === 'At Risk');\n  const nonCompliantEmployees = employeeData.filter(e => e.complianceStatus === 'Non-Compliant');\n  \n  const overallComplianceRate = employees.length > 0 \n    ? Math.round((compliantEmployees.length / employees.length) * 100) \n    : 0;\n  \n  const trainingComplianceRate = employeesWithTraining.length > 0\n    ? Math.round((compliantEmployees.length / employeesWithTraining.length) * 100)\n    : 0;\n  \n  return {\n    summary: {\n      totalEmployees: employees.length,\n      employeesWithTraining: employeesWithTraining.length,\n      employeesWithoutTraining: employeesWithoutTraining.length,\n      compliantEmployees: compliantEmployees.length,\n      atRiskEmployees: atRiskEmployees.length,\n      nonCompliantEmployees: nonCompliantEmployees.length,\n      overallComplianceRate,\n      trainingComplianceRate,\n    },\n    enrollmentStats: {\n      total: allEnrollments.length,\n      active: activeEnrollments,\n      completed: completedEnrollments,\n      expiringSoon: expiringSoonEnrollments,\n      expired: expiredEnrollments,\n    },\n    employees: employeeData,\n    generatedAt: now,\n    tenantId,\n  };\n}\n\nexport async function generateEmployeeProgressData(userId: string, tenantId: string): Promise<EmployeeProgressData | null> {\n  const user = await storage.getUser(userId);\n  if (!user) return null;\n  if (user.tenantId !== tenantId) return null;\n  \n  const userEnrollments = await storage.getEnrollmentsByUser(userId);\n  const userProgressionTasks = await storage.getProgressionTasksByUser(userId);\n  const userRenewalRequests = await storage.getRenewalRequestsByUser(userId);\n  const allCourses = await storage.getAllCourses(tenantId);\n  const allDepartments = await storage.getAllDepartments(tenantId);\n  \n  const courseMap = new Map<number, Course>(allCourses.map((c: Course) => [c.id, c]));\n  const deptMap = new Map<number, Department>(allDepartments.map((d: Department) => [d.id, d]));\n  \n  const dept = user.departmentId ? deptMap.get(user.departmentId) : null;\n  \n  return {\n    employee: {\n      name: `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Unknown',\n      email: user.email || '',\n      role: user.role,\n      department: dept?.name || 'Unassigned',\n      hireDate: formatDate(user.createdAt),\n      currentGrade: typeof user.currentGrade === 'number' ? user.currentGrade : parseInt(user.currentGrade || '1', 10),\n    },\n    enrollments: userEnrollments.map((e: Enrollment) => {\n      const course = e.courseId ? courseMap.get(e.courseId) : null;\n      return {\n        courseName: course?.title || 'Unknown Course',\n        category: course?.category || 'General',\n        status: e.status,\n        enrolledDate: formatDate(e.enrolledAt),\n        completedDate: e.completedAt ? formatDate(e.completedAt) : null,\n        expirationDate: formatDate(e.expiresAt),\n        score: e.score,\n      };\n    }),\n    progressionTasks: userProgressionTasks.map((t: ProgressionTask) => ({\n      title: t.title,\n      status: t.status,\n      targetGrade: typeof t.targetGrade === 'number' ? t.targetGrade : parseInt(t.targetGrade || '1', 10),\n      dueDate: t.dueDate ? formatDate(t.dueDate) : null,\n      completedDate: t.completedAt ? formatDate(t.completedAt) : null,\n    })),\n    renewalRequests: userRenewalRequests.map((r: RenewalRequest) => {\n      const enrollment = userEnrollments.find((e: Enrollment) => e.id === r.enrollmentId);\n      const course = enrollment?.courseId ? courseMap.get(enrollment.courseId) : null;\n      return {\n        courseName: course?.title || 'Unknown Course',\n        status: r.status,\n        submittedDate: formatDate(r.createdAt),\n        approvedDate: r.managerApprovedAt ? formatDate(r.managerApprovedAt) : null,\n      };\n    }),\n    generatedAt: new Date(),\n  };\n}\n\nexport async function generateDepartmentStatsData(departmentId: number, tenantId: string): Promise<DepartmentStatsData | null> {\n  const department = await verifyDepartmentTenant(departmentId, tenantId);\n  if (!department) return null;\n  \n  const allUsers = await storage.getAllUsers(tenantId);\n  const allEnrollments = await storage.getAllEnrollments(tenantId);\n  const allCourses = await storage.getAllCourses(tenantId);\n  const allRenewalRequests = await storage.getAllRenewalRequests(tenantId);\n  \n  const deptUsers = allUsers.filter((u: User) => u.departmentId === departmentId);\n  const deptUserIds = new Set(deptUsers.map((u: User) => u.id));\n  const deptEnrollments = allEnrollments.filter((e: Enrollment) => deptUserIds.has(e.userId));\n  const deptRenewals = allRenewalRequests.filter((r: RenewalRequest) => {\n    const enrollment = allEnrollments.find((e: Enrollment) => e.id === r.enrollmentId);\n    return enrollment && deptUserIds.has(enrollment.userId);\n  });\n  \n  const now = new Date();\n  const thirtyDaysFromNow = new Date();\n  thirtyDaysFromNow.setDate(now.getDate() + 30);\n  \n  const courseMap = new Map<number, Course>(allCourses.map((c: Course) => [c.id, c]));\n  \n  const completedEnrollments = deptEnrollments.filter((e: Enrollment) => e.status === 'completed').length;\n  const expiringEnrollments = deptEnrollments.filter((e: Enrollment) => {\n    if (!e.expiresAt) return false;\n    const expDate = new Date(e.expiresAt);\n    return expDate > now && expDate <= thirtyDaysFromNow;\n  }).length;\n  const expiredEnrollments = deptEnrollments.filter((e: Enrollment) => {\n    if (!e.expiresAt) return false;\n    return new Date(e.expiresAt) < now;\n  }).length;\n  \n  const pendingRenewals = deptRenewals.filter((r: RenewalRequest) => \n    r.status === 'pending' || r.status === 'foreman_approved'\n  ).length;\n  \n  const complianceRate = deptEnrollments.length > 0 \n    ? Math.round(((deptEnrollments.length - expiredEnrollments) / deptEnrollments.length) * 100)\n    : 100;\n  \n  const avgCompletion = deptEnrollments.length > 0\n    ? Math.round((completedEnrollments / deptEnrollments.length) * 100)\n    : 0;\n  \n  const employeeStats = deptUsers.map((user: User) => {\n    const userEnrollments = deptEnrollments.filter((e: Enrollment) => e.userId === user.id);\n    const completed = userEnrollments.filter((e: Enrollment) => e.status === 'completed').length;\n    const expiring = userEnrollments.filter((e: Enrollment) => {\n      if (!e.expiresAt) return false;\n      const expDate = new Date(e.expiresAt);\n      return expDate > now && expDate <= thirtyDaysFromNow;\n    }).length;\n    \n    return {\n      name: `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Unknown',\n      role: user.role,\n      completionRate: userEnrollments.length > 0 ? Math.round((completed / userEnrollments.length) * 100) : 0,\n      expiringCourses: expiring,\n    };\n  });\n  \n  const courseStats = new Map<number, { enrolled: number; completed: number; expiring: number; expired: number }>();\n  deptEnrollments.forEach((e: Enrollment) => {\n    if (!e.courseId) return;\n    if (!courseStats.has(e.courseId)) {\n      courseStats.set(e.courseId, { enrolled: 0, completed: 0, expiring: 0, expired: 0 });\n    }\n    const stats = courseStats.get(e.courseId)!;\n    stats.enrolled++;\n    if (e.status === 'completed') stats.completed++;\n    if (e.expiresAt) {\n      const expDate = new Date(e.expiresAt);\n      if (expDate < now) stats.expired++;\n      else if (expDate <= thirtyDaysFromNow) stats.expiring++;\n    }\n  });\n  \n  const courseBreakdown = Array.from(courseStats.entries()).map(([courseId, stats]) => {\n    const course = courseMap.get(courseId);\n    return {\n      courseName: course?.title || 'Unknown Course',\n      ...stats,\n    };\n  });\n  \n  return {\n    department: {\n      name: department.name,\n      code: department.code || '',\n    },\n    summary: {\n      totalEmployees: deptUsers.length,\n      complianceRate,\n      avgTrainingCompletion: avgCompletion,\n      pendingRenewals,\n      upcomingExpirations: expiringEnrollments,\n    },\n    employees: employeeStats,\n    courseBreakdown,\n    generatedAt: new Date(),\n  };\n}\n\nfunction generateComplianceHTML(data: TrainingComplianceData): string {\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\n    h1 { color: #1a1a1a; font-size: 24px; margin-bottom: 8px; }\n    h2 { color: #444; font-size: 18px; margin-top: 30px; margin-bottom: 12px; border-bottom: 1px solid #ddd; padding-bottom: 6px; }\n    .timestamp { color: #666; font-size: 12px; margin-bottom: 24px; }\n    .summary-grid { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; }\n    .summary-card { background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 6px; padding: 16px; min-width: 180px; }\n    .summary-card h3 { margin: 0 0 8px 0; font-size: 14px; color: #666; }\n    .summary-card .value { font-size: 28px; font-weight: bold; color: #1a1a1a; }\n    .summary-card .value.good { color: #22c55e; }\n    .summary-card .value.warning { color: #f59e0b; }\n    .summary-card .value.danger { color: #ef4444; }\n    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 12px; }\n    th { background-color: #f3f4f6; border: 1px solid #ddd; padding: 10px 8px; text-align: left; font-weight: 600; }\n    td { border: 1px solid #ddd; padding: 8px; }\n    tr:nth-child(even) { background-color: #fafafa; }\n    .status-compliant { color: #22c55e; font-weight: 500; }\n    .status-at-risk { color: #f59e0b; font-weight: 500; }\n    .status-non-compliant { color: #ef4444; font-weight: 500; }\n    .status-no-training { color: #6b7280; font-weight: 500; }\n  </style>\n</head>\n<body>\n  <h1>Training Compliance Report</h1>\n  <p class=\"timestamp\">Generated: ${formatDate(data.generatedAt)}</p>\n  \n  <h2>Summary</h2>\n  <div class=\"summary-grid\">\n    <div class=\"summary-card\">\n      <h3>Total Employees</h3>\n      <div class=\"value\">${data.summary.totalEmployees}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Overall Compliance Rate</h3>\n      <div class=\"value ${data.summary.overallComplianceRate >= 80 ? 'good' : data.summary.overallComplianceRate >= 60 ? 'warning' : 'danger'}\">${data.summary.overallComplianceRate}%</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Trained Compliance Rate</h3>\n      <div class=\"value ${data.summary.trainingComplianceRate >= 80 ? 'good' : data.summary.trainingComplianceRate >= 60 ? 'warning' : 'danger'}\">${data.summary.trainingComplianceRate}%</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Compliant</h3>\n      <div class=\"value good\">${data.summary.compliantEmployees}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>At Risk</h3>\n      <div class=\"value warning\">${data.summary.atRiskEmployees}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Non-Compliant</h3>\n      <div class=\"value danger\">${data.summary.nonCompliantEmployees}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>No Training</h3>\n      <div class=\"value\">${data.summary.employeesWithoutTraining}</div>\n    </div>\n  </div>\n  \n  <h2>Enrollment Statistics</h2>\n  <div class=\"summary-grid\">\n    <div class=\"summary-card\">\n      <h3>Total Enrollments</h3>\n      <div class=\"value\">${data.enrollmentStats.total}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Active</h3>\n      <div class=\"value good\">${data.enrollmentStats.active}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Completed</h3>\n      <div class=\"value good\">${data.enrollmentStats.completed}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Expiring Soon</h3>\n      <div class=\"value warning\">${data.enrollmentStats.expiringSoon}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Expired</h3>\n      <div class=\"value danger\">${data.enrollmentStats.expired}</div>\n    </div>\n  </div>\n  \n  <h2>Employee Details</h2>\n  <table>\n    <thead>\n      <tr>\n        <th>Name</th>\n        <th>Department</th>\n        <th>Role</th>\n        <th>Total</th>\n        <th>Completed</th>\n        <th>Expiring</th>\n        <th>Expired</th>\n        <th>Status</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${data.employees.map(emp => `\n        <tr>\n          <td>${emp.name}</td>\n          <td>${emp.department}</td>\n          <td>${emp.role}</td>\n          <td>${emp.totalCourses}</td>\n          <td>${emp.completedCourses}</td>\n          <td>${emp.expiringCourses}</td>\n          <td>${emp.expiredCourses}</td>\n          <td class=\"status-${emp.complianceStatus.toLowerCase().replace(' ', '-')}\">${emp.complianceStatus}</td>\n        </tr>\n      `).join('')}\n    </tbody>\n  </table>\n</body>\n</html>`;\n}\n\nfunction generateEmployeeHTML(data: EmployeeProgressData): string {\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\n    h1 { color: #1a1a1a; font-size: 24px; margin-bottom: 8px; }\n    h2 { color: #444; font-size: 18px; margin-top: 30px; margin-bottom: 12px; border-bottom: 1px solid #ddd; padding-bottom: 6px; }\n    .timestamp { color: #666; font-size: 12px; margin-bottom: 24px; }\n    .info-grid { display: grid; grid-template-columns: 120px 1fr; gap: 8px 16px; margin-bottom: 24px; }\n    .info-label { color: #666; font-weight: 500; }\n    .info-value { color: #1a1a1a; }\n    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 12px; }\n    th { background-color: #f3f4f6; border: 1px solid #ddd; padding: 10px 8px; text-align: left; font-weight: 600; }\n    td { border: 1px solid #ddd; padding: 8px; }\n    tr:nth-child(even) { background-color: #fafafa; }\n    .empty-message { color: #666; font-style: italic; padding: 16px; text-align: center; background: #f9f9f9; border-radius: 6px; }\n  </style>\n</head>\n<body>\n  <h1>Employee Progress Report</h1>\n  <p class=\"timestamp\">Generated: ${formatDate(data.generatedAt)}</p>\n  \n  <h2>Employee Information</h2>\n  <div class=\"info-grid\">\n    <span class=\"info-label\">Name:</span><span class=\"info-value\">${data.employee.name}</span>\n    <span class=\"info-label\">Email:</span><span class=\"info-value\">${data.employee.email}</span>\n    <span class=\"info-label\">Role:</span><span class=\"info-value\">${data.employee.role}</span>\n    <span class=\"info-label\">Department:</span><span class=\"info-value\">${data.employee.department}</span>\n    <span class=\"info-label\">Current Grade:</span><span class=\"info-value\">${data.employee.currentGrade}</span>\n    <span class=\"info-label\">Hire Date:</span><span class=\"info-value\">${data.employee.hireDate}</span>\n  </div>\n  \n  <h2>Training Enrollments</h2>\n  ${data.enrollments.length > 0 ? `\n    <table>\n      <thead>\n        <tr>\n          <th>Course</th>\n          <th>Category</th>\n          <th>Status</th>\n          <th>Enrolled</th>\n          <th>Completed</th>\n          <th>Expires</th>\n          <th>Score</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.enrollments.map(e => `\n          <tr>\n            <td>${e.courseName}</td>\n            <td>${e.category}</td>\n            <td>${e.status}</td>\n            <td>${e.enrolledDate}</td>\n            <td>${e.completedDate || '-'}</td>\n            <td>${e.expirationDate}</td>\n            <td>${e.score !== null ? e.score : '-'}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n  ` : '<p class=\"empty-message\">No enrollments found.</p>'}\n  \n  <h2>Progression Tasks</h2>\n  ${data.progressionTasks.length > 0 ? `\n    <table>\n      <thead>\n        <tr>\n          <th>Task</th>\n          <th>Target Grade</th>\n          <th>Status</th>\n          <th>Due Date</th>\n          <th>Completed</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.progressionTasks.map(t => `\n          <tr>\n            <td>${t.title}</td>\n            <td>${t.targetGrade}</td>\n            <td>${t.status}</td>\n            <td>${t.dueDate || '-'}</td>\n            <td>${t.completedDate || '-'}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n  ` : '<p class=\"empty-message\">No progression tasks found.</p>'}\n  \n  <h2>Renewal Requests</h2>\n  ${data.renewalRequests.length > 0 ? `\n    <table>\n      <thead>\n        <tr>\n          <th>Course</th>\n          <th>Status</th>\n          <th>Submitted</th>\n          <th>Approved</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.renewalRequests.map(r => `\n          <tr>\n            <td>${r.courseName}</td>\n            <td>${r.status}</td>\n            <td>${r.submittedDate}</td>\n            <td>${r.approvedDate || '-'}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n  ` : '<p class=\"empty-message\">No renewal requests found.</p>'}\n</body>\n</html>`;\n}\n\nfunction generateDepartmentHTML(data: DepartmentStatsData): string {\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\n    h1 { color: #1a1a1a; font-size: 24px; margin-bottom: 8px; }\n    h2 { color: #444; font-size: 18px; margin-top: 30px; margin-bottom: 12px; border-bottom: 1px solid #ddd; padding-bottom: 6px; }\n    .timestamp { color: #666; font-size: 12px; margin-bottom: 24px; }\n    .summary-grid { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; }\n    .summary-card { background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 6px; padding: 16px; min-width: 160px; }\n    .summary-card h3 { margin: 0 0 8px 0; font-size: 14px; color: #666; }\n    .summary-card .value { font-size: 28px; font-weight: bold; color: #1a1a1a; }\n    .summary-card .value.good { color: #22c55e; }\n    .summary-card .value.warning { color: #f59e0b; }\n    .summary-card .value.danger { color: #ef4444; }\n    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 12px; }\n    th { background-color: #f3f4f6; border: 1px solid #ddd; padding: 10px 8px; text-align: left; font-weight: 600; }\n    td { border: 1px solid #ddd; padding: 8px; }\n    tr:nth-child(even) { background-color: #fafafa; }\n  </style>\n</head>\n<body>\n  <h1>Department Report: ${data.department.name}${data.department.code ? ` (${data.department.code})` : ''}</h1>\n  <p class=\"timestamp\">Generated: ${formatDate(data.generatedAt)}</p>\n  \n  <h2>Summary</h2>\n  <div class=\"summary-grid\">\n    <div class=\"summary-card\">\n      <h3>Total Employees</h3>\n      <div class=\"value\">${data.summary.totalEmployees}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Compliance Rate</h3>\n      <div class=\"value ${data.summary.complianceRate >= 80 ? 'good' : data.summary.complianceRate >= 60 ? 'warning' : 'danger'}\">${data.summary.complianceRate}%</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Avg Completion</h3>\n      <div class=\"value\">${data.summary.avgTrainingCompletion}%</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Pending Renewals</h3>\n      <div class=\"value warning\">${data.summary.pendingRenewals}</div>\n    </div>\n    <div class=\"summary-card\">\n      <h3>Upcoming Expirations</h3>\n      <div class=\"value warning\">${data.summary.upcomingExpirations}</div>\n    </div>\n  </div>\n  \n  <h2>Employee Summary</h2>\n  <table>\n    <thead>\n      <tr>\n        <th>Name</th>\n        <th>Role</th>\n        <th>Completion %</th>\n        <th>Expiring Courses</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${data.employees.map(e => `\n        <tr>\n          <td>${e.name}</td>\n          <td>${e.role}</td>\n          <td>${e.completionRate}%</td>\n          <td>${e.expiringCourses}</td>\n        </tr>\n      `).join('')}\n    </tbody>\n  </table>\n  \n  <h2>Course Breakdown</h2>\n  <table>\n    <thead>\n      <tr>\n        <th>Course</th>\n        <th>Enrolled</th>\n        <th>Completed</th>\n        <th>Expiring</th>\n        <th>Expired</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${data.courseBreakdown.map(c => `\n        <tr>\n          <td>${c.courseName}</td>\n          <td>${c.enrolled}</td>\n          <td>${c.completed}</td>\n          <td>${c.expiring}</td>\n          <td>${c.expired}</td>\n        </tr>\n      `).join('')}\n    </tbody>\n  </table>\n</body>\n</html>`;\n}\n\nexport async function generateTrainingCompliancePDF(data: TrainingComplianceData): Promise<Buffer> {\n  const html = generateComplianceHTML(data);\n  const browser = await puppeteer.launch({\n    headless: true,\n    args: ['--no-sandbox', '--disable-setuid-sandbox'],\n  });\n  \n  try {\n    const page = await browser.newPage();\n    await page.setContent(html, { waitUntil: 'networkidle0' });\n    const pdfBuffer = await page.pdf({\n      format: 'A4',\n      landscape: true,\n      printBackground: true,\n      margin: { top: '20mm', right: '15mm', bottom: '20mm', left: '15mm' },\n    });\n    return Buffer.from(pdfBuffer);\n  } finally {\n    await browser.close();\n  }\n}\n\nexport async function generateEmployeeProgressPDF(data: EmployeeProgressData): Promise<Buffer> {\n  const html = generateEmployeeHTML(data);\n  const browser = await puppeteer.launch({\n    headless: true,\n    args: ['--no-sandbox', '--disable-setuid-sandbox'],\n  });\n  \n  try {\n    const page = await browser.newPage();\n    await page.setContent(html, { waitUntil: 'networkidle0' });\n    const pdfBuffer = await page.pdf({\n      format: 'A4',\n      printBackground: true,\n      margin: { top: '20mm', right: '15mm', bottom: '20mm', left: '15mm' },\n    });\n    return Buffer.from(pdfBuffer);\n  } finally {\n    await browser.close();\n  }\n}\n\nexport async function generateDepartmentStatsPDF(data: DepartmentStatsData): Promise<Buffer> {\n  const html = generateDepartmentHTML(data);\n  const browser = await puppeteer.launch({\n    headless: true,\n    args: ['--no-sandbox', '--disable-setuid-sandbox'],\n  });\n  \n  try {\n    const page = await browser.newPage();\n    await page.setContent(html, { waitUntil: 'networkidle0' });\n    const pdfBuffer = await page.pdf({\n      format: 'A4',\n      printBackground: true,\n      margin: { top: '20mm', right: '15mm', bottom: '20mm', left: '15mm' },\n    });\n    return Buffer.from(pdfBuffer);\n  } finally {\n    await browser.close();\n  }\n}\n\nexport function generateTrainingComplianceExcel(data: TrainingComplianceData): Buffer {\n  const wb = XLSX.utils.book_new();\n  \n  const summaryData = [\n    ['Training Compliance Report'],\n    [`Generated: ${formatDate(data.generatedAt)}`],\n    [],\n    ['Summary Statistics'],\n    ['Total Employees', data.summary.totalEmployees],\n    ['Employees With Training', data.summary.employeesWithTraining],\n    ['Employees Without Training', data.summary.employeesWithoutTraining],\n    ['Compliant Employees', data.summary.compliantEmployees],\n    ['At Risk Employees', data.summary.atRiskEmployees],\n    ['Non-Compliant Employees', data.summary.nonCompliantEmployees],\n    ['Overall Compliance Rate', `${data.summary.overallComplianceRate}%`],\n    ['Trained Compliance Rate', `${data.summary.trainingComplianceRate}%`],\n    [],\n    ['Enrollment Statistics'],\n    ['Total Enrollments', data.enrollmentStats.total],\n    ['Active', data.enrollmentStats.active],\n    ['Completed', data.enrollmentStats.completed],\n    ['Expiring Soon', data.enrollmentStats.expiringSoon],\n    ['Expired', data.enrollmentStats.expired],\n  ];\n  const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);\n  XLSX.utils.book_append_sheet(wb, summarySheet, 'Summary');\n  \n  const employeeData = [\n    ['Name', 'Department', 'Role', 'Total Courses', 'Completed', 'Expiring', 'Expired', 'Status'],\n    ...data.employees.map(e => [\n      e.name,\n      e.department,\n      e.role,\n      e.totalCourses,\n      e.completedCourses,\n      e.expiringCourses,\n      e.expiredCourses,\n      e.complianceStatus,\n    ]),\n  ];\n  const employeeSheet = XLSX.utils.aoa_to_sheet(employeeData);\n  XLSX.utils.book_append_sheet(wb, employeeSheet, 'Employees');\n  \n  const output = XLSX.write(wb, { type: 'buffer', bookType: 'xlsx' });\n  return Buffer.from(output);\n}\n\nexport function generateEmployeeProgressExcel(data: EmployeeProgressData): Buffer {\n  const wb = XLSX.utils.book_new();\n  \n  const infoData = [\n    ['Employee Progress Report'],\n    [`Generated: ${formatDate(data.generatedAt)}`],\n    [],\n    ['Employee Information'],\n    ['Name', data.employee.name],\n    ['Email', data.employee.email],\n    ['Role', data.employee.role],\n    ['Department', data.employee.department],\n    ['Current Grade', data.employee.currentGrade],\n    ['Hire Date', data.employee.hireDate],\n  ];\n  const infoSheet = XLSX.utils.aoa_to_sheet(infoData);\n  XLSX.utils.book_append_sheet(wb, infoSheet, 'Info');\n  \n  const enrollmentData = [\n    ['Course', 'Category', 'Status', 'Enrolled', 'Completed', 'Expires', 'Score'],\n    ...data.enrollments.map(e => [\n      e.courseName,\n      e.category,\n      e.status,\n      e.enrolledDate,\n      e.completedDate || '',\n      e.expirationDate,\n      e.score !== null ? e.score : '',\n    ]),\n  ];\n  const enrollmentSheet = XLSX.utils.aoa_to_sheet(enrollmentData);\n  XLSX.utils.book_append_sheet(wb, enrollmentSheet, 'Enrollments');\n  \n  const taskData = [\n    ['Task', 'Target Grade', 'Status', 'Due Date', 'Completed'],\n    ...data.progressionTasks.map(t => [\n      t.title,\n      t.targetGrade,\n      t.status,\n      t.dueDate || '',\n      t.completedDate || '',\n    ]),\n  ];\n  const taskSheet = XLSX.utils.aoa_to_sheet(taskData);\n  XLSX.utils.book_append_sheet(wb, taskSheet, 'Tasks');\n  \n  const renewalData = [\n    ['Course', 'Status', 'Submitted', 'Approved'],\n    ...data.renewalRequests.map(r => [\n      r.courseName,\n      r.status,\n      r.submittedDate,\n      r.approvedDate || '',\n    ]),\n  ];\n  const renewalSheet = XLSX.utils.aoa_to_sheet(renewalData);\n  XLSX.utils.book_append_sheet(wb, renewalSheet, 'Renewals');\n  \n  const output = XLSX.write(wb, { type: 'buffer', bookType: 'xlsx' });\n  return Buffer.from(output);\n}\n\nexport function generateDepartmentStatsExcel(data: DepartmentStatsData): Buffer {\n  const wb = XLSX.utils.book_new();\n  \n  const summaryData = [\n    [`Department Report: ${data.department.name}`],\n    [`Generated: ${formatDate(data.generatedAt)}`],\n    [],\n    ['Summary'],\n    ['Total Employees', data.summary.totalEmployees],\n    ['Compliance Rate', `${data.summary.complianceRate}%`],\n    ['Avg Completion', `${data.summary.avgTrainingCompletion}%`],\n    ['Pending Renewals', data.summary.pendingRenewals],\n    ['Upcoming Expirations', data.summary.upcomingExpirations],\n  ];\n  const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);\n  XLSX.utils.book_append_sheet(wb, summarySheet, 'Summary');\n  \n  const employeeData = [\n    ['Name', 'Role', 'Completion %', 'Expiring Courses'],\n    ...data.employees.map(e => [\n      e.name,\n      e.role,\n      e.completionRate,\n      e.expiringCourses,\n    ]),\n  ];\n  const employeeSheet = XLSX.utils.aoa_to_sheet(employeeData);\n  XLSX.utils.book_append_sheet(wb, employeeSheet, 'Employees');\n  \n  const courseData = [\n    ['Course', 'Enrolled', 'Completed', 'Expiring', 'Expired'],\n    ...data.courseBreakdown.map(c => [\n      c.courseName,\n      c.enrolled,\n      c.completed,\n      c.expiring,\n      c.expired,\n    ]),\n  ];\n  const courseSheet = XLSX.utils.aoa_to_sheet(courseData);\n  XLSX.utils.book_append_sheet(wb, courseSheet, 'Courses');\n  \n  const output = XLSX.write(wb, { type: 'buffer', bookType: 'xlsx' });\n  return Buffer.from(output);\n}\n\nexport function generateJSONExport(data: TrainingComplianceData | EmployeeProgressData | DepartmentStatsData): string {\n  return JSON.stringify(data, null, 2);\n}\n","path":null,"size_bytes":33002,"size_tokens":null}},"version":2}