You are working on the TrainFlow project in this Replit.  
IMPORTANT: The system is already feature-rich and deployed on https://training.rocktech.sa.  
DO NOT break any previous architecture.  
DO NOT change any filenames, routes, folder structures, or component names.  
DO NOT modify the authentication flow design — only fix functionality.  
Ensure **backend and frontend interact EXACTLY like before**, with the SAME API contracts (request shapes, response shapes, field names).

Your task now is a **data integrity + real DB wiring + backend/frontend sync pass**, ensuring everything works with REAL PostgreSQL data per role.

────────────────────────────────────────────
## 1) BACKEND ↔ FRONTEND CONTRACT MUST MATCH (CRITICAL)
Before doing anything else, VERIFY that:

- Every frontend API call in `client/src/api/*`, `client/src/hooks/*`, and pages/components **expects a specific JSON shape**.
- The backend MUST return the **same structure exactly as frontend expects**, including:
  - field names (camelCase vs snake_case)
  - role strings
  - user fields (firstName / lastName)
  - course fields
  - enrollment fields
  - renewal fields
  - anything used by dashboard cards, tables, or routes

Fix any mismatches WITHOUT changing the frontend structure.  
This means:

**BACKEND MUST ADAPT TO FRONTEND — NOT THE OTHER WAY AROUND.**

IF the backend is returning `first_name`, convert it to `firstName` before sending the response.  
IF the backend is returning nested structures different from frontend expectations, transform them accordingly.  
IF the frontend expects `role: "admin"` then backend must return exactly that string.

NO frontend refactors. Backend must align with the existing frontend contracts.

────────────────────────────────────────────
## 2) VERIFY REAL DB USAGE
Confirm all pages load real PostgreSQL data:

Dashboard  
My Courses  
My Renewals  
All Renewals  
Progression Tasks  
AI Recommendations  
Grade Readiness  
KPI Dashboard  
User Management  
Departments  
Integrations  
Team Overview  
Team Approvals  

***Remove any mock/in-memory data. Everything must be DB-driven.***

────────────────────────────────────────────
## 3) ROLE-BASED DATA FILTERING (RBAC)
Make sure the backend enforces these filters:

Admin:
- Can see ALL data for the tenant.

Training Officer:
- Can manage courses, enrollments, renewals.

Manager:
- Can only see their department users + their team’s data.

Foreman:
- Can only see the subordinate users.

Employee:
- Can only see personal courses, renewals, tasks, AI insights.

DO NOT change UI routing — only fix backend filters & API responses.

────────────────────────────────────────────
## 4) USER MANAGEMENT FULL CRUD WITH REAL DB
Admin → User Management must allow:

- View all users
- Create new user
- Edit role / department
- (Optional) Reset password
- Backend must hash passwords with bcrypt
- User must appear instantly after creation

Endpoints required:
- GET /api/v1/users
- POST /api/v1/users
- PATCH /api/v1/users/:id
- DELETE /api/v1/users/:id (only if frontend already calls it)

Make sure request/response shapes match frontend expectations.

────────────────────────────────────────────
## 5) DEMO SEED MUST ALIGN WITH FRONTEND EXPECTATIONS
Seed real data:
- Users (admin, training officer, managers, foremen, employees)
- Departments
- Courses
- Enrollments
- Renewals
- Tasks
- KPIs

Ensure EVERY seeded field matches frontend expectations:
- date formats
- validity dates
- course IDs
- role strings
- camelCase fields
- correct relations (user_id, course_id, department_id)

────────────────────────────────────────────
## 6) AUTH SYSTEM MUST WORK AS BEFORE
Login flow MUST BE IDENTICAL to previous behavior:

- POST /api/v1/users/login sets the session cookie
- Frontend calls /api/v1/users/me to validate the session
- On valid session:
  - Protected routes load
  - Sidebar appears
  - Dashboard loads real data

Ensure:
- Cookies are sent using proper `sameSite`, `secure`, and `path` settings.
- Session persists across navigation
- No infinite redirects
- No 401 spam in console after login

────────────────────────────────────────────
## 7) BACKEND/FRONTEND ROUTES MUST REMAIN THE SAME
Do NOT rename or move:

Frontend routes:  
`/dashboard`  
`/courses`  
`/enrollments`  
`/users`  
`/departments`  
`/approvals`  
`/team`  
etc.

Backend routes:  
`/api/v1/users`  
`/api/v1/courses`  
`/api/v1/enrollments`  
`/api/v1/renewals`  
`/api/v1/kpi`  
etc.

Do NOT create new route names.  
If a route is missing functionality, implement it internally without changing the API path.

────────────────────────────────────────────
## 8) FINAL INTEGRATION CHECK
Before finishing, verify:

- Login works with demo accounts
- After login, dashboard appears with sidebar
- User Management shows real DB users
- Creating a user updates DB + frontend instantly
- Manager views only their team
- Employee views only personal data
- All dashboard numbers come from DB
- No mock data anywhere
- No 401 loops
- No console errors

────────────────────────────────────────────
## 9) REPORT BACK
At the end, provide:

- List of backend files edited
- List of frontend files adjusted (only if absolutely necessary for API contract)
- Confirmation of all endpoints working
- Summary of DB data flow per role
- Seed instructions + demo accounts
- Confirmation that backend ↔ frontend contract is now 100% aligned

────────────────────────────────────────────

DO NOT break ANY existing structure.  
DO NOT alter UI design or text.  
Your mission: **Real data everywhere, correct RBAC, solid API contract, and perfect backend→frontend sync — EXACTLY like the system’s original behavior intended.**
