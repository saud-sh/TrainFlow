ROUTING FIX PHASE – ROLE-BASED NAVIGATION & GUARDS

Goal:
Fix frontend routing in client/ so that:
- After login, user is redirected to the correct dashboard page based on their role.
- All sidebar menu routes work without 404 or blank pages.
- Unauthenticated users are redirected to /login when opening protected routes.
- Authenticated users cannot access /login and get redirected correctly.
- Landing page remains public.

Important:
- Do NOT modify database schema.
- Do NOT touch Alembic.
- Do NOT change backend RBAC logic.
- Only adjust backend auth if needed and stay compatible with existing endpoints.

1. Role-Based Default Routes:
Create file: client/src/utils/roleRoutes.ts

Default routes:
administrator -> /users
training_officer -> /courses
manager -> /kpi-dashboard
foreman -> /approvals
employee -> /dashboard
fallback -> /dashboard

Also export:
- getDefaultRouteForRole(role)
- isRouteAllowedForRole(role, path)
- roleToAllowedRoutes map

Allowed routes per role:
employee:
  /dashboard
  /my-courses
  /my-renewals
  /progression
  /recommendations
  /grade-readiness
  /kpi-dashboard

foreman: all employee routes +
  /approvals
  /team
  /reports

manager: all foreman routes +
  /all-renewals
  /reports

training_officer:
  /courses
  /enrollments
  /all-renewals
  /reports
  /kpi-dashboard

administrator: all above +
  /users
  /departments
  /audit-logs
  /integrations


2. Update useAuth Hook (client/src/hooks/useAuth.ts):
- Must expose: user, isAuthenticated, loading, login(), logout()
- On startup call /api/v1/auth/me (or /api/v1/users/me depending on which exists)
- After login(), the hook returns the user object; navigation will be handled by the login page.
- Keep cookie-based session handling.

3. Login Page Fix (client/src/pages/Login.tsx):
On successful login:
  const defaultRoute = getDefaultRouteForRole(user.role)
  navigate(defaultRoute, { replace: true })

Do NOT return user to landing page after login.

Include “Back to Landing” link => navigate('/')

4. ProtectedRoute Component:
Create file: client/src/components/routing/ProtectedRoute.tsx

Logic:
If loading => show loader
If !isAuthenticated => redirect to /login?redirect=currentPath
If requiredRoles exists AND user.role not allowed => show custom 403 page
Otherwise render children

5. Router Fix in client/src/App.tsx:
- Register all required routes:
  /dashboard
  /my-courses
  /my-renewals
  /progression
  /recommendations
  /grade-readiness
  /approvals
  /team
  /kpi-dashboard
  /courses
  /enrollments
  /all-renewals
  /users
  /departments
  /audit-logs
  /integrations
  /reports
  /profile
  /settings
  /login
  /  (Landing Page)

- Wrap protected routes with <ProtectedRoute>

Examples:
<Route path="/users" element={
  <ProtectedRoute requiredRoles={['administrator']}>
    <UserManagementPage />
  </ProtectedRoute>
} />

<Route path="/courses" element={
  <ProtectedRoute requiredRoles={['training_officer','administrator']}>
    <CourseManagementPage />
  </ProtectedRoute>
} />

- For /login:
  If authenticated => redirect to getDefaultRouteForRole(user.role)

- For /:
  Keep public
  But if redirected from login, go to default user route.

6. Sidebar Fix:
- Use useAuth inside Sidebar
- For each nav item, check isRouteAllowedForRole(user.role, targetRoute)
- Only show links allowed for that role
- Ensure each sidebar link exactly matches the <Route path=""> to avoid 404 pages.

7. Optional Backend Adjustments:
Only if needed create backend/app/api/v1/auth.py with:
  POST /auth/login
  POST /auth/logout
  GET /auth/me
All MUST use existing logic (authenticate_user, get_current_user, create_access_token).

Do NOT change database or RBAC.

8. Acceptance Criteria:
- Login works and redirects by role:
  admin -> /users
  training_officer -> /courses
  manager -> /kpi-dashboard
  foreman -> /approvals
  employee -> /dashboard

- No sidebar item causes 404
- Protected routes cannot be accessed unauthenticated
- Employees cannot access admin pages (show 403)
- Landing page stays public
- Logout returns user to landing/login
- No backend breaking changes

END.
