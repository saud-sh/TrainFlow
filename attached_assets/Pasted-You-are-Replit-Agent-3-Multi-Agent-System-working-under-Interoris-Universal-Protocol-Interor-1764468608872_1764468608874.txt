You are Replit Agent 3 (Multi-Agent System) working under:

- Interoris Universal Protocol
- Interoris Phase Execution Protocol
- Rock Technology CTO Engineering Protocol
- No-Destructive-Migrations Rule
- Architecture-First Rule
- Multi-Tenant Safety Rule
- RBAC Discipline Rule
- AI-Pipeline-Separation Rule

You MUST reset assumptions and ignore ANY existing Node.js code.
This is a FULL REBUILD using Python/FastAPI architecture.

============================================================
PROJECT: TrainFlow
TYPE: Enterprise Training + Talent Intelligence Platform
============================================================

TrainFlow is an enterprise Training, Renewal, Progression & Talent Intelligence Platform
designed for organizations like Aramco and Saudi Electricity Company.

The platform MUST support:
- Compliance-based training management
- Renewal workflows with multi-level approvals
- Progression & promotion tracking
- AI recommendations
- Talent Intelligence
- Skill Graph Engine
- Career Path AI
- SCORM & LMS capabilities
- Security Awareness Simulation
- ERP/LMS/DB integrations
- Multi-tenant architecture
- Complete audit trail and event logging

============================================================
MANDATORY TECHNOLOGY STACK (DO NOT VIOLATE)
============================================================

Backend:
- Python
- FastAPI
- SQLAlchemy ORM
- Clean Architecture (Core Domain → Application → Infrastructure → API)
- Modular Monolith with Bounded Contexts
- APScheduler or async background workers

Frontend:
- React
- Vite
- TypeScript
- Zustand (state slices)
- TailwindCSS
- ShadCN UI
- React Router
- Axios

Database:
- SQLite (development)
- PostgreSQL (production)
- Multi-tenant: EVERY business table MUST include tenant_id (UUID)
- Migrations must be ADDITIVE ONLY:
  - NO DROP TABLE
  - NO DROP COLUMN
  - NO ALTER DROP
  - NO CASCADE deletions
  - Production database is AUTHORITATIVE

AI:
- Background Jobs ONLY
- Separate AI pipelines
- Must define AI input tables, output tables, and job triggers

Integrations:
- Integration Engine with:
  - SAP HR / SAP TEM
  - Oracle HCM
  - Cornerstone
  - SuccessFactors
  - External LMS Providers
  - External Databases (PostgreSQL/MySQL/SQLServer)
  - File-based import (Excel/CSV)
- Each tenant has:
  - Integration configuration
  - Encrypted credentials
  - Staging tables
  - Mapping layer
  - Sync logs
  - Test-connection endpoint

Security:
- JWT or session tokens in HttpOnly + Secure cookies
- CSP + HSTS + X-Frame-Options + X-Content-Type
- Rate limiting on login
- RBAC enforced on ALL backend + frontend routes
- Tenant isolation middleware
- 403 / 404 / 500 HTML pages

============================================================
BOUNDED CONTEXTS (REQUIRED)
============================================================

1. User Management
2. Department Structure
3. Course Management
4. Enrollment Management
5. Renewal Workflow (Employee → Foreman → Manager)
6. Task / Progression Engine
7. KPI Engine
8. Notification Engine
9. AI Recommendation Engine
10. Grade Predictor
11. Audit Logging
12. Workflow Timeline
13. Integration Engine
14. SCORM / LMS Engine
15. Skill Graph Engine (NEW)
16. Career Path AI (NEW)
17. AI Coaching Engine (NEW)
18. Security Awareness Simulation Engine (NEW)

============================================================
FRONTEND ROUTING MAP (MUST BE IMPLEMENTED)
============================================================

- `/`                           Dashboard
- `/my-courses`                 Employee, Foreman, Manager
- `/my-renewals`                Employee, Foreman, Manager
- `/progression`                Employee, Foreman, Manager
- `/recommendations`            AI Course Recommendations
- `/grade-readiness`            AI Promotion Predictor
- `/approvals`                  Approvals (Foreman/Manager)
- `/team`                       Team Overview
- `/courses`                    Training Officer, Admin
- `/enrollments`                Training Officer, Admin
- `/all-renewals`               Training Officer, Admin
- `/users`                      Admin
- `/departments`                Admin
- `/audit-logs`                 Admin
- `/integrations`               Admin
- `/reports`                    Manager, Officer, Admin
- `/kpi-dashboard`              All roles
- `/skills`                     Skill Graph Explorer (NEW)
- `/career-path`                Career Path AI (NEW)
- `/scorm`                      SCORM Player / LMS Content (NEW)
- `/security-awareness`         Cyber Simulations (NEW)
- Errors: `/403`, `/404`, `/500`

============================================================
DATABASE (ERD REQUIREMENTS)
============================================================

You MUST define all tables with tenant_id:

Core:
- tenants
- users
- departments
- courses
- enrollments
- progression_tasks
- employee_tasks
- renewal_requests
- workflow_steps
- workflow_logs
- notifications
- kpi_snapshots
- audit_logs

AI:
- ai_inputs
- ai_outputs
- ai_jobs
- ai_recommendations
- ai_grade_predictions
- ai_coaching_plans

Skill Graph (NEW):
- skills
- skill_categories
- skill_relations (graph edges)
- skill_levels
- user_skills
- training_skill_map
- job_skill_requirements

Career Path AI (NEW):
- career_paths
- career_predictions
- role_graph

SCORM / LMS (NEW):
- scorm_packages
- scorm_manifests
- scorm_tracking
- lms_providers
- lms_completion_imports

Security Awareness Simulator (NEW):
- phishing_campaigns
- phishing_templates
- phishing_results
- cyber_readiness_scores

Integrations:
- integration_systems
- integration_connections
- integration_credentials
- staging tables (stg_employees, stg_departments, stg_courses, stg_enrollments)
- sync_logs
- mapping tables

============================================================
BACKGROUND JOBS (MANDATORY)
============================================================

- Daily course expiration check
- Renewal escalation workflow
- Notification dispatch
- KPI aggregation engine
- AI recommendation pipeline
- AI grade predictor pipeline
- AI coaching weekly planner
- Skill inference jobs
- Integration sync jobs (SAP/Oracle/LMS/DB)
- SCORM tracking updates
- Cyber simulation job scheduler

============================================================
ABSOLUTE RULES FOR REPLIT
============================================================

You MUST:
- Start with a FULL SYSTEM BLUEPRINT (Phase 1)
- Use Replit Design Mode for UI layouts and workflow diagrams
- Enforce multi-tenant + RBAC across all modules
- Ensure additive-only migrations
- Keep AI pipelines fully separated from main HTTP workflows
- Document bounded contexts clearly
- Provide proper file/folder structure
- Follow Clean Architecture strictly
- Add logging + monitoring + health checks
- Update `replit.md` with every phase

You MUST NOT:
- Generate ANY code before the Blueprint is approved
- Use Node.js, Express.js, Drizzle, Prisma, or TS backend
- Make destructive DB changes
- Run AI inside HTTP requests
- Break previous phases
- Guess missing requirements

============================================================
PHASE 1 — SYSTEM BLUEPRINT (DO THIS NOW)
============================================================

Do NOT generate any code.

Produce ONLY a complete Blueprint in `replit.md`, including:

1) File/Folder Structure  
2) Full ERD (all tables)  
3) Bounded Contexts Map  
4) Backend Routing Map  
5) Frontend Page Map  
6) Integration Engine Blueprint  
7) AI Pipeline Blueprint  
8) Skill Graph Engine Blueprint  
9) Career Path AI Blueprint  
10) SCORM/LMS Engine Blueprint  
11) Security Awareness Simulator Blueprint  
12) Background Jobs Architecture  
13) RBAC & Tenant Isolation Rules  
14) Security Architecture  
15) Observability Design  
16) Phase Roadmap (Phase 1 → Phase N)  
17) Assumptions & notes  

STOP after generating the Blueprint.
WAIT for my approval before generating any code.

