We confirm that PHASE 1 – SYSTEM BLUEPRINT is APPROVED.

We are now moving to:

====================================================
PHASE 2 – FOUNDATION & PROJECT SETUP (BACKEND + FRONTEND)
====================================================

You are Replit Agent 3 working under:

- Interoris Universal Protocol  
- Interoris Phase Execution Protocol  
- Rock Technology Project ChatGPT Protocol  

You MUST follow the existing blueprint in `replit.md` as the SINGLE source of truth.  
Do NOT change the architecture, tech stack, or ERD unless explicitly authorized.

This phase is about **scaffolding** the system, NOT implementing full business logic.

----------------------------------------------------
1) PHASE 2 – OBJECTIVE
----------------------------------------------------

Create a solid, production-ready FOUNDATION for TrainFlow:

- Backend: Python/FastAPI project structure with SQLAlchemy & Alembic configured.
- Database: Initial additive-only migration creating the baseline schema.
- Frontend: React/Vite/TypeScript shell with Tailwind + ShadCN + Zustand structure.
- Core plumbing: config, logging, basic health endpoints, security middleware skeleton.

No business workflows, no AI logic, no integrations logic in this phase.

----------------------------------------------------
2) SCOPE (INCLUDED)
----------------------------------------------------

### 2.1 Backend – FastAPI Project Structure

Based on the blueprint, you MUST:

- Create a `backend/` folder with a CLEAN ARCHITECTURE modular monolith layout, e.g.:

  - backend/app/core/       (settings, config, logging)
  - backend/app/db/         (engine, session, base)
  - backend/app/models/     (SQLAlchemy models per bounded context)
  - backend/app/schemas/    (Pydantic schemas)
  - backend/app/api/        (routers, but only minimal stubs in this phase)
  - backend/app/services/   (empty placeholders for business logic)
  - backend/app/jobs/       (background job registration, but no job bodies yet)
  - backend/app/integrations/ (placeholders for Integration Engine)
  - backend/app/ai/         (placeholders for AI pipelines)
  - backend/app/security/   (auth, RBAC, middleware skeletons)
  - backend/app/main.py     (FastAPI app factory, router inclusion)

- Implement:

  - Central **settings/config** system (e.g., Pydantic Settings) for:
    - DB URLs (SQLite dev, PostgreSQL prod)
    - Environment (dev/stage/prod)
    - Security (secret key placeholder)
  
  - Database module:
    - SQLAlchemy engine
    - SessionLocal
    - Base = declarative base

  - App factory in `main.py`:
    - Create FastAPI app
    - Include:
      - CORS middleware
      - Security headers middleware (skeleton)
      - Logging middleware (basic)
    - Mount minimal health endpoints:
      - `GET /api/health` → `{ "status": "ok" }`
      - `GET /api/health/detailed` → dummy data (later wired to real checks)

### 2.2 Database Schema & Alembic Setup

- Configure **Alembic** for migrations in `backend/`:

  - Proper `alembic.ini`
  - `env.py` connected to our SQLAlchemy Base & engine
  - Use the DB URL from our settings (dev: SQLite)

- Implement SQLAlchemy models for ALL tables defined in the blueprint (28+ tables), including:

  - tenants
  - users
  - departments
  - courses
  - enrollments
  - progression_tasks
  - employee_tasks
  - renewal_requests
  - workflow_steps
  - workflow_logs
  - notifications
  - kpi_snapshots
  - ai_inputs
  - ai_outputs
  - audit_logs
  - integration_systems
  - integration_connections
  - integration_credentials
  - staging tables (stg_employees, stg_departments, stg_courses, stg_enrollments, etc.)
  - sync_logs
  - any additional tables listed in the ERD section in `replit.md`

- For ALL business tables:

  - Include `tenant_id` with correct type (UUID / string) as defined in the blueprint.
  - Add proper foreign keys and indexes as per ERD (at least for main relations).

- Create an **INITIAL Alembic migration** that:

  - CREATES all baseline tables.
  - Respects the additive-only rule (this is the first migration, so only CREATE).
  - Does NOT drop or alter any existing tables (if DB already exists, ensure safety).

- Provide a simple script/command (e.g., `alembic upgrade head`) that can initialize the dev DB from scratch.

### 2.3 Security & Observability Skeleton (Backend)

- Add a basic **logging** configuration:

  - Structured logs including timestamp, level, and message.
  - Later we will extend with user_id / tenant_id, but for now just structure.

- Add security middleware skeleton:

  - A placeholder middleware for:
    - Future RBAC checks
    - Tenant resolution
    - Security headers (CSP/HSTS/XFO/XCTO)
  - At this phase, they can log and pass-through; do not enforce full logic yet.

### 2.4 Frontend – React/Vite/TS Shell

Create a `frontend/` project with:

- React + TypeScript + Vite
- TailwindCSS configured
- ShadCN UI installed and configured
- Base folder structure, e.g.:

  - frontend/src/app/            (App root)
  - frontend/src/routes/         (Route components)
  - frontend/src/components/     (UI components)
  - frontend/src/store/          (Zustand slices)
  - frontend/src/lib/            (API client, helpers)
  - frontend/src/styles/         (global styles, tailwind base)

- Implement:

  - `App.tsx` with React Router setup.
  - Base layout (e.g., sidebar + topbar) with placeholder navigation items matching our page map:
    - Dashboard
    - My Courses
    - My Renewals
    - Progression
    - Recommendations
    - Grade Readiness
    - Approvals
    - Team
    - Courses
    - Enrollments
    - All Renewals
    - Users
    - Departments
    - Audit Logs
    - Integrations
    - Reports
    - KPI Dashboard

  - For now, each page can be a simple stub component with:
    - Page title
    - Placeholder text
    - Proper route protection hooks skeleton (we will wire to real RBAC later).

- Set up **Zustand** with:

  - A `useAuthStore` slice (stubbed, no real auth logic yet).
  - A `useUiStore` or similar for layout state (sidebar open/close).
  - A `useTenantStore` placeholder (for future tenant context).

### 2.5 Dev Tooling

- Add minimal tooling:

  - Backend:
    - `requirements.txt` or `pyproject.toml`
    - Commands to run dev server (e.g., `uvicorn app.main:app --reload`)
  - Frontend:
    - `package.json` scripts for `dev`, `build`, `preview`

----------------------------------------------------
3) OUT OF SCOPE (EXCLUDED IN PHASE 2)
----------------------------------------------------

You MUST NOT implement the following in this phase:

- No business logic for:
  - Renewal workflows
  - Multi-level approvals
  - Progression engine
  - KPI calculations
  - Notifications
  - AI recommendations
  - Grade readiness logic
  - Integration sync logic

- No external API calls to SAP/Oracle/LMS/DB.
- No AI model integration or calling OpenAI.
- No final security enforcement (RBAC, tenant isolation) beyond skeleton code.
- No complex UI/UX (only shell & placeholders).
- No seeding or demo data l
